(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     14486,        375]
NotebookOptionsPosition[     14158,        359]
NotebookOutlinePosition[     14545,        376]
CellTagsIndexPosition[     14502,        373]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"mapHtApairs", "[", 
    RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n1", ",", "n2", ",", "x1", ",", "x2", ",", "listi1", ",", "listi2", 
       ",", "tab1", ",", "tab2", ",", "set1", ",", "set2", ",", "listf1", ",",
        "listf2", ",", "set11", ",", "set12"}], "}"}], "\[IndentingNewLine]", 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tab1", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"tab2", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"N", "-", "2"}], ",", 
          RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
        RowBox[{"add", " ", "desired", " ", 
         RowBox[{"up", "/", "dn"}], " ", "or", " ", 
         RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
         RowBox[{"(", 
          RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"exclude", " ", "k"}], "=", 
         RowBox[{"0", " ", "case"}]}], " ", "*)"}],
       FontSize->12], "\[IndentingNewLine]", 
      RowBox[{"listi1", "=", 
       RowBox[{"comb", "[", 
        RowBox[{
         RowBox[{"N", "-", "2"}], ",", 
         RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", "\[IndentingNewLine]", 
      
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"set1", "=", 
          RowBox[{"listi1", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", "n1", 
            " ", "position", "\[IndentingNewLine]", "and", " ", "a", " ", 
            "down", " ", "at", " ", "n2", " ", "position"}], ";", " ", 
           RowBox[{
            RowBox[{"shift", " ", "n1"}], "+", " ", 
            RowBox[{"and", " ", "n2"}], "+", " ", 
            RowBox[{
            "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", "as", 
             " ", "they", " ", "should", " ", "be"}]}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"shift", " ", "by"}], " ", "+", 
           RowBox[{
           "1", " ", "twice", " ", "for", " ", "second", " ", "case", " ", 
            "means"}], " ", "+", 
           RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"set11", "=", 
          RowBox[{"set1", "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"q_Integer", "/;", 
              RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
             RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"set12", "=", 
          RowBox[{"set11", "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"q_Integer", "/;", 
              RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
             RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Adding", " ", 
           RowBox[{"up", "/", "down"}], "  ", "at", " ", 
           RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"listf1", "=", 
          RowBox[{"Sort", "[", 
           RowBox[{"Join", "[", 
            RowBox[{"set11", ",", 
             RowBox[{"{", "n1", "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Adding", " ", 
           RowBox[{"down", "/", "up"}], "  ", "at", " ", 
           RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"listf2", "=", 
          RowBox[{"Sort", "[", 
           RowBox[{"Join", "[", 
            RowBox[{"set11", ",", 
             RowBox[{"{", "n2", "}"}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"indices", " ", "for", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}], " ", "case"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"x1", "=", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"N", ",", "k"}], "]"}], "-", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "-", 
                RowBox[{"listf1", "[", 
                 RowBox[{"[", 
                  RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"k", "-", "p"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"p", ",", "0", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"x2", "=", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"N", ",", "k"}], "]"}], "-", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "-", 
                RowBox[{"listf2", "[", 
                 RowBox[{"[", 
                  RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"k", "-", "p"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"p", ",", "0", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], "\[IndentingNewLine]", 
        ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.706813184991684*^9, 3.706813202439067*^9}, {
  3.706815367665515*^9, 3.706815607054764*^9}, {3.7068161746973143`*^9, 
  3.706816382081328*^9}, {3.7068164418921947`*^9, 3.7068166649801683`*^9}, {
  3.7068170624758883`*^9, 3.706817081145543*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeHtApairs", "[", 
     RowBox[{"N_", ",", "m_", ",", "sapos_", ",", "th_", ",", "tl_"}], "]"}], 
    ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr0", ",", "pntr1", ",", "pntr2", ",", "ntot0", ",", "ntot2", ",", 
        "Hta", ",", "Htb", ",", "coora", ",", "coorb", ",", "ntot1", ",", 
        "Htsph", ",", "Htspl", ",", "tab1", ",", "tab2", ",", "ind1", ",", 
        "ind2", ",", "ind01", ",", "ind02"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"v", " ", "v", " ", 
          RowBox[{"importnat", ":", " ", 
           RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
         RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
       FontSize->18], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pntr0", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", ",",
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pntr1", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{
                RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{"m", "-", "1"}]}], "}"}]}], "]"}], ",", "0", ",", "1"}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot0", "=", 
        RowBox[{"pntr0", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot1", "=", 
        RowBox[{"pntr1", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Hta", "=", 
        RowBox[{"{", "}"}]}], ";", 
       RowBox[{"Htb", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
           RowBox[{"mapHtApairs", "[", 
            RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind01", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr0", "[", 
               RowBox[{"[", 
                RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], "//",
             "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ind02", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr0", "[", 
               RowBox[{"[", 
                RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], "//",
             "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", "k", "]"}], "]"}], "+", 
              RowBox[{"Table", "[", 
               RowBox[{"i", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
             "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"coorb", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"ind02", ",", "ind1", ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "m"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Htsph", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"tl", " ", "+", " ", 
           RowBox[{"f", "*", "th"}]}], " ", ";", " ", 
          RowBox[{"f", " ", "=", " ", 
           RowBox[{
            RowBox[{"e", "^", 
             RowBox[{"(", 
              RowBox[{"-", 
               RowBox[{"\[Beta]E", ".", "r"}]}], ")"}]}], " ", "panelty", " ",
             "for", " ", "hopping", " ", "to", " ", "left", " ", "against", 
            " ", "the", " ", "applied", " ", "bias"}]}], ";", " ", 
          RowBox[{"E", " ", "elec", " ", "field"}]}], ",", " ", 
         RowBox[{"r", " ", "intersite", " ", "distance"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Htspl", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"f", "*", "tl"}], " ", "+", " ", "th"}], "  ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.706816906282342*^9, 3.706817013686708*^9}, {
  3.706817046490985*^9, 3.706817052784073*^9}, {3.7068170976807404`*^9, 
  3.7068172217203836`*^9}, {3.706817255980515*^9, 3.7068172710572987`*^9}, {
  3.7068174374104347`*^9, 3.706817516982065*^9}, {3.706817643380533*^9, 
  3.706817758529077*^9}}]
},
WindowSize->{972, 702},
WindowMargins->{{Automatic, -2}, {Automatic, 0}},
Magnification:>1.5 Inherited,
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 6546, 161, 769, "Input"],
Cell[7107, 183, 7047, 174, 814, "Input"]
}
]
*)

