(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    290032,       6674]
NotebookOptionsPosition[    289132,       6643]
NotebookOutlinePosition[    289573,       6662]
CellTagsIndexPosition[    289530,       6659]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 StyleBox[
  RowBox[{
   RowBox[{
   "Incoherent", " ", "Charge", " ", "Transport", " ", "under", " ", "strong",
     " ", "matter"}], "-", 
   RowBox[{
   "light", " ", "coupling", " ", "in", " ", "organic", " ", 
    "microcavities"}]}], "Title"]], "Input",
 CellChangeTimes->{{3.70478296611215*^9, 3.7047829661136017`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "coupling"}], " ", "in", " ", "light", " ", "microcavities", 
   " ", "organic"}], "+", 
  RowBox[{
  "Charge", " ", "Incoherent", " ", "matter", " ", "strong", " ", "Transport",
    " ", "under"}]}]], "Output",
 CellChangeTimes->{
  3.706609530004723*^9, 3.706609895211174*^9, 3.7066099952906513`*^9, 
   3.7066100938726788`*^9, 3.7066102456600113`*^9, 3.7066103632163486`*^9, 
   3.7066105359395437`*^9, 3.7066106217719517`*^9, 3.706610743673415*^9, 
   3.706610833985786*^9, 3.706610954423253*^9, 3.706611133807654*^9, 
   3.706611235637236*^9, 3.706611694970789*^9, 3.706612511691449*^9, 
   3.706612649478977*^9, 3.7066127123203077`*^9, 3.706612761635604*^9, 
   3.706612834511488*^9, 3.70661289069601*^9, 3.706613180533739*^9, 
   3.70661323571681*^9, 3.7067988421482267`*^9, 3.706799893763204*^9, 
   3.706812799470871*^9, 3.706812962752569*^9, 3.7068183901269608`*^9, 
   3.706818531713325*^9, 3.706818773172839*^9, 3.706818845426894*^9, 
   3.706819079311837*^9, 3.706819626624167*^9, 3.7068197674344473`*^9, 
   3.706819982313349*^9, 3.70682056664277*^9, 3.7068209244598207`*^9, 
   3.706821246366961*^9, 3.706864792182317*^9, 3.7068653221196957`*^9, 
   3.706865697575775*^9, 3.706868838827587*^9, 3.706869094820778*^9, 
   3.706869240679016*^9, 3.70686959738586*^9, 3.7068757944872828`*^9, 
   3.706875913295011*^9, 3.706876181028376*^9, 3.706877356137162*^9, 
   3.706877581001154*^9, 3.7069455694449778`*^9, 3.7069457144567337`*^9, 
   3.706946871357212*^9, 3.706947192619609*^9, 3.706948197397256*^9, 
   3.70695027364437*^9, 3.706950527226184*^9, 3.70695075332201*^9, 
   3.70695111137948*^9, {3.7069512621207848`*^9, 3.706951289205604*^9}, 
   3.706951445418252*^9, 3.7069527057842627`*^9, 3.706953756557053*^9, 
   3.706953788628191*^9, 3.70695461893264*^9, 3.7069547519708233`*^9, 
   3.706954911259359*^9, 3.70695501135666*^9, 3.706955118082733*^9, 
   3.706955164662446*^9, 3.70695531376714*^9, 3.7069554035965652`*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"c", "[", 
    RowBox[{"n_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Binomial", "[", 
    RowBox[{"n", ",", "m"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"comb", "[", 
    RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
   RowBox[{"Subsets", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", "k", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Num", "[", "x_", "]"}], ":=", 
    RowBox[{"N", "[", "x", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HgMap", "[", 
    RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "tab", ",", "ind1", ",", "listi", ",", "tabx", ",", "sites", ",", 
       "flipsites", ",", "set1", ",", "flip", ",", "listf", ",", "xb", ",", 
       "xa"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tab", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"tabx", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"listi", "=", 
       RowBox[{"comb", "[", 
        RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sites", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"set1", "=", 
          RowBox[{"listi", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"flipsites", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{"sites", ",", "set1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"flip", "=", 
             RowBox[{"flipsites", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"listf", "=", 
             RowBox[{"Sort", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"set1", ",", 
                RowBox[{"{", "flip", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xa", "=", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", 
                RowBox[{"k", "+", "1"}]}], "]"}], "-", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{
                  RowBox[{"N", "-", 
                   RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                  RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabx", ",", "xa"}], "]"}], ";"}], "\[IndentingNewLine]",
            ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "flipsites", "]"}]}], "}"}]}], "]"}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"tab", ",", "tabx"}], "]"}], ";", 
         RowBox[{"tabx", "=", 
          RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "tab"}]}], "]"}]}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeHg", "[", 
     RowBox[{"N_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr", ",", "ind1", ",", "ind2", ",", "coora", ",", "ntot", ",", "Hg",
         ",", "ind2sub", ",", "m1"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "seperate", " ", "case", " ", "with", " ", "saturated", " ", 
        "polarisation"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"m", "\[LessEqual]", " ", "N"}], ",", 
         RowBox[{"m1", "=", "m"}], ",", 
         RowBox[{"m1", "=", "N"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pntr", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot", "=", 
        RowBox[{"pntr", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Hg", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"pntr", "[", 
             RowBox[{"[", 
              RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind2", "=", 
           RowBox[{
            RowBox[{"pntr", "[", 
             RowBox[{"[", 
              RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
            RowBox[{"HgMap", "[", 
             RowBox[{"N", ",", "k"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"HgMap", "[", 
            RowBox[{"N", ",", "k"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ind2sub", "=", 
              RowBox[{"ind2", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"coora", ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"ind1", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                    RowBox[{"ind2sub", "[", 
                    RowBox[{"[", "j2", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j2", ",", "1", ",", 
                 RowBox[{"Length", "[", "ind2sub", "]"}]}], "}"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "ind1", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"caution", ":", " ", 
             RowBox[{
              RowBox[{"Sqrt", "[", 
               RowBox[{"m", "-", "k"}], "]"}], "*", "gg", " ", "contains", 
              " ", "m"}]}], ",", " ", 
            RowBox[{"not", " ", "m1"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          
          RowBox[{"Hg", "+=", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{"coora", "\[Rule]", " ", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{"m", "-", "k"}], "]"}], "*", "gg"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "0", ",", 
           RowBox[{"m1", "-", "1"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Hg", "//", "Num"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DiagH", "[", 
    RowBox[{"N_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Hg", ",", "eval", ",", "U", ",", "Uct"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Hg", "=", 
          RowBox[{"makeHg", "[", 
           RowBox[{"N", ",", "m", ",", "gg"}], "]"}]}], ";", 
         RowBox[{"Hg", "+=", 
          RowBox[{"Transpose", "[", "Hg", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Sort", ",", " ", 
           RowBox[{
            RowBox[{"ascending", " ", 
             RowBox[{
             "order", ":", "\[IndentingNewLine]", "ref", ":", " ", "https", 
              ":"}]}], "//", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"stackoverflow", ".", "com"}], "/", "questions"}], 
               "/", "6589005"}], "/", "sort"}], "-", "eigenvalue", "-", 
             "matrix", "-", "with", "-", "eigenvector", "-", "matrix"}]}]}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"eval", ",", "U"}], "}"}], "=", 
          RowBox[{"Transpose", "@", 
           RowBox[{"SortBy", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"Eigensystem", "[", "Hg", "]"}], "]"}], ",", "First"}], 
            "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"make", " ", "E"}], "&"}], "U", " ", "by", " ", "hand"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eval", "=", 
          RowBox[{"{", "0.0", "}"}]}], ";", 
         RowBox[{"U", "=", 
          RowBox[{"{", 
           RowBox[{"{", "1.0", "}"}], "}"}]}], ";"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"eval", ",", "U"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.704711807714325*^9, 3.704711813425127*^9}, {
   3.7047118462446747`*^9, 3.7047118558573427`*^9}, {3.704712057541073*^9, 
   3.704712058516942*^9}, 3.7047122388707438`*^9, {3.7047122741652718`*^9, 
   3.704712275165612*^9}, {3.70471231584864*^9, 3.70471242018684*^9}, {
   3.704712600818972*^9, 3.704712610801402*^9}, {3.7047126551668043`*^9, 
   3.704712720771216*^9}, {3.7047127672194233`*^9, 3.704713028586548*^9}, {
   3.7047134059192677`*^9, 3.7047134065007153`*^9}, {3.704713475700178*^9, 
   3.704713568649652*^9}, {3.7047136561039877`*^9, 3.704713823239431*^9}, {
   3.704714404966012*^9, 3.704714488082521*^9}, {3.7047145546562757`*^9, 
   3.704714586734626*^9}, {3.704782815683482*^9, 3.704782830689183*^9}, {
   3.704782932016789*^9, 3.7047829339512377`*^9}, {3.704782991328405*^9, 
   3.704782994373556*^9}, 3.705059563606106*^9, 3.7064282442815247`*^9, 
   3.706431937129348*^9, {3.70660969881048*^9, 3.706609699538361*^9}, 
   3.706868393683447*^9, {3.7068687725561123`*^9, 3.7068687731385927`*^9}, {
   3.706946131375695*^9, 3.70694613463972*^9}, {3.7069468638770113`*^9, 
   3.7069468659969597`*^9}, {3.7069470713407593`*^9, 3.706947138509712*^9}, {
   3.7069471687474003`*^9, 3.706947183867805*^9}, {3.706947228478545*^9, 
   3.706947275331705*^9}, 3.706948192449707*^9, {3.706950567414859*^9, 
   3.7069505843993683`*^9}, {3.7069506432065697`*^9, 3.706950678406303*^9}, {
   3.706950737933709*^9, 3.706950741917148*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], " ", "+", " ", "A"}], " ", "\[Rule]",
      " ", 
     RowBox[{"A", "'"}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], "+", 
      RowBox[{"A", "[", 
       RowBox[{"m", ",", "N"}], "]"}]}], " ", "\[Rule]", " ", 
     RowBox[{"A", "[", 
      RowBox[{
       RowBox[{"m", "+", "1"}], ",", 
       RowBox[{"N", "+", "2"}]}], "]"}]}], " ", "*)"}],
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "map", " ", "of", " ", "indices", " ", "of", " ", "states", " ", "when", 
      " ", "a", " ", "D"}], ",", 
     RowBox[{
     "Phi", " ", "pair", " ", "combines", " ", "to", " ", "make", " ", "two", 
      " ", "singly", " ", "occupied", " ", "sites"}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"D", "&"}], "Phi", " ", "sites", " ", "turning", " ", "to", " ", 
    "active", " ", "go", " ", "to", " ", "the", " ", "end", " ", "of", " ", 
    "active", " ", 
    RowBox[{"list", "."}]}], "*)"}], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapDPhiA", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "ind1", ",", "ind2", ",", "listi", ",", "tab1", ",", "tab2",
          ",", "set1", ",", "listf"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"listf", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{"N", "+", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", 
               RowBox[{"k", "+", "1"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"listf", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"only", " ", "when", " ", 
                RowBox[{"(", 
                 RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
               RowBox[{"(", 
                RowBox[{"up", ",", "down"}], ")"}]}], ";", " ", 
              RowBox[{"when", " ", "they", " ", "go", " ", "to", " ", 
               RowBox[{"(", 
                RowBox[{"down", ",", "up"}], ")"}]}]}], ",", " ", 
             RowBox[{"add", " ", "1", " ", "in", " ", "the", " ", "indices"}],
              ",", " ", 
             RowBox[{
             "this", " ", "is", " ", "done", " ", "when", " ", "this", " ", 
              "map", " ", "is", " ", "used"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab1", ",", "x"}], "]"}], ";"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tab2", ",", 
              RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "tab1"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"only", " ", "a", " ", "sub"}], "-", 
     RowBox[{"block", " ", 
      RowBox[{"(", 
       RowBox[{"ntot1", " ", "x", " ", "ntot2"}], ")"}], " ", "of", " ", 
      "full", " ", "Ht", " ", 
      RowBox[{"(", 
       RowBox[{"ntot", " ", "x", " ", "ntot"}], ")"}]}]}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiA", "[", 
      RowBox[{"N_", ",", "m_", ",", "thh_", ",", "tll_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr1", ",", "pntr2", ",", "Hta", ",", "Htb", ",", "ind1", ",", 
         "ind2", ",", "ind2a", ",", "ind2b", ",", "coora", ",", "coorb", ",", 
         "ntot1", ",", "Htsp", ",", "ntot2", ",", "Hg", ",", "ind2sub", ",", 
         "ind1reptd"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"m", "+", "1"}]}], "}"}]}], "]"}], ",", "0", ",", 
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"maps", " ", "all", " ", "sectors", " ", 
           RowBox[{"(", 
            RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr1", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
              "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind2", "=", 
            RowBox[{
             RowBox[{"pntr2", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
             RowBox[{"mapDPhiA", "[", 
              RowBox[{"N", ",", "k"}], "]"}]}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{"shift", " ", "k", " ", "by", " ", "1"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ind2a", "=", 
            RowBox[{
             RowBox[{"{", "ind2", "}"}], "//", "Transpose"}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"th", ":", " ", 
              RowBox[{"(", 
               RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
             RowBox[{"(", 
              RowBox[{"up", ",", "down"}], ")"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ind2b", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ind2", " ", "+", "1"}], "}"}], "//", "Transpose"}]}], 
           ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"tl", ":", " ", 
              RowBox[{"(", 
               RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
             RowBox[{"(", 
              RowBox[{"down", ",", "up"}], ")"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Length", "[", "ind1", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind1", ",", "ind2a", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind1", ",", "ind2b", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsp", "=", 
         RowBox[{
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "thh"}], ",", 
            
            RowBox[{"{", 
             RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}], "+", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "tll"}], ",", 
            
            RowBox[{"{", 
             RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"mapHtApairs", ":", " ", 
        RowBox[{
        "for", " ", "Apairs", " ", "that", " ", "can", " ", "make", " ", 
         "D"}]}], " ", "&"}], " ", 
      RowBox[{"Phi", ":", " ", 
       RowBox[{
       "start", " ", "with", " ", "final", " ", "basis", " ", "combination", 
        " ", "and", " ", "add", " ", "two", " ", "sites", " ", "at", " ", 
        "appropriate", " ", "positions", " ", "in", " ", "the", " ", "list", 
        " ", "of", " ", "active", " ", "sites", " ", "with", " ", "one", " ", 
        "being", " ", "up", " ", "and", " ", "other", " ", "down"}]}]}], ",", 
     " ", 
     RowBox[{
     "and", " ", "calc", " ", "index", " ", "for", " ", "initial", " ", 
      "state"}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairs", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "x2", ",", "listi1", ",", "listi2", 
         ",", "tab1", ",", "tab2", ",", "set1", ",", "set2", ",", "listf1", 
         ",", "listf2", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"up", "/", "down"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf1", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set11", ",", 
                  RowBox[{"{", "n1", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"down", "/", "up"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf2", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set11", ",", 
                  RowBox[{"{", "n2", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"indices", " ", "for", " ", 
                RowBox[{"(", 
                 RowBox[{"N", ",", "k"}], ")"}], " ", "case"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf1", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"x2", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf2", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairs", "[", 
      RowBox[{
      "N_", ",", "m_", ",", "sapos_", ",", "th_", ",", "tl_", ",", "f_"}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "Htb", ",", 
         "coora", ",", "coorb", ",", "ntot1", ",", "tab1", ",", "tab2", ",", 
         "ind1", ",", "ind01", ",", "ind02", ",", "t1", ",", "t2", ",", 
         "Htsp"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->18], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"m", "-", "1"}]}], "}"}]}], "]"}], ",", "0", ",", 
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapHtApairs", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr1", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
              "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Length", "[", "tab1", "]"}], ",", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Length", "[", "tab2", "]"}], ",", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Htsph", "=", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"tl", " ", "+", " ", 
              RowBox[{"f", "*", "th"}]}], " ", ";", " ", 
             RowBox[{"f", " ", "=", " ", 
              RowBox[{
               RowBox[{"e", "^", 
                RowBox[{"(", 
                 RowBox[{"-", 
                  RowBox[{"\[Beta]E", ".", "r"}]}], ")"}]}], " ", "panelty", 
               " ", "for", " ", "hopping", " ", "to", " ", "left", " ", 
               "against", " ", "the", " ", "applied", " ", "bias"}]}], ";", 
             " ", 
             RowBox[{"E", " ", "elec", " ", "field"}]}], ",", " ", 
            RowBox[{"r", " ", "intersite", " ", "distance"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Htspl", "=", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
             RowBox[{"{", 
              RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";"}], " ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"f", "*", "tl"}], " ", "+", " ", "th"}], "  ", "*)"}], 
         "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"t1", "=", 
         RowBox[{"tl", " ", "+", " ", 
          RowBox[{"f", "*", "th"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t2", "=", 
         RowBox[{
          RowBox[{"f", "*", "tl"}], " ", "+", " ", "th"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsp", "=", 
         RowBox[{
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "t1"}], ",", 
            RowBox[{"{", 
             RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}], "+", 
          "\[IndentingNewLine]", 
          RowBox[{"SparseArray", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "t2"}], ",", 
            RowBox[{"{", 
             RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.704714608463573*^9, 3.70471460949757*^9}, {
  3.70471481279556*^9, 3.704714971927765*^9}, {3.704715004388317*^9, 
  3.704715105774981*^9}, {3.7047151717045116`*^9, 3.7047151728539743`*^9}, {
  3.7064384100016823`*^9, 3.706438425112146*^9}, {3.7068131670185537`*^9, 
  3.706813169284196*^9}, {3.70681674575072*^9, 3.7068167469519577`*^9}, {
  3.706817797704588*^9, 3.706817918201366*^9}, {3.706818043619362*^9, 
  3.706818203911108*^9}, {3.706818288436399*^9, 3.706818377951458*^9}, {
  3.706864653177023*^9, 3.7068647686967783`*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"D", "|", 
      RowBox[{"Phi", " ", "+", " ", "A"}]}], " ", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"D", "'"}], "|", 
      RowBox[{
       RowBox[{"Phi", "'"}], " ", "+", 
       RowBox[{"A", "'"}]}]}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{
    StyleBox[
     RowBox[{"(", "*"}]], " ", 
    RowBox[{
    "active", " ", "site", " ", "number", " ", "n", " ", "interacting", " ", 
     "with", " ", 
     RowBox[{"D", "/", "Phi"}]}], " ", 
    StyleBox[
     RowBox[{"*", ")"}]]}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DiagHt4DA", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_", ",", "th_", ",", "tl_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tab", ",", "listi"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tab", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\< DiagHt4DA --------------\>\"", "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\< DiagHt4DA,i=\>\"", ",", "i"}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"listi", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "n"}], "]"}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"tab", ",", "th"}], "]"}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"tab", ",", "tl"}], "]"}]}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";"}],
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab", ",", "tl"}], "]"}], ";"}]}], "\[IndentingNewLine]",
          "]"}], ";", "\[IndentingNewLine]", "tab"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtDA", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_", ",", "th_", ",", "tl_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "HtdiagDA", "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
         "make", " ", "Ht", " ", "diagonal", " ", "array", " ", "for", " ", 
          "all", " ", "up", " ", "spin", " ", "sectors"}], " ", "*)"}],
        FontSize->14], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HtdiagDA", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\< mkHtDA --------------\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\< mkHtDA k=\>\"", ",", "k"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"HtdiagDA", ",", 
             RowBox[{"DiagHt4DA", "[", 
              RowBox[{"N", ",", "k", ",", "n", ",", "th", ",", "tl"}], 
              "]"}]}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HtdiagDA", "=", 
         RowBox[{"Flatten", "[", "HtdiagDA", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DiagonalMatrix", "[", "HtdiagDA", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtPhiA", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_", ",", "th_", ",", "tl_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "HtdiagPhiA", "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
         "make", " ", "Ht", " ", "diagonal", " ", "array", " ", "for", " ", 
          "all", " ", "up", " ", "spin", " ", "sectors"}], " ", "*)"}],
        FontSize->14], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"HtdiagPhiA", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\< mkHtPhiA --------------\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\< mkHtPhiA k=\>\"", ",", "k"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"HtdiagPhiA", ",", 
             RowBox[{"DiagHt4DA", "[", 
              RowBox[{"N", ",", "k", ",", "n", ",", "tl", ",", "th"}], 
              "]"}]}], "]"}], ";"}], " ", "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"HtdiagPhiA", "=", 
         RowBox[{"Flatten", "[", "HtdiagPhiA", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"DiagonalMatrix", "[", "HtdiagPhiA", "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.704714605692195*^9, 3.704714606511086*^9}, 
   3.704715189590897*^9, {3.704715266480604*^9, 3.70471530918913*^9}, {
   3.704715378077791*^9, 3.7047155241027718`*^9}, {3.7047155592067633`*^9, 
   3.704715585667077*^9}, {3.7047156328381023`*^9, 3.704715634971611*^9}, {
   3.706437809745233*^9, 3.706437810043591*^9}, {3.706437966350472*^9, 
   3.706437982855814*^9}, {3.7064380413821917`*^9, 3.706438148162887*^9}, {
   3.706610228992169*^9, 3.706610238186537*^9}, {3.7066102782558727`*^9, 
   3.706610300757362*^9}, {3.706610488701654*^9, 3.7066105088850527`*^9}, 
   3.706610677055632*^9, 3.7066131136713943`*^9, {3.706613175927685*^9, 
   3.7066131763984632`*^9}, {3.7066136377566338`*^9, 3.706613646723262*^9}, 
   3.70661399003686*^9, {3.706614145985784*^9, 3.7066141591285152`*^9}, 
   3.706614237717515*^9, {3.706614366032309*^9, 3.706614435296002*^9}, {
   3.706614513574514*^9, 3.706614513836746*^9}, {3.706799254045383*^9, 
   3.706799302578809*^9}, {3.706799849416422*^9, 3.706799849766717*^9}, {
   3.706799991102371*^9, 3.706800013949761*^9}, {3.7068000774896927`*^9, 
   3.706800157080764*^9}, {3.70680023736928*^9, 3.7068002865113277`*^9}, {
   3.706818752629966*^9, 3.706818761529006*^9}, {3.706954524638692*^9, 
   3.7069546110749817`*^9}, {3.7069547370654573`*^9, 3.706954747402433*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[CapitalPi]", " ", "+", " ", "D"}], "|", 
      RowBox[{"Phi", " ", "+", " ", "A"}]}], " ", "\[Rule]", " ", 
     RowBox[{"\[CapitalPi]", " ", "+", " ", 
      RowBox[{"A", "'"}]}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{"Jh", ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Jl", " ", "for", " ", 
        RowBox[{"contacts", ":", " ", "\[IndentingNewLine]", 
         RowBox[{
         "no", " ", "interference", " ", "terms", " ", "for", " ", "the", " ",
           "contact", " ", "processes", " ", "btw", " ", "Jl"}]}]}], " ", 
       "&"}], " ", "Jh", "\[IndentingNewLine]", "So"}], ",", " ", 
     RowBox[{
     "just", " ", "deal", " ", "with", " ", "them", " ", "seperately"}]}], 
    "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  StyleBox[
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Jl", ":", " ", 
       RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
        RowBox[{"A", "[", 
         RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
      RowBox[{"\[CapitalPi]", " ", "+", " ", 
       RowBox[{"A", "[", 
        RowBox[{
         RowBox[{"N", "+", "1"}], ",", "m"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Jh", ":", " ", 
       RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
        RowBox[{"A", "[", 
         RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
      RowBox[{"\[CapitalPi]", " ", "+", " ", 
       RowBox[{"A", "[", 
        RowBox[{
         RowBox[{"N", "+", "1"}], ",", 
         RowBox[{"m", "+", "1"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
    StyleBox[
     RowBox[{"*", ")"}]]}],
   FontSize->14], 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"D", "/", "Phi"}], " ", "site", " ", "turning", " ", "to", " ", 
    "active", " ", "goes", " ", "to", " ", "the", " ", "end", " ", "of", " ", 
    "active", " ", 
    RowBox[{"list", "."}]}], "*)"}], "\[IndentingNewLine]", 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapCDA", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x1", ",", "x2", ",", "listi", ",", "tab1", ",", "tab2", ",", "set1", 
         ",", "listf"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"n", ",", "k"}], ")"}], ":", " ", "ind"}], " ", "=", " ", 
          
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"n", ",", "k"}], "]"}], "-", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"n", "-", 
                RowBox[{"listi", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", 
                   RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ",", 
               RowBox[{"k", "-", "j"}]}], " ", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "0", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"listf", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{"N", "+", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", "last", 
             " ", "position"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x1", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "1"}], ",", 
               RowBox[{"k", "+", "1"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1", "-", 
                  RowBox[{"listf", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
           " ", 
           RowBox[{"(*", " ", 
            RowBox[{"for", " ", "adding", " ", "an", " ", "up", " ", "site"}],
             " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "1"}], ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1", "-", 
                  RowBox[{"set1", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "for", " ", "adding", " ", "a", " ", "down", " ", "site"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "]"}]}], ";"}], 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapCA", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x1", ",", "x2", ",", "listi1", ",", "listi2", ",", "tab1", ",", 
         "tab2", ",", "set1", ",", "set2", ",", "listf", ",", "set11"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"add", " ", "an", " ", "up", " ", 
           RowBox[{"site", ":", " ", 
            RowBox[{"final", " ", "\[Equal]", ">", "  ", "N"}]}]}], ",", 
          "k"}], " ", "*)"}], "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "1"}], ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "nth", " ", "position"}], ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "as", " ", "they", " ", 
                  "should", " ", "be"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", " ", "by"}], " ", "+", 
                 RowBox[{"1", " ", "all", " ", "labels"}]}], " ", 
                "\[GreaterEqual]", " ", 
                RowBox[{
                "n", " ", "to", " ", "make", " ", "room", " ", "for", " ", 
                 "n"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set11", ",", 
                  RowBox[{"{", "n", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "for", " ", "adding", " ", "an", " ", "up", " ", "site"}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"add", " ", "a", " ", "down", " ", 
           RowBox[{"site", ":", " ", 
            RowBox[{"final", " ", "\[Equal]", ">", "  ", "N"}]}]}], ",", 
          "k"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"listi2", "=", 
         RowBox[{"comb", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", "k"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set2", "=", 
            RowBox[{"listi2", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"set11", "=", 
            RowBox[{"set2", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"q_Integer", "/;", 
                RowBox[{"q", "\[GreaterEqual]", " ", "n"}]}], "\[Rule]", 
               RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"shift", " ", "by"}], " ", "+", 
              RowBox[{"1", " ", "all", " ", "labels"}]}], " ", 
             "\[GreaterEqual]", " ", 
             RowBox[{
             "n", " ", "to", " ", "make", " ", "room", " ", "for", " ", 
              "n"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{"N", ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", 
                  RowBox[{"set2", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "for", " ", "adding", " ", "a", " ", "down", " ", "site"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi2", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Seperate", " ", "blocks", " ", "of", " ", "Jh"}], ",", 
     RowBox[{
      RowBox[{"Jl", " ", "terms"}], ";", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
        "for", " ", "makeHtCPhiA", " ", "just", " ", "switch", " ", "Jh"}], 
        "&"}], "Jl", " ", "in", " ", "the", " ", "two", " ", "blocks"}]}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtCDA", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "pntr2", ",", "ind0", ",", "ntot0", ",", 
         "Hta", ",", "Htb", ",", "ind1", ",", "ind2", ",", "coora", ",", 
         "coorb", ",", "ntot1", ",", "Htsph", ",", "Htspl", ",", "ntot2", ",",
          "tab1", ",", "tab2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"m", "+", "1"}]}], "}"}]}], "]"}], ",", "0", ",", 
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ind0", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
              "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapCDA", "[", 
             RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"pntr1", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", "tab1"}]}], ";", 
           " ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"m", "+", 
              RowBox[{"1", " ", "final", " ", "excitations"}]}], ";", " ", 
             RowBox[{
             "shift", " ", "k", " ", "by", " ", "1", " ", "bcs", " ", "one", 
              " ", "up", " ", "spin", " ", "added"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ind2", "=", 
            RowBox[{
             RowBox[{"pntr2", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}]}], ";", 
           " ", 
           RowBox[{"(*", " ", 
            RowBox[{"m", " ", "final", " ", "excitations"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"{", "ind1", "}"}], "//", "Transpose"}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"Jh", " ", "for", " ", "D"}], ",", " ", 
             RowBox[{"Jl", " ", "for", " ", 
              RowBox[{"Phi", ":", " ", 
               RowBox[{"up", " ", "added"}]}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"ind2", "=", 
            RowBox[{
             RowBox[{"{", "ind2", "}"}], "//", "Transpose"}]}], ";", "  ", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"Jl", " ", "for", " ", "D"}], ",", " ", 
             RowBox[{"Jh", " ", "for", " ", 
              RowBox[{"Phi", ":", " ", 
               RowBox[{"dn", " ", "added"}]}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Length", "[", "tab1", "]"}], ",", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind0", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Length", "[", "tab2", "]"}], ",", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind0", ",", "ind2", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "Hta", "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Hta", ",", "1"}], "]"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Htb", ",", "1"}], "]"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"Htsph", "//", "MatrixForm"}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"Htspl", "//", "MatrixForm"}], "]"}], ";"}], 
         "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Jh", ":", " ", 
        StyleBox[
         RowBox[{"\[CapitalPi]", " ", "+", " ", 
          RowBox[{"A", "[", 
           RowBox[{"N", ",", "m"}], "]"}]}],
         FontSize->12]}], 
       StyleBox[" ",
        FontSize->12], 
       StyleBox["\[Rule]",
        FontSize->12], 
       StyleBox[" ",
        FontSize->12], 
       StyleBox[
        RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
         RowBox[{"A", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", 
           RowBox[{"m", "-", "1"}]}], "]"}]}],
        FontSize->12]}], 
      StyleBox[";",
       FontSize->12], 
      StyleBox["\[IndentingNewLine]",
       FontSize->12], 
      StyleBox[
       RowBox[{
        RowBox[{"Jl", ":", " ", 
         RowBox[{"\[CapitalPi]", " ", "+", " ", 
          RowBox[{"A", "[", 
           RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
        RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
         RowBox[{"A", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", "m"}], "]"}]}]}],
       FontSize->12], 
      StyleBox[";",
       FontSize->12], 
      StyleBox["\[IndentingNewLine]",
       FontSize->12], 
      StyleBox[
       RowBox[{"For", " ", "Phi", " ", "case"}],
       FontSize->12]}], 
     StyleBox[",",
      FontSize->12], 
     StyleBox[" ",
      FontSize->12], 
     StyleBox[
      RowBox[{
       RowBox[{
        RowBox[{"switch", " ", "Jh"}], " ", "&"}], " ", "Jl"}],
      FontSize->12]}], 
    StyleBox["\[IndentingNewLine]",
     FontSize->24], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtCA", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "pntr2", ",", "ntot0", ",", "ntot2", ",", 
         "Hta", ",", "Htb", ",", "coora", ",", "coorb", ",", "ntot1", ",", 
         "Htsph", ",", "Htspl", ",", "tab1", ",", "tab2", ",", "ind1", ",", 
         "ind2", ",", "ind01", ",", "ind02"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"m", "-", "1"}]}], "}"}]}], "]"}], ",", "0", ",", 
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapCA", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "indices", " ", "list", " ", "of", " ", "final", " ", "states"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"m", "-", 
             RowBox[{"1", " ", 
              RowBox[{"case", ":", " ", 
               RowBox[{"up", " ", "removed"}]}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"k", ">", "0"}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "ind01", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "1"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"m", " ", 
             RowBox[{"case", ":", " ", 
              RowBox[{"down", " ", "removed"}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "ind02", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr2", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "1"}], ",", "k"}], "]"}]}], "}"}]}], 
                   "]"}]}], "}"}], "//", "Transpose"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind2", ",", "2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Jh", " ", "for", " ", "D"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Jl", " ", "for", " ", "D"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.70471564222936*^9, 3.7047156855868073`*^9}, {
   3.7047191062514963`*^9, 3.704719418479579*^9}, {3.704719454765753*^9, 
   3.704719526880319*^9}, {3.704719674229658*^9, 3.704719759433659*^9}, {
   3.704719818094739*^9, 3.7047198776109247`*^9}, {3.70471991904065*^9, 
   3.7047199195826073`*^9}, {3.7047203268111467`*^9, 3.704720368011285*^9}, {
   3.7047205085383177`*^9, 3.704720671741027*^9}, {3.704720758609118*^9, 
   3.704721039764311*^9}, {3.704721071300601*^9, 3.7047210981088247`*^9}, {
   3.704721153763069*^9, 3.704721236799212*^9}, {3.704721269338023*^9, 
   3.704721343923912*^9}, {3.704721395970655*^9, 3.7047218199225597`*^9}, {
   3.704721850056509*^9, 3.704722037584683*^9}, {3.704727776615264*^9, 
   3.704727810564814*^9}, {3.7047278441354847`*^9, 3.704727876414362*^9}, {
   3.7047279563583937`*^9, 3.704728019820174*^9}, {3.70472805641049*^9, 
   3.704728204411796*^9}, {3.704728241204834*^9, 3.704728241946953*^9}, 
   3.704728572905858*^9, 3.704728617065422*^9, {3.7047286653276033`*^9, 
   3.704728739727767*^9}, 3.7047288167066507`*^9, {3.704728887102583*^9, 
   3.704728888324421*^9}, {3.704728920831266*^9, 3.704729013790954*^9}, {
   3.704729064373402*^9, 3.704729066155026*^9}, {3.704729143128038*^9, 
   3.704729229710351*^9}, {3.704729303345982*^9, 3.704729318799469*^9}, {
   3.7047294065699177`*^9, 3.7047294604975853`*^9}, {3.704730172085589*^9, 
   3.704730499832035*^9}, {3.7047305305122557`*^9, 3.704730682414982*^9}, {
   3.704730721280636*^9, 3.704730916654707*^9}, {3.704730948602818*^9, 
   3.704731016057343*^9}, {3.7047310543991137`*^9, 3.704731065367305*^9}, {
   3.7047310954752083`*^9, 3.704731155786722*^9}, {3.704731202823576*^9, 
   3.704731301445259*^9}, {3.704731370471816*^9, 3.704731455828702*^9}, {
   3.704731499901173*^9, 3.7047315044032927`*^9}, {3.704731563617034*^9, 
   3.704731583635262*^9}, {3.704731657586863*^9, 3.704731680366177*^9}, {
   3.704731764884695*^9, 3.704731793824237*^9}, {3.704731957908206*^9, 
   3.704732016033313*^9}, {3.7047320850714273`*^9, 3.7047321798392687`*^9}, {
   3.70473223800521*^9, 3.704732293191122*^9}, {3.704732329334921*^9, 
   3.704732438400197*^9}, 3.704732949431288*^9, {3.704733072926655*^9, 
   3.7047331485418653`*^9}, {3.7047331999677753`*^9, 3.704733204317116*^9}, {
   3.704733257075979*^9, 3.70473325742607*^9}, {3.704733324615559*^9, 
   3.704733357012047*^9}, {3.704733403681177*^9, 3.704733407104433*^9}, {
   3.7047335753570232`*^9, 3.70473369313955*^9}, {3.704733730938693*^9, 
   3.704733760555891*^9}, {3.7047338052006273`*^9, 3.70473391253232*^9}, 
   3.7047339657312517`*^9, {3.70473401154243*^9, 3.704734081029595*^9}, {
   3.704734142587965*^9, 3.704734182626317*^9}, {3.704734354738261*^9, 
   3.704734398846651*^9}, {3.7047344321760273`*^9, 3.704734440787003*^9}, {
   3.704734522332786*^9, 3.704734529040741*^9}, 3.7047345637679567`*^9, {
   3.704734825475895*^9, 3.704734865649213*^9}, {3.704734957066861*^9, 
   3.704734974305592*^9}, {3.706438210546567*^9, 3.70643821123533*^9}, {
   3.706438274597365*^9, 3.706438274971569*^9}, {3.7064383336786222`*^9, 
   3.706438385459832*^9}, {3.706438441165269*^9, 3.7064384523734694`*^9}, {
   3.7064385405640917`*^9, 3.706438541378409*^9}, {3.706439278209345*^9, 
   3.706439388369965*^9}, {3.7064395376036243`*^9, 3.706439682416197*^9}, {
   3.7064410229414*^9, 3.706441029828095*^9}, {3.706441365098935*^9, 
   3.706441393002801*^9}, {3.706441490904954*^9, 3.706441623310816*^9}, {
   3.7064416568777857`*^9, 3.706441681874051*^9}, {3.706441745378821*^9, 
   3.706441753343813*^9}, {3.706442000271967*^9, 3.706442021422934*^9}, {
   3.706442090656695*^9, 3.7064421053753*^9}, {3.706515704110898*^9, 
   3.706515725101399*^9}, {3.706802422251617*^9, 3.706802432615049*^9}, {
   3.706802472914536*^9, 3.7068024790773983`*^9}, {3.7068025105851727`*^9, 
   3.706802515818658*^9}, {3.706802743553348*^9, 3.7068027479638977`*^9}, {
   3.706802785264496*^9, 3.706802802549424*^9}, {3.706802856431629*^9, 
   3.70680286517148*^9}, {3.7068029268020573`*^9, 3.706802933805621*^9}, {
   3.7068030365109797`*^9, 3.7068030367680473`*^9}, {3.706803069592495*^9, 
   3.70680309755938*^9}, {3.7068031612350063`*^9, 3.7068031794895077`*^9}, {
   3.706803216862616*^9, 3.706803232270884*^9}, {3.70681153052369*^9, 
   3.70681153951023*^9}, {3.706811651516204*^9, 3.706811678288537*^9}, {
   3.7068117647445927`*^9, 3.706811774520339*^9}, {3.706811996837727*^9, 
   3.706811997881351*^9}, {3.706812321633912*^9, 3.7068123346460953`*^9}, {
   3.706812371676209*^9, 3.706812376697806*^9}, {3.706818736052601*^9, 
   3.7068187380377502`*^9}, {3.7068644966719227`*^9, 3.706864624382072*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapGamma", "[", 
     RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "listi", ",", "tab1", ",", "set1", ",", "setf"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab1", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"listi", "=", 
        RowBox[{"comb", "[", 
         RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"set1", "=", 
           RowBox[{"listi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"set1", ",", "n"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"setf", "=", 
              RowBox[{"Complement", "[", 
               RowBox[{"set1", ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", 
                 RowBox[{"k", "-", "1"}]}], "]"}], "-", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{
                   RowBox[{"N", "-", 
                    RowBox[{"setf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                   RowBox[{"k", "-", "1", "-", "p"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"p", ",", "0", ",", 
                   RowBox[{"k", "-", "2"}]}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tab1", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "x"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "tab1"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HtGamma", "[", 
     RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr1", ",", "Hta", ",", "ind1", ",", "ind2", ",", "coora", ",", 
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "inds"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "just", " ", "to", " ", "be", " ", "consistent", " ", "with", " ", 
         "pther", " ", "functions", " ", "styles"}], ",", " ", 
        RowBox[{"insert", " ", "0", " ", "at", " ", "1"}], ",", " ", 
        RowBox[{
        "otherwise", " ", "we", " ", "dont", " ", "need", " ", "it", " ", 
         "here", " ", "if", " ", "we", " ", "modify", " ", "the", " ", 
         "lines", " ", "appropriately"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"pntr1", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", "0", ",",
           "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot1", "=", 
        RowBox[{"pntr1", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot2", "=", 
        RowBox[{"pntr1", "[", 
         RowBox[{"[", 
          RowBox[{"-", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"maps", " ", "all", " ", "sectors", " ", 
          RowBox[{"(", 
           RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Hta", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"k", ">", 
          RowBox[{"0", " ", "only"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"inds", "=", 
           RowBox[{"MapGamma", "[", 
            RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", 
                RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ind2", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", "k", "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"ind1", ",", "ind2", ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "m"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Htsp", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HtKappa", "[", 
     RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"Hta", ",", "ntot1", ",", "Htsp", ",", "ntot2", ",", "nsec1"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"maps", " ", "all", " ", "sectors", " ", 
         RowBox[{"(", 
          RowBox[{"up", " ", "spins"}], ")"}], " ", "at", " ", "once"}], ";", 
        " ", "\[IndentingNewLine]", 
        RowBox[{
        "just", " ", "remove", " ", "the", " ", "max", " ", "photon", " ", 
         "sector", " ", "and", " ", "shift", " ", "all", " ", "the", " ", 
         "indices"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nsec1", "=", 
        RowBox[{"c", "[", 
         RowBox[{"N", ",", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot2", "=", 
        RowBox[{"Sum", "[", 
         RowBox[{
          RowBox[{"c", "[", 
           RowBox[{"N", ",", "j"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "0", ",", 
            RowBox[{"m", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ntot1", "=", 
        RowBox[{"nsec1", "+", "ntot2"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Hta", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"nsec1", "+", "i"}], ",", "i"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Htsp", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"Hta", "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.706008279353135*^9, 3.706008323221632*^9}, {
  3.706008363678896*^9, 3.706008619898666*^9}, {3.706008663709818*^9, 
  3.7060087165583963`*^9}, {3.7068127605881157`*^9, 3.7068127626663427`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Functions", " ", "to", " ", "be", " ", "used", " ", "for", " ", 
    "calculating", " ", "U", " ", "or", " ", "rates", " ", "for", " ", "bulk",
     " ", "and", " ", "contact", " ", 
    RowBox[{"processes", ":", "\[IndentingNewLine]", 
     StyleBox["Diagonalisation",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"DiagH", "\[IndentingNewLine]", "--"}], "--"}], "-", " ", 
      StyleBox[
       RowBox[{
        RowBox[{"Bulk", " ", "--"}], "--"}],
       FontSize->14,
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
      "makeHtDPhiA", "\[IndentingNewLine]", "mkHtDA", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mkHtPhiA", "\[IndentingNewLine]", "--"}], "--"}]}], "-", " ", 
      StyleBox[
       RowBox[{
        RowBox[{
         StyleBox["Contact",
          FontSize->16], 
         StyleBox[" ",
          FontSize->14], 
         StyleBox["--",
          FontSize->14]}], 
        StyleBox["--",
         FontSize->14]}],
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->16,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"makeHtCDA", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"makeHtCA", "\[IndentingNewLine]", "--"}], "--"}]}], "-", " ", 
      StyleBox[
       RowBox[{"Excirton", " ", "nondariative", " ", 
        RowBox[{
         RowBox[{"decays", " ", "--"}], "--"}]}],
       FontSize->14,
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"HtGamma", "\[IndentingNewLine]", "--"}], "--"}], "-", " ", 
      StyleBox[
       RowBox[{
        StyleBox["Cavity",
         FontSize->16], 
        StyleBox[" ",
         FontSize->16], 
        RowBox[{
         RowBox[{
          StyleBox["leakages",
           FontSize->16], 
          StyleBox[" ",
           FontSize->14], 
          StyleBox["--",
           FontSize->14]}], 
         StyleBox["--",
          FontSize->14]}]}],
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox["\[IndentingNewLine]",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox["HtKappa",
      FontSize->14]}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7047824263320303`*^9, 3.7047826101241713`*^9}, {
   3.7047826627965603`*^9, 3.704782672523602*^9}, {3.7047830158934593`*^9, 
   3.704783037396736*^9}, 3.704783154865097*^9, {3.7047997871680937`*^9, 
   3.704799948378956*^9}, {3.704800453010667*^9, 3.704800460915769*^9}, {
   3.70600731263883*^9, 3.706007405947576*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OneDLatticeWays", "[", 
    RowBox[{"Ntot_", ",", "Ds_", ",", "Phis_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "DhopsR", ",", "DhopsL", ",", "DPhiR", ",", "DPhiL", ",", 
       "\[IndentingNewLine]", "PhihopsR", ",", "PhihopsL", ",", "CDhopsR", 
       ",", "CDhopsL", ",", "\[IndentingNewLine]", "CPhihopsR", ",", 
       "CPhihopsL", ",", "LDs", ",", "LPhis", ",", "xD", ",", "xPhi", ",", 
       "Apairs", ",", "CAR", ",", "CAL"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"DhopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DhopsL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DPhiR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DPhiL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PhihopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"PhihopsL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CDhopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CDhopsL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CPhihopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CPhihopsL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CAL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CAR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"Apairs", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LDs", "=", 
       RowBox[{"Length", "[", "Ds", "]"}]}], ";", 
      RowBox[{"LPhis", "=", 
       RowBox[{"Length", "[", "Phis", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"find", " ", 
        RowBox[{"R", "/", "L"}], " ", "hops", " ", "for", " ", "Ds", " ", 
        "and", " ", "DPhi", " ", 
        RowBox[{"R", "/", "L"}], " ", "pairs"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"LDs", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"xD", "=", 
             RowBox[{"Ds", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"Phis", ",", 
                RowBox[{"xD", "+", "1"}]}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"DPhiR", ",", "xD"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"xD", "\[NotEqual]", " ", "Ntot"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xD", "+", "1"}]}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"DhopsR", ",", "xD"}], "]"}]}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"Phis", ",", 
                RowBox[{"xD", "-", "1"}]}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"DPhiL", ",", "xD"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"xD", "\[NotEqual]", " ", "1"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xD", "-", "1"}]}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"DhopsL", ",", "xD"}], "]"}]}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xD", "\[Equal]", "1"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CDhopsL", ",", "xD"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xD", "\[Equal]", "Ntot"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CDhopsR", ",", "xD"}], "]"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "LDs"}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"find", " ", 
        RowBox[{"R", "/", "L"}], " ", "hops", " ", "for", " ", "Phis"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"LPhis", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"xPhi", "=", 
             RowBox[{"Phis", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"Phis", ",", 
                 RowBox[{"xPhi", "+", "1"}]}], "]"}], "&&", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"Ds", ",", 
                 RowBox[{"xPhi", "+", "1"}]}], "]"}], "&&", 
               RowBox[{"xPhi", "\[NotEqual]", " ", "Ntot"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"PhihopsR", ",", "xPhi"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Phis", ",", 
                   RowBox[{"xPhi", "-", "1"}]}], "]"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xPhi", "-", "1"}]}], "]"}], "&&", 
                 RowBox[{"xPhi", "\[NotEqual]", " ", "1"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"PhihopsL", ",", "xPhi"}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xPhi", "\[Equal]", "1"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CPhihopsL", ",", "xPhi"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xPhi", "\[Equal]", "Ntot"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CPhihopsR", ",", "xPhi"}], "]"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "LPhis"}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Apairs", ",", "CAR", ",", "CAL"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{"Ds", ",", "Phis"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"i", "+", "1"}]}], "}"}]}], "]"}], "\[Equal]", 
            RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Apairs", ",", "i"}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Ntot", "-", "1"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"Ds", ",", "1"}], "]"}], "&&", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"Phis", ",", "1"}], "]"}]}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"CAL", ",", "1"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"Ds", ",", "Ntot"}], "]"}], "&&", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"Phis", ",", "Ntot"}], "]"}]}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"CAR", ",", "Ntot"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
        "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", ",", 
        "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", "Apairs", ",", 
        "CAR", ",", "CAL"}], "}"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.70504549896553*^9, 3.705045738333622*^9}, {
   3.7050459115832577`*^9, 3.705046086369945*^9}, {3.705046130336101*^9, 
   3.705046172779091*^9}, {3.705046294684167*^9, 3.705046299490814*^9}, {
   3.705046371353319*^9, 3.705046500346755*^9}, {3.705046539381912*^9, 
   3.7050466500251207`*^9}, {3.705046700575245*^9, 3.7050467620844193`*^9}, {
   3.705046800540766*^9, 3.705046944985491*^9}, {3.7050469782268953`*^9, 
   3.705046988922833*^9}, {3.705047051752363*^9, 3.7050471939504833`*^9}, 
   3.7050472281104507`*^9, {3.7050478066942387`*^9, 3.7050478986858377`*^9}, {
   3.705048102249098*^9, 3.7050481047664824`*^9}, {3.705052455795651*^9, 
   3.7050527390715227`*^9}, {3.705052785578511*^9, 3.7050528516235447`*^9}, {
   3.7050529231804447`*^9, 3.705052925059116*^9}, {3.705053012748419*^9, 
   3.7050530469463987`*^9}, {3.705053121446436*^9, 3.705053170152327*^9}, {
   3.705053206939783*^9, 3.705053233072888*^9}, {3.705053279595809*^9, 
   3.705053285298525*^9}, {3.70505332284449*^9, 3.705053609473242*^9}, {
   3.705053655663692*^9, 3.7050537175234528`*^9}, {3.705063549877873*^9, 
   3.705063621473752*^9}, {3.705063651783477*^9, 3.705063721915572*^9}, {
   3.705063850919243*^9, 3.705063954969331*^9}, {3.7050640256499577`*^9, 
   3.705064101178584*^9}, 3.705064170206635*^9, {3.7064423849993763`*^9, 
   3.706442393508955*^9}, {3.706463696755846*^9, 3.706463759886174*^9}, {
   3.706463820027171*^9, 3.706463957507036*^9}, {3.706464004439618*^9, 
   3.706464017741399*^9}, {3.706464066363737*^9, 3.706464161461872*^9}, {
   3.70646426522556*^9, 3.7064642716284122`*^9}, {3.706464471269825*^9, 
   3.7064644780420513`*^9}, {3.706464539328771*^9, 3.706464568201128*^9}, 
   3.706464598777768*^9, 3.706464728511417*^9}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"SecRates", "[", 
     RowBox[{"Elevels_", ",", "rate_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i1", ",", "i2", ",", "Rlist", ",", "x", ",", "deg", ",", "nlevels", 
        ",", "r"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"i1", "=", "0"}], ";", 
       RowBox[{"i2", "=", "0"}], ";", 
       RowBox[{"x", "=", "0"}], ";", 
       RowBox[{"Rlist", "=", 
        RowBox[{"{", "0", "}"}]}], ";", 
       RowBox[{"deg", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nlevels", "=", 
        RowBox[{"Length", "[", "Elevels", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"i2", "+=", 
           RowBox[{"Elevels", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"deg", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", "i2"}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"r", "=", 
           RowBox[{"rate", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"i1", "+", "1"}], ";;", "i2"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"x", "+=", 
           RowBox[{
            RowBox[{"Norm", "[", "r", "]"}], "^", "2"}]}], ";", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Rlist", ",", "x"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"i1", "=", "i2"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"Rlist", ",", "deg"}], "}"}]}]}], "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.706442387793564*^9, 3.706442389499921*^9}, {
  3.706597405116604*^9, 3.706597407575985*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"trajectory", "[", 
    RowBox[{
    "Ntot_", ",", "vars_", ",", "gg_", ",", "th_", ",", "tl_", ",", "Jh_", 
     ",", "Jl_", ",", "kappa_", ",", "gamma_", ",", "boltzfactor_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "UNm", ",", "UNp1mp1", ",", "UNm1mm1", ",", "UNp1m", ",", "UNm1m", ",", 
       "HtDA", ",", "RDA", ",", "HtPhiA", ",", "RPhiA", ",", "HtDPhiA", ",", 
       "UNp2mp1", ",", "RDPhiA", ",", "HtDPhiAinv", ",", "UNm2mm1", ",", 
       "RDPhiAinv", ",", "HtCDAh", ",", "HtCDAl", ",", "RCDAh", ",", "RCDAl", 
       ",", "HtCAh", ",", "HtCAl", ",", "RCAh", ",", "RCAl", ",", "Es", ",", 
       "\[IndentingNewLine]", "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", 
       "PhihopsL", ",", "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", 
       "CDhopsR", ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", 
       "Apairs", ",", "CAR", ",", "CAL", ",", "Cproc", ",", "CDAproc", ",", 
       "\[IndentingNewLine]", "RDAM", ",", "RPhiAM", ",", "RDPhiAM", ",", 
       "RDPhiAinvM", ",", "RCDAhM", ",", "RCDAlM", ",", "RCAhM", ",", "RCAlM",
        ",", "n", ",", "Ds", ",", "Phis", ",", "m", ",", "ASites", ",", 
       "\[IndentingNewLine]", "ENm", ",", "ENp1mp1", ",", "ENm1mm1", ",", 
       "ENp1m", ",", "ENm1m", ",", "ENp2mp1", ",", "ENm2mm1", ",", "Elevels", 
       ",", "times", ",", "tmax", ",", "t", ",", "dt", ",", "R", ",", "ldr", 
       ",", "ldl", ",", "lpr", ",", "lpl", ",", "\[IndentingNewLine]", 
       "lApairs", ",", "si1", ",", "si2", ",", "sapos", ",", "lcdr", ",", 
       "lcdl", ",", "lcpr", ",", "lcpl", ",", "lcdaproc", ",", 
       "\[IndentingNewLine]", "lcar", ",", "lcal", ",", "CAproc", ",", "lcAp",
        ",", "r1", ",", "r1b", ",", "r2", ",", "r2b", ",", "r3", ",", "r4", 
       ",", "r5", ",", "r6", ",", "r7", ",", "r8", ",", "r9", ",", "r10", ",",
        "r11", ",", "r12", ",", "r13", ",", "r14", ",", "\[IndentingNewLine]",
        "r1z", ",", "r1bz", ",", "r2z", ",", "r2bz", ",", "r3z", ",", "r4z", 
       ",", "r5x", ",", "r6x", ",", "x1", ",", "x2", ",", "r9xh", ",", "r9xl",
        ",", "r10xh", ",", "r10xl", ",", "r11xh", ",", "r11xl", ",", "r12xh", 
       ",", "r12xl", ",", "\[IndentingNewLine]", "r9i", ",", "r10i", ",", 
       "r11i", ",", "r12i", ",", "rcd", ",", "rcp", ",", "rcdi", ",", "rcpi", 
       ",", "r14z", ",", "\[IndentingNewLine]", "HtDAR", ",", "HtDAL", ",", 
       "RDAR", ",", "RDAL", ",", "HtPhiAR", ",", "RPhiAR", ",", "HtPhiAL", 
       ",", "RPhiAL", ",", "\[IndentingNewLine]", "HtApairs", ",", "ENmm1", 
       ",", "UNmm1", ",", "RkappaM", " ", ",", "Rkappa", ",", "Rgamma", ",", 
       "rates", ",", "totrates", ",", "\[IndentingNewLine]", "ltotr", ",", 
       "slist", ",", "u", ",", "eta", ",", "whichjump", ",", "process", ",", 
       "lp", ",", "whichstates", ",", "pos", ",", "apos", ",", "whichsites", 
       ",", "rate", ",", "\[IndentingNewLine]", "ldpr", ",", "ldpl", ",", 
       "nlevels", ",", "Rlist", ",", "degen", ",", "whichsec", ",", "psif", 
       ",", "i1", ",", "i2", ",", "xtot", ",", "Dsvst", ",", "Phisvst", ",", 
       "mvst", ",", "Neig", ",", "istate", ",", "psi", ",", 
       "\[IndentingNewLine]", "ldpa", ",", "ldacproc", ",", "NN", ",", "p1", 
       ",", "p2", ",", "ITER"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Ds", ",", "Phis", ",", "m", ",", "tmax"}], "}"}], "=", 
       "vars"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t", "=", "0"}], ";", 
      RowBox[{"times", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Dsvst", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"Phisvst", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"mvst", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ITER", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"t", "<", "tmax"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<*************** ITERATION # \>\"", ",", "ITER"}], 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "starting", " ", "list", " ", "of", " ", "active", " ", "sites"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ASites", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "Ntot"}], "}"}]}], "]"}], ",", 
            "Ds", ",", "Phis"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ITER", "\[Equal]", "0"}], ",", 
           RowBox[{"NN", "=", 
            RowBox[{"Length", "[", "ASites", "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", " ", 
           RowBox[{"m", ",", 
            RowBox[{"NN", " ", "state"}]}], " ", "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"ENm", ",", "UNm"}], "}"}], "=", 
          RowBox[{"DiagH", "[", 
           RowBox[{"NN", ",", "m", ",", "gg"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<ENm: \>\"", ",", "ENm"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "start", " ", "with", " ", "the", " ", "lowest", " ", 
           "eigenstate"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ITER", "\[Equal]", "0"}], ",", 
           RowBox[{"psi", "=", 
            RowBox[{"UNm", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<ASites: \>\"", ",", "ASites", ",", "\"\< NN: \>\"", ",", 
           "NN"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"ITER", "+=", "1"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", "getrates", "*)"}],
          FontSize->24], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"get", " ", 
           RowBox[{"Ht", ".", "Ufinal"}], " ", "matrices", " ", "for", " ", 
           "rates"}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "site", " ", "indices", " ", "for", " ", "various", " ", 
            "processes", " ", "can", " ", "occur"}], ";", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"no", ".", " ", "of"}], " ", "ways"}], " ", "=", " ", 
            RowBox[{"lengths", " ", "of", " ", "out", " ", "arrays"}]}]}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
            "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", ",",
             "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", "Apairs", 
            ",", "CAR", ",", "CAL"}], "}"}], "=", 
          RowBox[{"OneDLatticeWays", "[", 
           RowBox[{"Ntot", ",", "Ds", ",", "Phis"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"Print", "[", 
          RowBox[{"\"\<ways: \>\"", ",", 
           RowBox[{"{", 
            RowBox[{
            "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
             "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", 
             ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", 
             "Apairs", ",", "CAR", ",", "CAL"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", 
           RowBox[{"Bulk", " ", "Processes"}], "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"D", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"D", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "DhopsR", "]"}], ">", "0"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", "DhopsL", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"RDAM", "=", 
               RowBox[{
                RowBox[{"mkHtDA", "[", 
                 RowBox[{"NN", ",", "m", ",", "th", ",", "tl"}], "]"}], ".", 
                RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Nstates", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
               RowBox[{
                RowBox[{"Dimensions", "[", "RDAM", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"D", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"D", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ldr", "=", 
          RowBox[{"Length", "[", "DhopsR", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc HtDAR[i], i= \>\"", ",", "i"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"DhopsR", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "+", "1"}]}], "]"}], 
              " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"HtDAR", "[", "i", "]"}], "=", 
             RowBox[{"mkHtDA", "[", 
              RowBox[{"NN", ",", "m", ",", "n", ",", "th", ",", "tl"}], 
              "]"}]}], ";"}], 
           RowBox[{"(*", 
            RowBox[{"clear", " ", "old", " ", 
             RowBox[{"elem", "?"}]}], "*)"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"ldl", "=", 
          RowBox[{"Length", "[", "DhopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc HtDAL[i], i= \>\"", ",", "i"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"DhopsL", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "-", "1"}]}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "left", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"HtDAL", "[", "i", "]"}], "=", 
             RowBox[{"mkHtDA", "[", 
              RowBox[{"NN", ",", "m", ",", "n", ",", "th", ",", "tl"}], 
              "]"}]}], ";"}], 
           RowBox[{"(*", 
            RowBox[{"clear", " ", "old", " ", 
             RowBox[{"elem", "?"}]}], "*)"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Phi", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"Phi", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "PhihopsR", "]"}], ">", "0"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", "PhihopsL", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"RPhiAM", "=", 
               RowBox[{
                RowBox[{"mkHtPhiA", "[", 
                 RowBox[{"NN", ",", "m", ",", "th", ",", "tl"}], "]"}], ".", 
                RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"lpr", "=", 
          RowBox[{"Length", "[", "PhihopsR", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<PhihopsR: \>\"", ",", "PhihopsR"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc HtPhiAR[i], i= \>\"", ",", "i"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"PhihopsR", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "+", "1"}]}], "]"}], 
              "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "Phi"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"HtPhiAR", "[", "i", "]"}], "=", 
             RowBox[{"mkHtPhiA", "[", 
              RowBox[{"NN", ",", "m", ",", "n", ",", "th", ",", "tl"}], 
              "]"}]}], ";"}], 
           RowBox[{"(*", 
            RowBox[{"clear", " ", "old", " ", 
             RowBox[{"elem", "?"}]}], "*)"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"lpl", "=", 
          RowBox[{"Length", "[", "PhihopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<PhihopsL: \>\"", ",", "PhihopsL"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc HtPhiAL[i], i= \>\"", ",", "i"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xx", "=", 
             RowBox[{"PhihopsL", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<--------- xx=\>\"", ",", "xx"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"\"\<ASites: \>\"", ",", "ASites"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{"xx", " ", "-", "1"}]}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "left", " ", "of", " ", 
              "Phi"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Print", "[", "\"\<--------- xxxxxxx\>\"", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"HtPhiAL", "[", "i", "]"}], "=", 
             RowBox[{"mkHtPhiA", "[", 
              RowBox[{"NN", ",", "m", ",", "n", ",", "th", ",", "tl"}], 
              "]"}]}], ";"}], 
           RowBox[{"(*", 
            RowBox[{"clear", " ", "old", " ", 
             RowBox[{"elem", "?"}]}], "*)"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], "+", "A"}], "\[Rule]", " ", 
           "A"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "DPhiR", "]"}], ">", "0"}], "||", 
            RowBox[{
             RowBox[{"Length", "[", "DPhiL", "]"}], ">", "0"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc RDPhiAM ... \>\"", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENp2mp1", ",", "UNp2mp1"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "2"}], ",", 
               RowBox[{"m", "+", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RDPhiAM", " ", "=", " ", 
             RowBox[{
              RowBox[{"makeHtDPhiA", "[", 
               RowBox[{"NN", ",", "m", ",", "th", ",", "tl"}], "]"}], ".", 
              RowBox[{"Transpose", "[", "UNp2mp1", "]"}]}]}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"inv", " ", 
            RowBox[{"processes", ":", " ", "A"}]}], "\[Rule]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], "+", "A"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"lApairs", "=", 
          RowBox[{"Length", "[", "Apairs", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"If", " ", "m"}], "\[Equal]", "0"}], ",", " ", 
           RowBox[{"no", " ", "D"}], ",", 
           RowBox[{"Phi", " ", "pair", " ", "generation", " ", "possible"}], 
           ",", " ", 
           RowBox[{
            RowBox[{"so", " ", "set", " ", "lApairs"}], "=", "0"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", 
           RowBox[{"lApairs", "=", "0"}]}], "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lApairs", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENm2mm1", ",", "UNm2mm1"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "-", "2"}], ",", 
               RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<calc HtApairs[i], i= \>\"", ",", "i"}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"si1", "=", 
                RowBox[{"Apairs", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"site", " ", "indexes", " ", "in", " ", "lattice"}], 
                " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"p1", ",", "p2"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ASites", ",", "si1"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ASites", ",", 
                    RowBox[{"si1", "+", "1"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"sapos", " ", "in", " ", "order"}], ",", " ", 
                 RowBox[{
                 "assume", " ", "abeling", " ", "from", " ", "left", " ", 
                  "to", " ", "right"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"sapos", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Min", "[", 
                   RowBox[{"p1", ",", "p2"}], "]"}], ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"p1", ",", "p2"}], "]"}]}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<sapos: \>\"", ",", "sapos"}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"site", " ", 
                 RowBox[{"labels", "/", "pos"}], " ", "in", " ", "Active", 
                 " ", "list"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"HtApairs", "[", "i", "]"}], "=", 
                RowBox[{"makeHtApairs", "[", 
                 RowBox[{
                 "NN", ",", "m", ",", "sapos", ",", "th", ",", "tl", ",", 
                  "boltzfactor"}], "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lApairs"}], "}"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"RDPhiAinvM", "=", 
             RowBox[{
              RowBox[{"Transpose", "[", 
               RowBox[{"makeHtDPhiA", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "2"}], ",", 
                 RowBox[{"m", "-", "1"}], ",", "th", ",", "tl"}], "]"}], 
               "]"}], ".", "UNm2mm1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Nstates", "[", 
              RowBox[{"[", "4", "]"}], "]"}], "=", " ", 
             RowBox[{
              RowBox[{"Dimensions", "[", "RDPhiAinvM", "]"}], "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], ";"}], "*)"}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", 
           RowBox[{"Contact", " ", "Processes"}], "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          StyleBox[
           RowBox[{
            RowBox[{
             RowBox[{"Jh", ":", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
             RowBox[{"\[CapitalPi]", " ", "+", " ", 
              RowBox[{"A", "[", 
               RowBox[{
                RowBox[{"NN", "+", "1"}], ",", 
                RowBox[{"m", "+", "1"}]}], "]"}]}]}], ";", 
            RowBox[{
             RowBox[{"Jl", ":", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
             RowBox[{"\[CapitalPi]", " ", "+", " ", 
              RowBox[{"A", "[", 
               RowBox[{
                RowBox[{"NN", "+", "1"}], ",", "m"}], "]"}]}]}], ";"}],
           FontSize->14], "*)"}], 
         StyleBox["\[IndentingNewLine]",
          FontSize->14], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"CDAproc", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
             "CDhopsR", ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"lcdaproc", "=", 
            RowBox[{"Length", "[", "CDAproc", "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"lcdr", "=", 
          RowBox[{"Length", "[", "CDhopsR", "]"}]}], ";", 
         RowBox[{"lcdl", "=", 
          RowBox[{"Length", "[", "CDhopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lcpr", "=", 
          RowBox[{"Length", "[", "CPhihopsR", "]"}]}], ";", 
         RowBox[{"lcpl", "=", 
          RowBox[{"Length", "[", "CPhihopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lcdaproc", "=", 
          RowBox[{"lcdr", "+", "lcdl", "+", "lcpr", "+", "lcpl"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lcdaproc", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc RCDAhM, RCDAlM ... \>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"HtCDAh", ",", "HtCDAl"}], "}"}], "=", 
             RowBox[{"makeHtCDA", "[", 
              RowBox[{"NN", ",", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENp1mp1", ",", "UNp1mp1"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "1"}], ",", 
               RowBox[{"m", "+", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENp1m", ",", "UNp1m"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "1"}], ",", "m", ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RCDAhM", "=", 
             RowBox[{"HtCDAh", ".", 
              RowBox[{"Transpose", "[", "UNp1mp1", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RCDAlM", "=", 
             RowBox[{"HtCDAl", ".", 
              RowBox[{"Transpose", "[", "UNp1m", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Clear", "[", 
             RowBox[{"HtCDAh", ",", "HtCDAl"}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Jh", ":", " ", 
              StyleBox[
               RowBox[{"\[CapitalPi]", " ", "+", " ", 
                RowBox[{"A", "[", 
                 RowBox[{"NN", ",", "m"}], "]"}]}],
               FontSize->12]}], 
             StyleBox[" ",
              FontSize->12], 
             StyleBox["\[Rule]",
              FontSize->12], 
             StyleBox[" ",
              FontSize->12], 
             StyleBox[
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "1"}], ",", 
                 RowBox[{"m", "-", "1"}]}], "]"}]}],
              FontSize->12]}], 
            StyleBox[";",
             FontSize->12], 
            StyleBox[
             RowBox[{
              RowBox[{"Jl", ":", " ", 
               RowBox[{"\[CapitalPi]", " ", "+", " ", 
                RowBox[{"A", "[", 
                 RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "1"}], ",", "m"}], "]"}]}]}],
             FontSize->12], 
            StyleBox[";",
             FontSize->12], 
            StyleBox[
             RowBox[{"For", " ", "Phi", " ", "case"}],
             FontSize->12]}], 
           StyleBox[",",
            FontSize->12], 
           StyleBox[" ",
            FontSize->12], 
           StyleBox[
            RowBox[{
             RowBox[{
              RowBox[{"switch", " ", "Jh"}], " ", "&"}], " ", "Jl"}],
            FontSize->12]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"lcar", "=", 
          RowBox[{"Length", "[", "CAR", "]"}]}], ";", 
         RowBox[{"lcal", "=", 
          RowBox[{"Length", "[", "CAL", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CAproc", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"CAR", ",", "CAL"}], "]"}]}], ";", 
         RowBox[{"lcAp", "=", 
          RowBox[{"Length", "[", "CAproc", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lcAp", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "only", " ", "if", " ", "m", " ", "is", " ", "not", " ", "0"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"m", ">", "0"}], ",", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"ENm1mm1", ",", "UNm1mm1"}], "}"}], "=", 
               RowBox[{"DiagH", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "1"}], ",", 
                 RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENm1m", ",", "UNm1m"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "-", "1"}], ",", "m", ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<calc HtCAh[i],HtCAl[i], i =\>\"", ",", "i"}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"n", "=", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ASites", ",", 
                   RowBox[{"CAproc", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"HtCAh", "[", "i", "]"}], ",", 
                  RowBox[{"HtCAl", "[", "i", "]"}]}], "}"}], "=", 
                RowBox[{"makeHtCA", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lcAp"}], "}"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
         "Print", "[", "\"\< All matrices etc for rates calculated... \>\"", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "get", " ", "total", " ", "rate", " ", "for", " ", "all", " ", 
            "processes"}], ",", " ", 
           RowBox[{
           "and", " ", "find", " ", "the", " ", "time", " ", "increment", " ",
             "for", " ", "the", " ", "quantum", " ", "jump"}]}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "get", " ", "rates", " ", "for", " ", "current", " ", "state", " ", 
           "psi"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "r1", ",", "r1b", ",", "r2", ",", "r2b", ",", "r3", ",", "r4", ",",
             "r5", ",", "r6", ",", "r7", ",", "r8", ",", "r9", ",", "r10", 
            ",", "r11", ",", "r12", ",", "r13", ",", "r14"}], "}"}], "=", 
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "16"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"D", " ", "hops", " ", 
           RowBox[{"R", "/", "L"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc rate for D hops R\>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"RDAM", " ", "=", 
             RowBox[{
              RowBox[{"HtDAR", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RDAR", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RDAM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r1z", "[", "i", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"RDAR", "[", "i", "]"}], "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r1", " ", "+=", " ", 
             RowBox[{"r1z", "[", "i", "]"}]}], ";"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc rate for D hops L\>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"RDAM", " ", "=", 
             RowBox[{
              RowBox[{"HtDAL", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RDAL", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RDAM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r1bz", "[", "i", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"RDAL", "[", "i", "]"}], "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r1b", " ", "+=", 
             RowBox[{"r1bz", "[", "i", "]"}]}], ";"}], " ", 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Phi", " ", "hops", " ", 
           RowBox[{"R", "/", "L"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc rate for Phi hops R\>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"RDAM", " ", "=", 
             RowBox[{
              RowBox[{"HtPhiAR", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RPhiAR", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RDAM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r2z", "[", "i", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"RPhiAR", "[", "i", "]"}], "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r2", " ", "+=", " ", 
             RowBox[{"r2z", "[", "i", "]"}]}], ";"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", "\"\<calc rate for Phi hops L\>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"RDAM", " ", "=", 
             RowBox[{
              RowBox[{"HtPhiAL", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RPhiAL", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RDAM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r2bz", "[", "i", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"RPhiAL", "[", "i", "]"}], "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r2b", " ", "+=", " ", 
             RowBox[{"r2bz", "[", "i", "]"}]}], ";"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], " ", "+", " ", "A"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"A", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ldpr", "=", 
          RowBox[{"Length", "[", "DPhiR", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ldpl", "=", 
          RowBox[{"Length", "[", "DPhiL", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ldpa", "=", 
          RowBox[{"ldpr", "+", "ldpl"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ldpa", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<calc rate for D,Phi annihilation\>\"", "]"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"RDPhiA", "=", 
             RowBox[{"psi", ".", "RDPhiAM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"r3z", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "RDPhiA", "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r3", " ", "=", " ", 
             RowBox[{"ldpa", "*", "r3z"}]}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"inv", " ", 
            RowBox[{"processes", ":", " ", "A"}]}], "\[Rule]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], "+", "A"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"only", " ", "D"}], ",", 
            RowBox[{"Phi", " ", "pairs"}], ",", " ", 
            RowBox[{"currently", " ", "not", " ", "Phi"}], ",", 
            RowBox[{"D", " ", "pairs"}], ",", " ", 
            RowBox[{"do", " ", "it", " ", "later"}]}], " ", "*)"}],
          FontSize->8], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc rate for D,Phi creation, i=\>\"", ",", "i"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"RDPhiAinvM", "=", 
             RowBox[{
              RowBox[{"HtApairs", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm2mm1", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RDPhiAinv", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RDPhiAinvM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r4z", "[", "i", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", 
               RowBox[{"RDPhiAinv", "[", "i", "]"}], "]"}], "^", "2"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"r4", "+=", 
             RowBox[{"r4z", "[", "i", "]"}]}], ";"}], "\[IndentingNewLine]", 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lApairs"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"contacts", ":", " ", 
            RowBox[{
            "use", " ", "these", " ", "D", " ", "rates", " ", "for", " ", 
             "phis", " ", "as", " ", "well"}]}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"just", " ", "jh"}], "&"}], "jl", " ", 
            "interchanged"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "CDhopsR", ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ldacproc", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<calc rates r5-r8 for jump 7,8,9,10 \>\"", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"RCDAh", "=", 
             RowBox[{"psi", ".", "RCDAhM"}]}], ";", 
            RowBox[{"RCDAl", "=", 
             RowBox[{"psi", ".", "RCDAlM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "RCDAh", "]"}], "^", "2"}]}], ";", 
            RowBox[{"x2", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "RCDAl", "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"rates", " ", "for", " ", "D", " ", "and", " ", "Phi"}],
               ";", " ", 
              RowBox[{
              "add", " ", "bprob", " ", "not", " ", "amplitudes", " ", 
               "because", " ", "diff", " ", "final", " ", "Hilbert", " ", 
               "spaces"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"rcd", "=", 
             RowBox[{
              RowBox[{"x1", "*", "Jh"}], " ", "+", " ", 
              RowBox[{"x2", "*", "Jl"}]}]}], ";", " ", "\[IndentingNewLine]", 
            
            RowBox[{"rcp", "=", 
             RowBox[{
              RowBox[{"x1", "*", "Jl"}], " ", "+", " ", 
              RowBox[{"x2", "*", "Jh"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcdr", ">", "0"}], ",", 
              RowBox[{"r5", "=", "rcd"}]}], "]"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"for", " ", "left", " ", "contact", " ", 
              RowBox[{"??", "??"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcdl", ">", "0"}], ",", 
              RowBox[{"r6", "=", "rcd"}]}], "]"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{"for", " ", "right", " ", "contact", 
              RowBox[{"??", 
               RowBox[{"??", " ", 
                RowBox[{
                 RowBox[{
                 "change", " ", "this", " ", "to", " ", "sensible", " ", 
                  "convention", " ", "of", " ", "r"}], ",", 
                 RowBox[{"l", " ", "for", " ", "r"}], ",", 
                 RowBox[{"l", " ", "contacts"}]}]}]}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcpr", ">", "0"}], ",", 
              RowBox[{"r7", "=", "rcp"}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcpl", ">", "0"}], ",", 
              RowBox[{"r8", "=", "rcp"}]}], "]"}], ";", " ", 
            "\[IndentingNewLine]", 
            RowBox[{"r5x", "=", "x1"}], ";", 
            RowBox[{"r6x", "=", "x2"}], ";"}]}], "\[IndentingNewLine]", "]"}],
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"inv", " ", "process", " ", "at", " ", "contacts"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<calc rates r9-r12 for jump 11,12,13,14 \>\"", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"RCAhM", "=", 
                RowBox[{
                 RowBox[{"HtCAh", "[", "i", "]"}], ".", 
                 RowBox[{"Transpose", "[", "UNm1mm1", "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RCAh", "[", "i", "]"}], "=", 
                RowBox[{"psi", ".", "RCAhM"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x1", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RCAh", "[", "i", "]"}], "]"}], "^", "2"}], "//", 
                 "N"}]}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", "0"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"RCAlM", "=", 
             RowBox[{
              RowBox[{"HtCAl", "[", "i", "]"}], ".", 
              RowBox[{"Transpose", "[", "UNm1m", "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RCAl", "[", "i", "]"}], "=", 
             RowBox[{"psi", ".", "RCAlM"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"x2", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Norm", "[", 
                RowBox[{"RCAl", "[", "i", "]"}], "]"}], "^", "2"}], "//", 
              "N"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"rcdi", "=", 
             RowBox[{
              RowBox[{"x1", "*", "Jh"}], " ", "+", " ", 
              RowBox[{"x2", "*", "Jl"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"rcpi", "=", 
             RowBox[{
              RowBox[{"x1", "*", "Jl"}], " ", "+", " ", 
              RowBox[{"x2", "*", "Jh"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"for", " ", "left", " ", "contact"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"CAproc", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "1"}], ",", 
              RowBox[{
               RowBox[{"r9", "=", "rcdi"}], ";", 
               RowBox[{"r11", "=", "rcpi"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r9xh", "=", "x1"}], ";", 
               RowBox[{"r9xl", "=", "x2"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r11xh", "=", "x1"}], ";", 
               RowBox[{"r11xl", "=", "x2"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r9i", "=", "i"}], ";", 
               RowBox[{"r11i", "=", "i"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<r9,r11,r11xh,r11xl = \>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"r9", ",", "r11", ",", "r11xh", ",", "r11xl"}], 
                  "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"for", " ", "right", " ", "contact"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"CAproc", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "\[Equal]", "Ntot"}], ",", 
              RowBox[{
               RowBox[{"r10", "=", "rcdi"}], ";", 
               RowBox[{"r12", "=", "rcpi"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r10xh", "=", "x1"}], ";", 
               RowBox[{"r10xl", "=", "x2"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r12xh", "=", "x1"}], ";", 
               RowBox[{"r12xl", "=", "x2"}], ";", "\[IndentingNewLine]", 
               RowBox[{"r10i", "=", "i"}], ";", 
               RowBox[{"r12i", "=", "i"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<r10,r12,r10xh,r10xl = \>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"r10", ",", "r12", ",", "r10xh", ",", "r10xl"}], 
                  "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
            ";"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lcAp"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"kappa", " ", "and", " ", "gamma"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"kappa", ">", "0"}], "||", 
              RowBox[{"gamma", ">", "0"}]}], ")"}], "&&", 
            RowBox[{"m", ">", "0"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"ENmm1", ",", "UNmm1"}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{"NN", ",", 
               RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "kappa", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Rkappa", "=", 
             RowBox[{"kappa", "*", 
              RowBox[{"psi", ".", 
               RowBox[{"HtKappa", "[", 
                RowBox[{"NN", ",", "m"}], "]"}], ".", 
               RowBox[{"Transpose", "[", "UNmm1", "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"r13", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "Rkappa", "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "gamma", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Rgamma", "[", "i", "]"}], " ", "=", " ", 
                RowBox[{"gamma", "*", 
                 RowBox[{"psi", ".", 
                  RowBox[{"HtGamma", "[", 
                   RowBox[{"NN", ",", "m", ",", "i"}], "]"}], ".", 
                  RowBox[{"Transpose", "[", "UNmm1", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r14z", "[", "i", "]"}], "=", 
                RowBox[{
                 RowBox[{"Norm", "[", 
                  RowBox[{"Rgamma", "[", "i", "]"}], "]"}], "^", "2"}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{"r14", "+=", 
                RowBox[{"r14z", "[", "i", "]"}]}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"(*", 
          RowBox[{"make", " ", "a", " ", "single", " ", 
           RowBox[{"list", "/", "array"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"rates", "=", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r1z", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "ldr"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r1bz", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "ldl"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r2z", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lpr"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r2bz", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lpl"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{"r3z", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "ldpr"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{"r3z", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "ldpl"}], "}"}]}], "]"}], ","}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", "r3z", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r4z", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lApairs"}], "}"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{"r5", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "lcdr"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{"r6", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "lcdl"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{"r7", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "lcpr"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{"r8", ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "lcpl"}], "}"}]}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", "r5", "}"}], ",", 
            RowBox[{"{", "r6", "}"}], ",", 
            RowBox[{"{", "r7", "}"}], ",", 
            RowBox[{"{", "r8", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", "r9", "}"}], ",", 
            RowBox[{"{", "r10", "}"}], ",", 
            RowBox[{"{", "r11", "}"}], ",", 
            RowBox[{"{", "r12", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"{", "r13", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"r14z", "[", "i", "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}]}], 
           "\[IndentingNewLine]", "}"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"total", " ", "rate", " ", "etc"}], ";", " ", 
           RowBox[{"add", " ", 
            RowBox[{"kappa", "/", 
             RowBox[{"gamma", " ", "!"}]}]}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"totrates", "=", 
          RowBox[{"{", 
           RowBox[{
           "r1", ",", "r1b", ",", "r2", ",", "r2b", ",", "r3", ",", "r4", ",",
             "r5", ",", "r6", ",", "r7", ",", "r8", ",", "r9", ",", "r10", 
            ",", "r11", ",", "r12", ",", "r13", ",", "r14"}], "}"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ltotr", "=", 
          RowBox[{"Length", "[", "totrates", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"R", "=", " ", 
          RowBox[{"Total", "[", "totrates", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"slist", "=", 
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Total", "[", 
               RowBox[{"totrates", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "i"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "ltotr"}], "}"}]}], "]"}], ",", 
            "0", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"time", " ", "increment"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"u", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dt", " ", "=", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"-", "1"}], "/", "R"}], " ", ")"}], "*", 
           RowBox[{"Log", "[", "u", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"t", " ", "+=", " ", "dt"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"times", ",", "t"}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"which", " ", 
            RowBox[{"process", ":", " ", "whichjump"}]}], "=", "?"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"eta", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", "R"}], " ", "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"eta", ">", 
               RowBox[{"slist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
              RowBox[{"eta", "\[LessEqual]", "  ", 
               RowBox[{"slist", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"whichjump", "=", "i"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ltotr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"which", " ", "sites", " ", "for", " ", "selected", " ", 
            RowBox[{"jump", "?"}]}], ":", " ", 
           RowBox[{"whichsites", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         
         RowBox[{"process", "=", 
          RowBox[{"rates", "[", 
           RowBox[{"[", "whichjump", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lp", "=", 
          RowBox[{"Length", "[", "process", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"slist", "=", 
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Total", "[", 
               RowBox[{"process", "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "i"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lp"}], "}"}]}], "]"}], ",", "0", 
            ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"eta", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", 
             RowBox[{"Total", "[", "process", "]"}]}], " ", "}"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"eta", ">", 
               RowBox[{"slist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
              RowBox[{"eta", "\[LessEqual]", "  ", 
               RowBox[{"slist", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"whichsites", "=", "i"}], ";", 
              RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lp"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Dimensions[psi]: \>\"", ",", 
           RowBox[{"Dimensions", "[", "psi", "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<totrates: \>\"", ",", "totrates"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<CAproc: 1 or Ntot? : \>\"", ",", "CAproc"}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<N,m: \>\"", ",", 
           RowBox[{"{", 
            RowBox[{"NN", ",", "m"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Ds: \>\"", ",", "Ds"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<\[Phi]s: \>\"", ",", "Phis"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Apairs: \>\"", ",", "Apairs"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<whichjump: \>\"", ",", "whichjump"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<whichsites in relevant list (not actual site label): \>\"", 
           ",", "whichsites"}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"which", " ", "final", " ", 
            RowBox[{"state", "/", "degenerate"}], " ", 
            RowBox[{"sector", "?"}]}], ":", " ", 
           RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"DhopsR", "[", 
              RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "+", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Ds", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", 
             RowBox[{"RDAR", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENm", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNm", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"DhopsL", "[", 
              RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Ds", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", 
             RowBox[{"RDAL", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENm", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNm", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"PhihopsR", "[", 
              RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "+", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Phis", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", 
             RowBox[{"RPhiAR", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENm", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNm", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"PhihopsL", "[", 
              RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Phis", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", 
             RowBox[{"RPhiAL", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENm", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNm", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"DPhiR", " ", "and", " ", "DPhiL", " ", "cases"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "5"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"whichsites", " ", "calc", " ", "above", " ", 
             RowBox[{"ignored", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"R", ":", 
              RowBox[{"(", 
               RowBox[{"D", ",", "Phi"}], ")"}]}], ",", " ", 
             RowBox[{"or", " ", 
              RowBox[{"L", ":", 
               RowBox[{"(", 
                RowBox[{"Phi", ",", "D"}], ")"}]}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomInteger", "[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "ldpa"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "ldpr"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"whichsites", "=", 
                RowBox[{"RandomInteger", "[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "ldpr"}], "}"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"update", " ", "Ds"}], " ", "&"}], " ", "Phis"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pos", 
                StyleBox["=",
                 FontSize->14], 
                RowBox[{"DPhiR", "[", 
                 RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Ds", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Ds", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Ds", ",", "pos"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Phis", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Phis", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Phis", ",", 
                    RowBox[{"pos", "+", "1"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", 
                 RowBox[{"{", 
                  RowBox[{"pos", ",", 
                   RowBox[{"pos", "+", "1"}]}], "}"}]}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"whichsites", "=", 
                RowBox[{"RandomInteger", "[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "ldpl"}], "}"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                  RowBox[{"update", " ", "Ds"}], " ", "&"}], " ", "Phis"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"pos", 
                StyleBox["=",
                 FontSize->14], 
                RowBox[{"DPhiL", "[", 
                 RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Ds", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Ds", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Ds", ",", "pos"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], " ", "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Phis", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Phis", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Phis", ",", 
                    RowBox[{"pos", "-", "1"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", 
                 RowBox[{"{", 
                  RowBox[{"pos", ",", 
                   RowBox[{"pos", "-", "1"}]}], "}"}]}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", "RDPhiA"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENp2mp1", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNp2mp1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"NN", "+=", "2"}], ";", 
            RowBox[{"m", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Apairs", " ", "cases"}], ";", " ", 
            RowBox[{"only", " ", "goes", " ", "to", " ", "D"}]}], ",", 
           RowBox[{"Phi", ";", " ", 
            RowBox[{"do", " ", "Phi"}]}], ",", 
           RowBox[{"D", " ", 
            RowBox[{"later", "!"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "6"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds", " ", "and", " ", "Phis"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           StyleBox[
            RowBox[{"(*", " ", 
             RowBox[{"D", ",", 
              RowBox[{"Phi", " ", "ro", " ", "Phi"}], ",", 
              RowBox[{"D", " ", 
               RowBox[{"??", 
                RowBox[{"?", " ", 
                 RowBox[{"select", " ", "one", 
                  RowBox[{"??", "?"}]}]}]}]}]}], " ", "*)"}],
            FontSize->24], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"Apairs", "[", 
              RowBox[{"[", "whichsites", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Ds", ",", "pos"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Phis", ",", 
              RowBox[{"pos", "+", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"ASites", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"ASites", ",", "pos"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"ASites", ",", 
                    RowBox[{"pos", "+", "1"}]}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}],
             "\[IndentingNewLine]", 
            RowBox[{"rate", "=", 
             RowBox[{"RDPhiAinv", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENm2mm1", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNm2mm1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"NN", "-=", "2"}], ";", 
            RowBox[{"m", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"whichjump", "\[Equal]", "7"}], "||", 
            RowBox[{"whichjump", "\[Equal]", "8"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds"}], " ", "*)"}], "\[IndentingNewLine]",
            " ", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"whichjump", "\[Equal]", "7"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Ds", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Ds", ",", "1"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Ds", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Ds", ",", "Ntot"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"Jh", " ", "or", " ", 
              RowBox[{"Jl", "?"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r5x", "*", "Jh"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r6x", "*", "Jl"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "x1"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", "RCDAh"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENp1mp1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNp1mp1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "+=", "1"}], ";", 
               RowBox[{"m", "+=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", "RCDAl"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENp1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNp1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"whichjump", "\[Equal]", "9"}], " ", "||", 
            RowBox[{"whichjump", "==", "10"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Phis"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"whichjump", "\[Equal]", "9"}], " ", ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Phis", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Phis", ",", "1"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{"Phis", ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Phis", ",", "Ntot"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r5", "*", "Jl"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r6", "*", "Jh"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               "  ", "x2"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", "RCDAh"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENp1mp1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNp1mp1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "+=", "1"}], ";", 
               RowBox[{"m", "+=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", "RCDAl"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENp1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNp1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "11"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"Ds", ",", "1"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ASites", ",", "1"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"Jh", " ", "or", " ", 
              RowBox[{"Jl", "?"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r9xh", "*", "Jh"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r9xl", "*", "Jl"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "x1"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAh", "[", "r9i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<11 h: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1mm1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1mm1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";", 
               RowBox[{"m", "-=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAl", "[", "r9i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<11 l: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "12"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"Ds", ",", "Ntot"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ASites", ",", "Ntot"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"Jh", " ", "or", " ", 
              RowBox[{"Jl", "?"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r10xh", "*", "Jh"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r10xl", "*", "Jl"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "x1"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Print", "[", "\"\< wj 12 Jh\>\"", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<Dimensions[RCAh[r10i]]: \>\"", ",", 
                 RowBox[{"Dimensions", "[", 
                  RowBox[{"RCAh", "[", "r10i", "]"}], "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rate", "=", 
                RowBox[{"RCAh", "[", "r10i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<12 h: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1mm1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1mm1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";", 
               RowBox[{"m", "-=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Print", "[", "\"\< wj 12 Jl\>\"", "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<Dimensions[RCAl[r10i]]: \>\"", ",", 
                 RowBox[{"Dimensions", "[", 
                  RowBox[{"RCAl", "[", "r10i", "]"}], "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"rate", "=", 
                RowBox[{"RCAl", "[", "r10i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<12 l: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "13"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"Phis", ",", "1"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ASites", ",", "1"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"Jh", " ", "or", " ", 
              RowBox[{"Jl", "?"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r11xh", "*", "Jl"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r11xl", "*", "Jh"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "x2"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAh", "[", "r11i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<13 h: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1mm1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1mm1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";", 
               RowBox[{"m", "-=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAl", "[", "r11i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<13 l: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "14"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"Phis", ",", "Ntot"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Drop", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"ASites", ",", "Ntot"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"Jh", " ", "or", " ", 
              RowBox[{"Jl", "?"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"x1", "=", 
             RowBox[{"r12xh", "*", "Jl"}]}], " ", ";", 
            RowBox[{"x2", "=", 
             RowBox[{"r12xl", "*", "Jh"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"xtot", "=", 
             RowBox[{"x1", "+", "x2"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"RandomReal", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "xtot"}], "}"}], "]"}], "\[LessEqual]", 
               " ", "x2"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAh", "[", "r12i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<14 h: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1mm1", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1mm1", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";", 
               RowBox[{"m", "-=", "1"}], ";"}], "\[IndentingNewLine]", ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"rate", "=", 
                RowBox[{"RCAl", "[", "r12i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<14 l: rate: \>\"", ",", "rate"}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Elevels", "=", 
                RowBox[{
                 RowBox[{"Tally", "[", "ENm1m", "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"nlevels", "=", 
                RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
                RowBox[{"SecRates", "[", 
                 RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"which", " ", 
                  RowBox[{"sector", "?"}]}], ":", " ", 
                 RowBox[{"whichsec", "?"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"eta", "=", 
                RowBox[{"RandomReal", "[", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"eta", ">", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                    RowBox[{"eta", "\[LessEqual]", "  ", 
                    RowBox[{"Rlist", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                   RowBox[{
                    RowBox[{"whichsec", "=", "i"}], ";", 
                    RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"final", " ", "state"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i1", ",", "i2"}], "}"}], "=", 
                RowBox[{"degen", "[", 
                 RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"psif", "=", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"rate", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "*", 
                   RowBox[{"UNm1m", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"NN", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "kappa", " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "15"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"rate", "=", "Rkappa"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENmm1", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNmm1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"m", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", "gamma", "  ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"whichjump", "\[Equal]", "16"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "the", " ", "wavefunction"}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"rate", "=", 
             RowBox[{"Rgamma", "[", "whichsites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"split", " ", "degen", " ", "sectors"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Elevels", "=", 
             RowBox[{
              RowBox[{"Tally", "[", "ENmm1", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"nlevels", "=", 
             RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Rlist", ",", "degen"}], "}"}], "=", 
             RowBox[{"SecRates", "[", 
              RowBox[{"Elevels", ",", "rate"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"which", " ", 
               RowBox[{"sector", "?"}]}], ":", " ", 
              RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"eta", "=", 
             RowBox[{"RandomReal", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"Rlist", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"eta", ">", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                 RowBox[{"eta", "\[LessEqual]", "  ", 
                  RowBox[{"Rlist", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"whichsec", "=", "i"}], ";", 
                 RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"final", " ", "state"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}], "=", 
             RowBox[{"degen", "[", 
              RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"psif", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"rate", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "*", 
                RowBox[{"UNmm1", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "All"}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"m", "-=", "1"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Elevels: \>\"", ",", "Elevels"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Dsvst", ",", "Ds"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Phisvst", ",", "Phis"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"mvst", ",", "m"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<t = \>\"", ",", "t"}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<psi: \>\"", ",", "psi"}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"psi", "=", 
          RowBox[{"psif", "/", 
           RowBox[{"Norm", "[", "psif", "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<psif: \>\"", ",", "psi"}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<F: N,m: \>\"", ",", 
           RowBox[{"{", 
            RowBox[{"NN", ",", "m"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<F: Ds: \>\"", ",", "Ds"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<F: \[Phi]s: \>\"", ",", "Phis"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"output", " ", 
        RowBox[{"??", "?"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"times", ",", "Dsvst", ",", "Phisvst", ",", "mvst"}], 
       "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.704783172421139*^9, 3.7047833359558783`*^9}, {
   3.704783486810378*^9, 3.704783561532089*^9}, {3.704783618794695*^9, 
   3.7047837283106537`*^9}, {3.704783775128314*^9, 3.7047837895580482`*^9}, {
   3.704783830904345*^9, 3.7047839658066263`*^9}, {3.704784129133769*^9, 
   3.7047841459876432`*^9}, {3.704784192038864*^9, 3.704784560153019*^9}, {
   3.704786369819558*^9, 3.704786486736259*^9}, {3.7047865267200413`*^9, 
   3.704786607019348*^9}, {3.70478664673158*^9, 3.704786758061687*^9}, {
   3.7047867892982273`*^9, 3.704786814247991*^9}, {3.704786848440436*^9, 
   3.7047868933629513`*^9}, {3.7047869320186987`*^9, 3.704787014042985*^9}, {
   3.704787052574963*^9, 3.704787172605968*^9}, {3.704787389469852*^9, 
   3.704787402954513*^9}, {3.704790843596768*^9, 3.704791068640873*^9}, {
   3.7047911011072073`*^9, 3.7047911186253366`*^9}, {3.70479123857541*^9, 
   3.704791301455451*^9}, {3.704792963911644*^9, 3.7047934003686123`*^9}, 
   3.70479344973145*^9, {3.705059513112097*^9, 3.7050595138643513`*^9}, {
   3.705059588351756*^9, 3.7050596479609118`*^9}, {3.705061758157002*^9, 
   3.705061954238187*^9}, {3.705062014768548*^9, 3.705062767498807*^9}, {
   3.705062821104437*^9, 3.705063030567404*^9}, {3.7050630696394787`*^9, 
   3.705063108734951*^9}, {3.7050631456941547`*^9, 3.705063342306601*^9}, {
   3.70506353727276*^9, 3.7050635417821407`*^9}, {3.7051255964481497`*^9, 
   3.705125742097025*^9}, {3.705125775880097*^9, 3.705126006222837*^9}, {
   3.705126058407432*^9, 3.705126087606455*^9}, {3.705126130393464*^9, 
   3.705126209479981*^9}, {3.705126263040592*^9, 3.7051263403671417`*^9}, {
   3.705128535085127*^9, 3.705128616888104*^9}, {3.705128656480611*^9, 
   3.705128704184763*^9}, {3.705128755889853*^9, 3.7051288005502977`*^9}, {
   3.70512958204272*^9, 3.705129924780792*^9}, {3.705129957455364*^9, 
   3.705129979627635*^9}, {3.705130014599234*^9, 3.705130070846201*^9}, {
   3.7051301403611937`*^9, 3.705130169616908*^9}, {3.705130213635092*^9, 
   3.70513026417274*^9}, {3.705130296668211*^9, 3.705130332491054*^9}, 
   3.705130417665039*^9, {3.70513101982754*^9, 3.7051316362274103`*^9}, {
   3.7051316898164043`*^9, 3.705131720950481*^9}, {3.7051317727363873`*^9, 
   3.705131803316923*^9}, {3.705131879783592*^9, 3.7051318848424387`*^9}, 
   3.705131925634592*^9, {3.705131957767816*^9, 3.7051322212253532`*^9}, {
   3.705133240871599*^9, 3.705133250575276*^9}, {3.705133286504322*^9, 
   3.705133313869225*^9}, {3.705133344297269*^9, 3.7051333816767282`*^9}, {
   3.705133434563531*^9, 3.705133517450326*^9}, {3.705133586364935*^9, 
   3.7051336131051617`*^9}, {3.705133652823696*^9, 3.7051336532785273`*^9}, {
   3.7051337405045843`*^9, 3.70513411842062*^9}, {3.705134160861816*^9, 
   3.705134293541276*^9}, {3.705134331152937*^9, 3.705134359390081*^9}, {
   3.705134393916771*^9, 3.705134438714485*^9}, {3.705134475322234*^9, 
   3.705134518136128*^9}, {3.705134552299152*^9, 3.7051346231578617`*^9}, {
   3.7051346568268433`*^9, 3.705134701013432*^9}, {3.705134742471919*^9, 
   3.705134754589505*^9}, {3.705134818978344*^9, 3.705134848490744*^9}, {
   3.705136850559153*^9, 3.705136877807722*^9}, {3.705136978677987*^9, 
   3.7051370440888147`*^9}, {3.7051370840313683`*^9, 3.705137122144758*^9}, {
   3.7051372365013523`*^9, 3.705137301977664*^9}, {3.705137343655925*^9, 
   3.70513740175257*^9}, {3.705137495942437*^9, 3.705137589557526*^9}, {
   3.705137633236888*^9, 3.705137862356967*^9}, {3.706509873943427*^9, 
   3.706509881575404*^9}, {3.70651002017414*^9, 3.706510032334733*^9}, {
   3.7065131411035023`*^9, 3.706513159662982*^9}, {3.706513289955968*^9, 
   3.706513439163087*^9}, {3.706513495851425*^9, 3.7065135906028423`*^9}, {
   3.7065136274404917`*^9, 3.7065136896645727`*^9}, {3.7065137495575657`*^9, 
   3.7065139446788588`*^9}, {3.706513978303144*^9, 3.7065140005959272`*^9}, {
   3.706514323249061*^9, 3.706514330247436*^9}, {3.7065146659835777`*^9, 
   3.7065147125346327`*^9}, {3.706514923898381*^9, 3.706515064373992*^9}, 
   3.706515786325506*^9, {3.706515842465146*^9, 3.70651586145531*^9}, {
   3.706518343358388*^9, 3.706518349603982*^9}, {3.7065183917171173`*^9, 
   3.7065184014167624`*^9}, {3.706518433443201*^9, 3.706518522727351*^9}, {
   3.706518554111517*^9, 3.70651861985944*^9}, 3.7065186577108383`*^9, {
   3.706521723067787*^9, 3.70652174126503*^9}, {3.706534234666196*^9, 
   3.706534235938246*^9}, {3.706536583984984*^9, 3.7065366821358423`*^9}, {
   3.706537365015826*^9, 3.706537452204118*^9}, {3.7065383010170593`*^9, 
   3.706538379002997*^9}, {3.706545865648337*^9, 3.7065458725733232`*^9}, {
   3.706545910914023*^9, 3.706546019468893*^9}, {3.706595810812895*^9, 
   3.706595817435524*^9}, {3.706595865963649*^9, 3.706595878611367*^9}, {
   3.706595923932712*^9, 3.7065959681151447`*^9}, {3.706597552991376*^9, 
   3.7065975736391973`*^9}, {3.706597630608406*^9, 3.706597646805417*^9}, {
   3.70659769276257*^9, 3.706597751208255*^9}, {3.70659783662741*^9, 
   3.706597860439271*^9}, {3.706598260026404*^9, 3.70659829894306*^9}, {
   3.7065983581509743`*^9, 3.7065984300634623`*^9}, {3.706598466617525*^9, 
   3.706598523550221*^9}, {3.706603363728672*^9, 3.706603437956768*^9}, {
   3.7066034725848227`*^9, 3.706603594318576*^9}, {3.706603638081397*^9, 
   3.7066037791953506`*^9}, {3.706603829851663*^9, 3.70660392906595*^9}, {
   3.706603962450411*^9, 3.7066040030163116`*^9}, {3.706604060300254*^9, 
   3.70660406486514*^9}, {3.706604120473002*^9, 3.706604176324741*^9}, {
   3.706604238815672*^9, 3.706604386370186*^9}, {3.706604520877483*^9, 
   3.706604528060874*^9}, {3.706604663779698*^9, 3.706604685682488*^9}, {
   3.706604746629105*^9, 3.706605071436154*^9}, {3.706605101994122*^9, 
   3.7066051222431927`*^9}, {3.70660576240668*^9, 3.706605799600741*^9}, {
   3.7066058973464518`*^9, 3.706605898193409*^9}, {3.706607919945128*^9, 
   3.706607940031229*^9}, {3.7066079736600943`*^9, 3.706608244661215*^9}, {
   3.706608315789989*^9, 3.706608316181827*^9}, {3.706608366916226*^9, 
   3.706608369468254*^9}, {3.706608487773247*^9, 3.706608514692258*^9}, 
   3.706608565356036*^9, {3.706608805848152*^9, 3.7066088094873753`*^9}, {
   3.706608932336582*^9, 3.70660894422617*^9}, {3.70660898741103*^9, 
   3.706609025309536*^9}, {3.706609101682107*^9, 3.706609104654673*^9}, {
   3.7066092081287537`*^9, 3.706609239529347*^9}, 3.706609270002934*^9, {
   3.7066099326965446`*^9, 3.706609943393063*^9}, {3.7066106027302113`*^9, 
   3.706610618132289*^9}, {3.706610708645006*^9, 3.706610734395289*^9}, {
   3.7066108151296*^9, 3.7066108267455072`*^9}, {3.7066108742393217`*^9, 
   3.706610897438221*^9}, {3.706610931364291*^9, 3.70661094317912*^9}, {
   3.706610996326351*^9, 3.706611004622718*^9}, {3.7066110989729424`*^9, 
   3.706611124124144*^9}, {3.706611164266272*^9, 3.706611195095063*^9}, {
   3.706611268194743*^9, 3.706611281417799*^9}, {3.7066113670341988`*^9, 
   3.706611392185605*^9}, {3.706611430328508*^9, 3.706611530869961*^9}, 
   3.706611572527708*^9, {3.706612625332357*^9, 3.706612645731523*^9}, {
   3.706612693933943*^9, 3.706612708430121*^9}, {3.7066127428118668`*^9, 
   3.706612749985382*^9}, {3.706612814653928*^9, 3.7066128257911263`*^9}, {
   3.70661287768003*^9, 3.706612879230733*^9}, {3.7066129798311987`*^9, 
   3.706613033697703*^9}, {3.706613213425725*^9, 3.706613223656927*^9}, {
   3.7066132703060427`*^9, 3.706613285682077*^9}, {3.706613326009914*^9, 
   3.706613326888667*^9}, {3.7066133637223263`*^9, 3.706613422776167*^9}, {
   3.706613458941738*^9, 3.7066134912489443`*^9}, {3.706614485946495*^9, 
   3.706614489512269*^9}, {3.7067990569120703`*^9, 3.706799065076029*^9}, {
   3.706799105589189*^9, 3.706799152286755*^9}, {3.706799382964511*^9, 
   3.706799390051456*^9}, {3.706799456143239*^9, 3.706799462462285*^9}, {
   3.7067995715032454`*^9, 3.706799657306563*^9}, {3.7067997567972097`*^9, 
   3.7067997910646*^9}, {3.706799874175828*^9, 3.706799910087903*^9}, {
   3.7068003537474403`*^9, 3.7068003827709*^9}, {3.7068013887076883`*^9, 
   3.7068013938831167`*^9}, {3.7068014251877117`*^9, 3.706801484286682*^9}, {
   3.706801769786557*^9, 3.706801824070918*^9}, {3.7068018856345797`*^9, 
   3.706801958253146*^9}, {3.706802044964902*^9, 3.706802098480714*^9}, {
   3.7068021641483097`*^9, 3.706802285507266*^9}, {3.7068029702830563`*^9, 
   3.706802988267655*^9}, {3.706812407046031*^9, 3.706812560244092*^9}, {
   3.706812630886078*^9, 3.706812659104816*^9}, {3.706812908907963*^9, 
   3.706812922350101*^9}, {3.706817936268448*^9, 3.706817942990999*^9}, {
   3.706817973328759*^9, 3.7068180210135803`*^9}, {3.706818217663375*^9, 
   3.7068182423539667`*^9}, {3.706818440398896*^9, 3.706818457835308*^9}, 
   3.706818493132701*^9, {3.706818588641736*^9, 3.7068186820109386`*^9}, {
   3.7068187144454937`*^9, 3.706818729156329*^9}, {3.706818838653962*^9, 
   3.706818841046473*^9}, {3.706819001367852*^9, 3.706819067659362*^9}, {
   3.7068191793218813`*^9, 3.706819276541692*^9}, 3.7068194852863827`*^9, {
   3.7068195704708967`*^9, 3.7068196213406353`*^9}, {3.706819733871563*^9, 
   3.7068197623658457`*^9}, {3.706819881557279*^9, 3.706819921585165*^9}, {
   3.706820020012499*^9, 3.706820026746523*^9}, {3.706820140008994*^9, 
   3.7068201846675253`*^9}, {3.706820219149828*^9, 3.7068203879378366`*^9}, {
   3.706820455534668*^9, 3.70682055671462*^9}, {3.706820805009758*^9, 
   3.706820853035634*^9}, {3.70686414054748*^9, 3.7068641758670883`*^9}, {
   3.706865576847663*^9, 3.706865596373768*^9}, {3.7068656560115967`*^9, 
   3.706865675657983*^9}, {3.7068657688930902`*^9, 3.706865771960717*^9}, {
   3.706865833538558*^9, 3.706865889118916*^9}, {3.70686594746532*^9, 
   3.706865966407058*^9}, {3.7068660541671133`*^9, 3.706866152424388*^9}, {
   3.7068669855065603`*^9, 3.706867001229067*^9}, {3.70686752244597*^9, 
   3.706867536349134*^9}, {3.7068676814407387`*^9, 3.706867713782263*^9}, {
   3.706867839383494*^9, 3.7068678727713614`*^9}, {3.706867921369946*^9, 
   3.706867960617537*^9}, {3.706868412396632*^9, 3.706868416855505*^9}, {
   3.706868482272785*^9, 3.706868493305138*^9}, {3.706868562704898*^9, 
   3.706868613349305*^9}, {3.706868783557411*^9, 3.706868816806634*^9}, {
   3.70686905288794*^9, 3.70686908956033*^9}, {3.7068692241783943`*^9, 
   3.706869234031941*^9}, {3.7068695197708387`*^9, 3.7068695647268143`*^9}, {
   3.706875750444603*^9, 3.7068757880155077`*^9}, {3.706875895171781*^9, 
   3.706875904212925*^9}, {3.706876130515038*^9, 3.706876165141712*^9}, {
   3.706876252704343*^9, 3.7068762900527573`*^9}, {3.7068763593893137`*^9, 
   3.70687635957143*^9}, {3.70687655162044*^9, 3.706876581892149*^9}, {
   3.706877344909102*^9, 3.706877347069663*^9}, {3.706877530827804*^9, 
   3.706877573624424*^9}, {3.706877678614237*^9, 3.70687768105379*^9}, {
   3.706945107672452*^9, 3.706945159772511*^9}, {3.7069453823165417`*^9, 
   3.706945548334036*^9}, {3.706945697167466*^9, 3.706945706938045*^9}, {
   3.706949810600993*^9, 3.706949902733562*^9}, {3.706949984596388*^9, 
   3.7069500184637527`*^9}, {3.706950095960967*^9, 3.706950183200349*^9}, {
   3.706950443391224*^9, 3.706950472704021*^9}, {3.7069505148721533`*^9, 
   3.7069505192659492`*^9}, {3.706950977767359*^9, 3.7069511041223793`*^9}, {
   3.7069511626958647`*^9, 3.7069512834148684`*^9}, {3.706951410151729*^9, 
   3.7069514405014553`*^9}, {3.7069518995811043`*^9, 3.706951931731307*^9}, {
   3.706952038521633*^9, 3.706952062596208*^9}, {3.70695268898332*^9, 
   3.7069526977129507`*^9}, {3.706953563655384*^9, 3.706953585626975*^9}, {
   3.7069536333358383`*^9, 3.706953779391068*^9}, 3.706954015591402*^9, {
   3.70695487074964*^9, 3.706954907754259*^9}, {3.706954999742259*^9, 
   3.706955003652726*^9}, {3.706955101416648*^9, 3.706955110957039*^9}, {
   3.706955153223144*^9, 3.706955159648882*^9}, {3.7069552238255453`*^9, 
   3.706955399112224*^9}, {3.706965156466342*^9, 3.7069651941369057`*^9}, {
   3.706965278203692*^9, 3.706965313836733*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "}"}], ",", 
     RowBox[{"{", "}"}], ",", "1", ",", "10"}], "}"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"{", 
    RowBox[{"Ds", ",", "Phis", ",", "m", ",", "tmax"}], "}"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"th", ",", "tl", ",", "Jh", ",", "Jl", ",", "boltzf"}], "}"}], 
   "=", 
   RowBox[{"{", 
    RowBox[{"0.1", ",", "0.1", ",", "0.1", ",", "0.1", ",", "0.5"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"kappa", ",", "gamma"}], "}"}], "=", 
   RowBox[{"{", 
    RowBox[{"0.05", ",", "0.05"}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.70660934732798*^9, 3.706609353316422*^9}, {
   3.7066094955692177`*^9, 3.706609513447116*^9}, {3.706609566063128*^9, 
   3.706609566789081*^9}, {3.706610089661437*^9, 3.706610089883745*^9}, 
   3.7066101366240053`*^9, {3.7068186023332243`*^9, 3.706818606139729*^9}, {
   3.706819931075899*^9, 3.706819952632934*^9}, {3.7068208667462187`*^9, 
   3.706820908948037*^9}, {3.706877833788912*^9, 3.7068778403159313`*^9}, {
   3.706944749579064*^9, 3.706944767220848*^9}, {3.7069449701331367`*^9, 
   3.706944970193927*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"trajectory", "[", 
   RowBox[{
   "5", ",", "3", ",", "vars", ",", "1", ",", "th", ",", "tl", ",", "Jh", ",",
     "Jl"}], "]"}], "*)"}]], "Input",
 CellChangeTimes->{3.706612942378175*^9}]
},
WindowSize->{984, 790},
WindowMargins->{{1, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
Magnification:>1.25 Inherited,
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 340, 9, 298, "Input"],
Cell[923, 33, 1991, 32, 36, "Output"]
}, Open  ]],
Cell[2929, 68, 12680, 310, 1275, "Input"],
Cell[15612, 380, 28388, 696, 2537, "Input"],
Cell[44003, 1078, 7252, 166, 970, "Input"],
Cell[51258, 1246, 37692, 902, 2869, "Input"],
Cell[88953, 2150, 8969, 225, 1023, "Input"],
Cell[97925, 2377, 3458, 112, 374, "Input"],
Cell[101386, 2491, 10717, 243, 897, "Input"],
Cell[112106, 2736, 2089, 52, 309, "Input"],
Cell[114198, 2790, 173440, 3810, 18095, "Input"],
Cell[287641, 6602, 1254, 31, 78, "Input"],
Cell[288898, 6635, 230, 6, 36, "Input"]
}
]
*)

