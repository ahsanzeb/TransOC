(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    489495,      11281]
NotebookOptionsPosition[    488532,      11249]
NotebookOutlinePosition[    488973,      11268]
CellTagsIndexPosition[    488930,      11265]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[
 StyleBox[
  RowBox[{
   RowBox[{
   "Incoherent", " ", "Charge", " ", "Transport", " ", "under", " ", "strong",
     " ", "matter"}], "-", 
   RowBox[{
   "light", " ", "coupling", " ", "in", " ", "organic", " ", 
    "microcavities"}]}], "Title"]], "Input",
 CellChangeTimes->{{3.70478296611215*^9, 3.7047829661136017`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "coupling"}], " ", "in", " ", "light", " ", "microcavities", 
   " ", "organic"}], "+", 
  RowBox[{
  "Charge", " ", "Incoherent", " ", "matter", " ", "strong", " ", "Transport",
    " ", "under"}]}]], "Output",
 CellChangeTimes->{
  3.706609530004723*^9, 3.706609895211174*^9, 3.7066099952906513`*^9, 
   3.7066100938726788`*^9, 3.7066102456600113`*^9, 3.7066103632163486`*^9, 
   3.7066105359395437`*^9, 3.7066106217719517`*^9, 3.706610743673415*^9, 
   3.706610833985786*^9, 3.706610954423253*^9, 3.706611133807654*^9, 
   3.706611235637236*^9, 3.706611694970789*^9, 3.706612511691449*^9, 
   3.706612649478977*^9, 3.7066127123203077`*^9, 3.706612761635604*^9, 
   3.706612834511488*^9, 3.70661289069601*^9, 3.706613180533739*^9, 
   3.70661323571681*^9, 3.7067988421482267`*^9, 3.706799893763204*^9, 
   3.706812799470871*^9, 3.706812962752569*^9, 3.7068183901269608`*^9, 
   3.706818531713325*^9, 3.706818773172839*^9, 3.706818845426894*^9, 
   3.706819079311837*^9, 3.706819626624167*^9, 3.7068197674344473`*^9, 
   3.706819982313349*^9, 3.70682056664277*^9, 3.7068209244598207`*^9, 
   3.706821246366961*^9, 3.706864792182317*^9, 3.7068653221196957`*^9, 
   3.706865697575775*^9, 3.706868838827587*^9, 3.706869094820778*^9, 
   3.706869240679016*^9, 3.70686959738586*^9, 3.7068757944872828`*^9, 
   3.706875913295011*^9, 3.706876181028376*^9, 3.706877356137162*^9, 
   3.706877581001154*^9, 3.7069455694449778`*^9, 3.7069457144567337`*^9, 
   3.706946871357212*^9, 3.706947192619609*^9, 3.706948197397256*^9, 
   3.70695027364437*^9, 3.706950527226184*^9, 3.70695075332201*^9, 
   3.70695111137948*^9, {3.7069512621207848`*^9, 3.706951289205604*^9}, 
   3.706951445418252*^9, 3.7069527057842627`*^9, 3.706953756557053*^9, 
   3.706953788628191*^9, 3.70695461893264*^9, 3.7069547519708233`*^9, 
   3.706954911259359*^9, 3.70695501135666*^9, 3.706955118082733*^9, 
   3.706955164662446*^9, 3.70695531376714*^9, 3.7069554035965652`*^9, 
   3.70696698770741*^9, 3.7069798631176767`*^9, 3.706980843549324*^9, 
   3.7069818794675703`*^9, 3.706981951547291*^9, 3.706981989643116*^9, 
   3.707127096104677*^9, 3.707128020525464*^9, 3.707128095829378*^9, 
   3.707128254045527*^9, 3.7071283708247023`*^9, 3.7071284357470303`*^9, 
   3.707128486987393*^9, 3.707129834490595*^9, 3.707130090196158*^9, 
   3.7071302776575937`*^9, 3.707133807145479*^9, 3.707134066104706*^9, 
   3.707134138380673*^9, 3.707134228069084*^9, 3.707134665857224*^9, {
   3.707421361841007*^9, 3.707421380283082*^9}, 3.707437851227703*^9, 
   3.707438095344993*^9, 3.707438174992112*^9, 3.7074383343792467`*^9, {
   3.707438365685842*^9, 3.707438388723424*^9}, 3.70743852248068*^9, {
   3.707438568210663*^9, 3.707438614024472*^9}, 3.707438768529558*^9, 
   3.7074388051694937`*^9, 3.707438934791593*^9, 3.707439032988584*^9, 
   3.707439234901084*^9, 3.707439317399663*^9, 3.707439362865755*^9, 
   3.70743939460105*^9, 3.707439443290988*^9, {3.707439505655568*^9, 
   3.707439532193968*^9}, 3.7074396857025747`*^9, 3.707439769162582*^9, 
   3.7074398082456627`*^9, 3.7074399792924213`*^9, 3.7074406396549673`*^9, 
   3.7074408085803328`*^9, 3.707440903478544*^9, 3.707441207557231*^9, 
   3.707441327257975*^9, 3.707441580861415*^9, 3.7074420866829853`*^9, 
   3.70744233042301*^9, 3.707442386664304*^9, 3.707442508148531*^9, 
   3.707442570112749*^9, 3.707442601383379*^9, 3.707442682477127*^9, 
   3.707442714915535*^9, 3.707442749650552*^9, 3.7074428126638308`*^9, 
   3.707443317401836*^9, 3.707443409048933*^9, 3.7074435155655327`*^9, 
   3.7074675528294983`*^9, 3.707467614073907*^9, 3.707468586999784*^9, 
   3.707470396155789*^9, 3.707470490589573*^9, 3.7074748648605022`*^9, 
   3.707478478263547*^9, 3.707485945636005*^9, 3.707486355429936*^9, 
   3.707486627144202*^9, 3.707488683420301*^9, 3.707489161903953*^9, 
   3.707489381870701*^9, 3.70748972439362*^9, 3.70749033153951*^9, 
   3.7074903787749434`*^9, 3.70751122593008*^9, 3.707547584892879*^9, 
   3.7075700231321373`*^9, 3.707570271348078*^9, 3.708427500177932*^9, 
   3.708427898963702*^9, 3.708429996450964*^9, 3.708430476028336*^9, 
   3.708430519959703*^9, 3.70843091365996*^9, 3.7084310380443163`*^9, 
   3.7084311257865667`*^9, 3.708431251076404*^9, 3.7084319702678547`*^9, 
   3.708449978287429*^9, 3.708450289563979*^9, 3.708450399195476*^9, 
   3.708450558480159*^9, 3.708450761271245*^9, 3.7084509388951*^9, 
   3.7084513535297194`*^9, 3.708451969371078*^9, 3.708452173836217*^9, 
   3.708452273346466*^9, 3.708452498758874*^9, 3.708452612199297*^9, 
   3.70845285693578*^9, 3.708452926712593*^9, 3.708453105831167*^9, 
   3.708453457809944*^9, 3.7084535924756308`*^9, 3.708453695928953*^9, 
   3.7084537398498*^9, 3.7084538086627827`*^9, 3.70845415635439*^9, 
   3.708454272171178*^9, 3.7084546307376757`*^9, 3.7084547740082006`*^9, 
   3.708454811348686*^9, 3.708454845822113*^9, 3.708456496489068*^9, 
   3.7084565982813396`*^9, 3.708456677286512*^9, 3.70845673338211*^9, 
   3.7084568836928053`*^9, {3.708456924297841*^9, 3.708456938086731*^9}, 
   3.7084583979350653`*^9, 3.708515901166377*^9, 3.708516003330098*^9, 
   3.7085160723807697`*^9, 3.708612312941387*^9, 3.709372814933774*^9, 
   3.709373231989707*^9, 3.7093733509089327`*^9, 3.709373474512261*^9, 
   3.709374221088635*^9, 3.709374386450148*^9, 3.709374417950872*^9, 
   3.7093744882279053`*^9, 3.709374615922612*^9, 3.709374696637429*^9, 
   3.7093747841843348`*^9, 3.709374979399651*^9, 3.7093750632604647`*^9, 
   3.709375152137673*^9, 3.7093777681081553`*^9, 3.709377809864637*^9, 
   3.709377888829718*^9, 3.709377981399818*^9, 3.709378320468008*^9, 
   3.7093784856170673`*^9, 3.709378615303796*^9, 3.70937873367057*^9, 
   3.709378813518013*^9, 3.7093788721090307`*^9, 3.7093789154644003`*^9, 
   3.709378997789576*^9, 3.709379045717992*^9, 3.709379138494351*^9, 
   3.709379228492448*^9, 3.709379345194437*^9, 3.7093794680139713`*^9, 
   3.7093795046565857`*^9, 3.7093795849709253`*^9, 3.709379637330957*^9, 
   3.709379861787271*^9, 3.70937993306485*^9, 3.709380104873987*^9, 
   3.7093801928913927`*^9, 3.709380474672799*^9, 3.709380546401815*^9, {
   3.7093805976440783`*^9, 3.7093806250136023`*^9}, {3.7093808192750397`*^9, 
   3.709380834727261*^9}, 3.709380893778713*^9, 3.7093829486719418`*^9, 
   3.709383936893784*^9, 3.70938410768635*^9, 3.709385985886373*^9, 
   3.7093861644493923`*^9, 3.709386309079958*^9, 3.709386523699491*^9, 
   3.709386739580982*^9, 3.709386946399272*^9, {3.709387001672997*^9, 
   3.709387016118717*^9}, 3.709387656495658*^9, 3.709387817511385*^9, 
   3.709395274503215*^9, 3.709396092749847*^9, 3.709397993953493*^9, 
   3.709398157587224*^9, 3.709447479967016*^9, 3.7094490264401712`*^9, 
   3.709449120242629*^9, 3.709449303451956*^9, 3.709451468090927*^9, 
   3.709630021438369*^9, 3.709632209054573*^9, 3.7096325389142942`*^9, 
   3.70963313257976*^9, 3.7096358194189577`*^9, 3.7096363448467093`*^9, 
   3.709636511877808*^9, 3.7096368111210833`*^9, 3.709637635405229*^9, 
   3.709637773307226*^9, 3.709637916209804*^9, 3.70963805916639*^9, 
   3.709638174177292*^9, 3.709638261674678*^9, 3.7096383836114483`*^9, 
   3.709638467658134*^9, 3.7096385386612043`*^9, 3.7096386243865128`*^9, 
   3.70980099719051*^9, 3.709877526806323*^9, 3.709878284207329*^9, 
   3.709878386917611*^9, 3.709878510698427*^9, 3.70987862804697*^9, 
   3.709879386595195*^9, 3.7098795371943893`*^9, 3.709879930950053*^9}]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"c", "[", 
    RowBox[{"n_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Binomial", "[", 
    RowBox[{"n", ",", "m"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"comb", "[", 
    RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
   RowBox[{"Subsets", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"i", ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", "k", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Num", "[", "x_", "]"}], ":=", 
    RowBox[{"N", "[", "x", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Dropp", "[", 
      RowBox[{"Ds_", ",", "elem_"}], "]"}], ":=", 
     RowBox[{"Drop", "[", 
      RowBox[{"Ds", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"Ds", ",", "elem"}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}], "}"}]}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Dropp", "[", 
     RowBox[{"Ds_", ",", "elem_"}], "]"}], ":=", 
    RowBox[{"Complement", "[", 
     RowBox[{"Ds", ",", 
      RowBox[{"{", "elem", "}"}]}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"compared", " ", "to", " ", "old", " ", "above", " ", "def"}], 
    ",", " ", 
    RowBox[{"complement", " ", "also", " ", "removes", " ", "repetition"}], 
    ",", " ", 
    RowBox[{
    "but", " ", "that", " ", "is", " ", "not", " ", "present", " ", "in", " ",
      "our", " ", "case", " ", "unless", " ", "something", " ", "is", " ", 
     RowBox[{"wrong", "!"}]}]}], " ", "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HgMap", "[", 
    RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "tab", ",", "ind1", ",", "listi", ",", "tabx", ",", "sites", ",", 
       "flipsites", ",", "set1", ",", "flip", ",", "listf", ",", "xb", ",", 
       "xa"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tab", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"tabx", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"listi", "=", 
       RowBox[{"comb", "[", 
        RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sites", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"i", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"set1", "=", 
          RowBox[{"listi", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"flipsites", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{"sites", ",", "set1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"flip", "=", 
             RowBox[{"flipsites", "[", 
              RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"listf", "=", 
             RowBox[{"Sort", "[", 
              RowBox[{"Join", "[", 
               RowBox[{"set1", ",", 
                RowBox[{"{", "flip", "}"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"xa", "=", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", 
                RowBox[{"k", "+", "1"}]}], "]"}], "-", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{
                  RowBox[{"N", "-", 
                   RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                  RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"tabx", ",", "xa"}], "]"}], ";"}], "\[IndentingNewLine]",
            ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "flipsites", "]"}]}], "}"}]}], "]"}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"tab", ",", "tabx"}], "]"}], ";", 
         RowBox[{"tabx", "=", 
          RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "tab"}]}], "]"}]}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeHg", "[", 
     RowBox[{"N_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr", ",", "ind1", ",", "ind2", ",", "coora", ",", "ntot", ",", "Hg",
         ",", "ind2sub", ",", "m1"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "seperate", " ", "case", " ", "with", " ", "saturated", " ", 
        "polarisation"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m1", "=", 
        RowBox[{"Min", "[", 
         RowBox[{"m", ",", "N"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[LessEqual]", " ", "N"}], ",", 
           RowBox[{"m1", "=", "m"}], ",", 
           RowBox[{"m1", "=", "N"}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"pntr", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot", "=", 
        RowBox[{"pntr", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Hg", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"pntr", "[", 
             RowBox[{"[", 
              RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind2", "=", 
           RowBox[{
            RowBox[{"pntr", "[", 
             RowBox[{"[", 
              RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
            RowBox[{"HgMap", "[", 
             RowBox[{"N", ",", "k"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"HgMap", "[", 
              RowBox[{"N", ",", "k"}], "]"}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Do", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ind2sub", "=", 
              RowBox[{"ind2", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Do", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{"coora", ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"ind1", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                    RowBox[{"ind2sub", "[", 
                    RowBox[{"[", "j2", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j2", ",", "1", ",", 
                 RowBox[{"Length", "[", "ind2sub", "]"}]}], "}"}]}], "]"}], 
             ";"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "ind1", "]"}]}], "}"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"caution", ":", " ", 
             RowBox[{
              RowBox[{"Sqrt", "[", 
               RowBox[{"m", "-", "k"}], "]"}], "*", "gg", " ", "contains", 
              " ", "m"}]}], ",", " ", 
            RowBox[{"not", " ", "m1"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          
          RowBox[{"Hg", "+=", 
           RowBox[{"SparseArray", "[", 
            RowBox[{
             RowBox[{"coora", "\[Rule]", " ", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{"m", "-", "k"}], "]"}], "*", "gg"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "0", ",", 
           RowBox[{"m1", "-", "1"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Hg", "//", "Num"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DiagH", "[", 
    RowBox[{"N_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Hg", ",", "eval", ",", "U", ",", "Uct"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Hg", "=", 
          RowBox[{"makeHg", "[", 
           RowBox[{"N", ",", "m", ",", "gg"}], "]"}]}], ";", 
         RowBox[{"Hg", "+=", 
          RowBox[{"Transpose", "[", "Hg", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Sort", ",", " ", 
           RowBox[{
            RowBox[{"ascending", " ", 
             RowBox[{
             "order", ":", "\[IndentingNewLine]", "ref", ":", " ", "https", 
              ":"}]}], "//", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"stackoverflow", ".", "com"}], "/", "questions"}], 
               "/", "6589005"}], "/", "sort"}], "-", "eigenvalue", "-", 
             "matrix", "-", "with", "-", "eigenvector", "-", "matrix"}]}]}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"eval", ",", "U"}], "}"}], "=", 
          RowBox[{"Transpose", "@", 
           RowBox[{"SortBy", "[", 
            RowBox[{
             RowBox[{"Transpose", "[", 
              RowBox[{"Eigensystem", "[", "Hg", "]"}], "]"}], ",", "First"}], 
            "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"make", " ", "E"}], "&"}], "U", " ", "by", " ", "hand"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"eval", "=", 
          RowBox[{"{", "0.0", "}"}]}], ";", 
         RowBox[{"U", "=", 
          RowBox[{"{", 
           RowBox[{"{", "1.0", "}"}], "}"}]}], ";"}]}], "\[IndentingNewLine]",
        "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"eval", ",", 
        RowBox[{"U", "//", "Transpose"}]}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.704711807714325*^9, 3.704711813425127*^9}, {
   3.7047118462446747`*^9, 3.7047118558573427`*^9}, {3.704712057541073*^9, 
   3.704712058516942*^9}, 3.7047122388707438`*^9, {3.7047122741652718`*^9, 
   3.704712275165612*^9}, {3.70471231584864*^9, 3.70471242018684*^9}, {
   3.704712600818972*^9, 3.704712610801402*^9}, {3.7047126551668043`*^9, 
   3.704712720771216*^9}, {3.7047127672194233`*^9, 3.704713028586548*^9}, {
   3.7047134059192677`*^9, 3.7047134065007153`*^9}, {3.704713475700178*^9, 
   3.704713568649652*^9}, {3.7047136561039877`*^9, 3.704713823239431*^9}, {
   3.704714404966012*^9, 3.704714488082521*^9}, {3.7047145546562757`*^9, 
   3.704714586734626*^9}, {3.704782815683482*^9, 3.704782830689183*^9}, {
   3.704782932016789*^9, 3.7047829339512377`*^9}, {3.704782991328405*^9, 
   3.704782994373556*^9}, 3.705059563606106*^9, 3.7064282442815247`*^9, 
   3.706431937129348*^9, {3.70660969881048*^9, 3.706609699538361*^9}, 
   3.706868393683447*^9, {3.7068687725561123`*^9, 3.7068687731385927`*^9}, {
   3.706946131375695*^9, 3.70694613463972*^9}, {3.7069468638770113`*^9, 
   3.7069468659969597`*^9}, {3.7069470713407593`*^9, 3.706947138509712*^9}, {
   3.7069471687474003`*^9, 3.706947183867805*^9}, {3.706947228478545*^9, 
   3.706947275331705*^9}, 3.706948192449707*^9, {3.706950567414859*^9, 
   3.7069505843993683`*^9}, {3.7069506432065697`*^9, 3.706950678406303*^9}, {
   3.706950737933709*^9, 3.706950741917148*^9}, 3.706980010025803*^9, {
   3.707032507025247*^9, 3.707032561404948*^9}, {3.7070328977828503`*^9, 
   3.707032903086069*^9}, {3.70711507840989*^9, 3.7071151048465357`*^9}, {
   3.707126683932605*^9, 3.707126728403308*^9}, {3.7071268051771927`*^9, 
   3.707126855687258*^9}, {3.707423364735366*^9, 3.7074233848189287`*^9}, {
   3.707423417550427*^9, 3.707423419700912*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], " ", "+", " ", "A"}], " ", "\[Rule]",
      " ", 
     RowBox[{"A", "'"}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], "+", 
      RowBox[{"A", "[", 
       RowBox[{"m", ",", "N"}], "]"}]}], " ", "\[Rule]", " ", 
     RowBox[{"A", "[", 
      RowBox[{
       RowBox[{"m", "+", "1"}], ",", 
       RowBox[{"N", "+", "2"}]}], "]"}]}], " ", "*)"}],
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "map", " ", "of", " ", "indices", " ", "of", " ", "states", " ", "when", 
      " ", "a", " ", "D"}], ",", 
     RowBox[{
     "Phi", " ", "pair", " ", "combines", " ", "to", " ", "make", " ", "two", 
      " ", "singly", " ", "occupied", " ", "sites"}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{"N", "=", 
     RowBox[{"0", " ", "case"}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAN0c", "[", "m_", "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "ntot3", ",", "ntot4", ",", 
         "Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"init", " ", "basis", " ", "states"}], " ", "=", " ", "1"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot1", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ":", " ", 
           RowBox[{"Final", " ", "basis", " ", "states", " ", "for", " ", 
            RowBox[{"th", "/", "tl"}], " ", 
            RowBox[{"cases", ":", 
             RowBox[{"|", "00"}]}]}]}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"m", "-", "1"}], ">"}], ";", " ", 
           RowBox[{
            RowBox[{"last", " ", "only", " ", "if", " ", "m"}], ">", 
            "0"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", "3", ",", "4"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Only", " ", "middle", " ", "two", " ", "states", " ", "couple", 
           " ", "to", " ", "the", " ", "init", " ", "state", " ", "of", " ", 
           "D"}], ",", "Phi"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAN0cc", "[", "m_", "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "ntot3", ",", "ntot4", ",", 
         "Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"init", " ", "basis", " ", "states"}], " ", "=", " ", "1"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot1", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{"m", ":", " ", 
           RowBox[{
           "Final", " ", "basis", " ", "states", " ", "for", " ", "tlh", " ", 
            
            RowBox[{"case", ":", 
             RowBox[{"|", "00"}]}]}]}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"m", "-", "2"}], ">"}], ";", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"last", " ", "three", " ", "only", " ", "if", " ", "m"}],
              "-", "1"}], "|", 
            RowBox[{"2", " ", "\[GreaterEqual]", "0"}]}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"ntot3", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", "1", ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"m", "\[Equal]", "1"}], ",", "3", ",", "4"}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "1"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "2"}], ":", " ", 
           RowBox[{
           "Final", " ", "basis", " ", "states", " ", "for", " ", "thl", 
            RowBox[{"{", "?", "}"}], " ", "case"}], ":", 
           RowBox[{"|", "00"}]}], ",", 
          RowBox[{
           RowBox[{"m", "+", "2"}], ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{"m", ">"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ntot4", "=", "4"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "4"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot4"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"D", "&"}], "Phi", " ", "sites", " ", "turning", " ", "to", " ", 
     "active", " ", "go", " ", "to", " ", "the", " ", "end", " ", "of", " ", 
     "active", " ", 
     RowBox[{"list", "."}]}], "*)"}], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   RowBox[{
    RowBox[{
     RowBox[{"mapDPhiAc", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "ind1", ",", "ind2", ",", "listi", ",", "tab1", ",", "tab2",
          ",", "set1", ",", "listf", ",", "xlh", ",", "xhl", ",", "tabhl", 
         ",", "tablh"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"listf", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{"N", "+", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{"Lexicographical", " ", 
             RowBox[{"ordering", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"x", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", 
               RowBox[{"k", "+", "1"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"listf", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"only", " ", "when", " ", 
                RowBox[{"(", 
                 RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
               RowBox[{"(", 
                RowBox[{"up", ",", "down"}], ")"}]}], ";", " ", 
              RowBox[{"when", " ", "they", " ", "go", " ", "to", " ", 
               RowBox[{"(", 
                RowBox[{"down", ",", "up"}], ")"}]}]}], ",", " ", 
             RowBox[{"add", " ", "1", " ", "in", " ", "the", " ", "indices"}],
              ",", " ", 
             RowBox[{
             "this", " ", "is", " ", "done", " ", "when", " ", "this", " ", 
              "map", " ", "is", " ", "used"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab1", ",", "x"}], "]"}], ";"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tab2", ",", 
              RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "tab1"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"cc", "===", 
      RowBox[{">", " ", "classical"}]}], ",", " ", 
     RowBox[{"cross", " ", "transitions"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapDPhiAcc", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "ind1", ",", "ind2", ",", "listi", ",", "set1", ",", "xlh", 
         ",", "xhl", ",", "tabhl", ",", "tablh", ",", "listf2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Lexicographical", " ", 
             RowBox[{"ordering", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"k", "=", "0"}], ";", " ", 
             RowBox[{"xlh", " ", "is", " ", "empty", " ", 
              RowBox[{"set", ".", " ", 
               RowBox[{"??", 
                RowBox[{
                 RowBox[{"deal", " ", "k"}], "\[Equal]", 
                 RowBox[{"0", " ", "case", " ", "seperatly"}]}]}]}]}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"xlh", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"set1", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"listf2", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"N", "+", "1"}], ",", 
                 RowBox[{"N", "+", "2"}]}], "}"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xhl", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", 
               RowBox[{"k", "+", "2"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"listf2", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "2", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "+", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"only", " ", "when", " ", 
                RowBox[{"(", 
                 RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
               RowBox[{"(", 
                RowBox[{"up", ",", "down"}], ")"}]}], ";", " ", 
              RowBox[{"when", " ", "they", " ", "go", " ", "to", " ", 
               RowBox[{"(", 
                RowBox[{"down", ",", "up"}], ")"}]}]}], ",", " ", 
             RowBox[{"add", " ", "1", " ", "in", " ", "the", " ", "indices"}],
              ",", " ", 
             RowBox[{
             "this", " ", "is", " ", "done", " ", "when", " ", "this", " ", 
              "map", " ", "is", " ", "used"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tablh", ",", "xlh"}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"tab2", ",", 
               RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tabhl", ",", "xhl"}], "]"}], ";"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tab2", ",", 
              RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tablh", ",", "tabhl"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAc", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr1", ",", "pntr2", ",", "Hta", ",", "Htb", ",", "ind1", ",", 
         "ind2", ",", "ind2a", ",", "ind2b", ",", "coora", ",", "coorb", ",", 
         "ntot1", ",", "Htsp", ",", "ntot2", ",", "Hg", ",", "ind2sub", ",", 
         "ind1reptd", ",", "m1", ",", "m2", ",", "m3", ",", "tab1", ",", 
         "tablh", ",", "tabhl", ",", "Htlh", ",", "Hthl", ",", "pntr3", ",", 
         "ntot3", ",", "indhl", ",", "indlh", ",", "coorhl", ",", "coorlh", 
         ",", "m4", ",", "pntr4", ",", "ntot4", ",", "Htsph", ",", "Htspl", 
         ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"N", "\[Equal]", "0"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Htsph", ",", "Htspl"}], "}"}], "=", 
           RowBox[{"makeHtDPhiAN0c", "[", "m", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m1", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], ";", 
           RowBox[{"m2", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "1"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"m3", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", 
           RowBox[{"m4", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "2"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr1", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{"N", ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot1", "=", 
            RowBox[{"pntr1", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr2", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot2", "=", 
            RowBox[{"pntr2", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"maps", " ", "all", " ", "sectors", " ", 
              RowBox[{"(", 
               RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Hta", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Htb", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Htlh", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Hthl", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"tab1", 
               StyleBox["=",
                FontSize->14], 
               RowBox[{"mapDPhiAc", "[", 
                RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
                 "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"pntr2", "[", 
                 RowBox[{"[", 
                  RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", "tab1"}]}], ";",
               " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", " ", "k", " ", "by", " ", "1"}], ";", " ", 
                 RowBox[{"i", ".", "e", "."}]}], ",", " ", 
                RowBox[{"final", ":", " ", 
                 RowBox[{"k", "+", "1"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind2a", "=", 
               RowBox[{
                RowBox[{"{", "ind2", "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"th", ":", " ", 
                 RowBox[{"(", 
                  RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
                RowBox[{"(", 
                 RowBox[{"up", ",", "down"}], ")"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind2b", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ind2", " ", "+", "1"}], "}"}], "//", 
                "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"tl", ":", " ", 
                 RowBox[{"(", 
                  RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
                RowBox[{"(", 
                 RowBox[{"down", ",", "up"}], ")"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "ind1", "]"}], ">", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"coora", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "ind2a", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"coorb", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "ind2b", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsph", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
           RowBox[{"Htspl", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAcc", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr1", ",", "pntr2", ",", "Hta", ",", "Htb", ",", "ind1", ",", 
         "ind2", ",", "ind2a", ",", "ind2b", ",", "coora", ",", "coorb", ",", 
         "ntot1", ",", "Htsp", ",", "ntot2", ",", "Hg", ",", "ind2sub", ",", 
         "ind1reptd", ",", "m1", ",", "m2", ",", "m3", ",", "tab1", ",", 
         "tablh", ",", "tabhl", ",", "Htlh", ",", "Hthl", ",", "pntr3", ",", 
         "ntot3", ",", "indhl", ",", "indlh", ",", "coorhl", ",", "coorlh", 
         ",", "m4", ",", "pntr4", ",", "ntot4", ",", "Htsph", ",", "Htspl", 
         ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"N", "\[Equal]", "0"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Htsplh", ",", "Htsphl"}], "}"}], "=", 
           RowBox[{"makeHtDPhiAN0cc", "[", "m", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m1", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"m2", "=", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"m", "+", "1"}], ",", 
                RowBox[{"N", "+", "2"}]}], "]"}]}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"m3", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", 
           RowBox[{"m4", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "2"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr1", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{"N", ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot1", "=", 
            RowBox[{"pntr1", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr3", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m3"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot3", "=", 
            RowBox[{"pntr3", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr4", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m4"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot4", "=", 
            RowBox[{"pntr4", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"maps", " ", "all", " ", "sectors", " ", 
              RowBox[{"(", 
               RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Htlh", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Hthl", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"tablh", ",", "tabhl"}], "}"}], 
               StyleBox["=",
                FontSize->14], 
               RowBox[{"mapDPhiAcc", "[", 
                RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
                 "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"indlh", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr3", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tablh"}], 
                 "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{"final", ":", " ", "k"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"indhl", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr4", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "3"}], "]"}], "]"}], "+", "tabhl"}], 
                 "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{"final", ":", " ", 
                RowBox[{"k", "+", "2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "ind1", "]"}], ">", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"coorlh", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "indlh", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Htlh", ",", "coorlh"}], " ", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"coorhl", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "indhl", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Hthl", ",", "coorhl"}], " ", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsplh", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Htlh", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsphl", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Hthl", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot4"}], "}"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"mapHtApairs", ":", " ", 
        RowBox[{
        "for", " ", "Apairs", " ", "that", " ", "can", " ", "make", " ", 
         "D"}]}], " ", "&"}], " ", 
      RowBox[{"Phi", ":", " ", 
       RowBox[{
       "start", " ", "with", " ", "final", " ", "basis", " ", "combination", 
        " ", "and", " ", "add", " ", "two", " ", "sites", " ", "at", " ", 
        "appropriate", " ", "positions", " ", "in", " ", "the", " ", "list", 
        " ", "of", " ", "active", " ", "sites", " ", "with", " ", "one", " ", 
        "being", " ", "up", " ", "and", " ", "other", " ", "down"}]}]}], ",", 
     " ", 
     RowBox[{
     "and", " ", "calc", " ", "index", " ", "for", " ", "initial", " ", 
      "state"}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairsc", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "x2", ",", "listi1", ",", "listi2", 
         ",", "tab1", ",", "tab2", ",", "set1", ",", "set2", ",", "listf1", 
         ",", "listf2", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"up", "/", "down"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf1", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", "n1", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"down", "/", "up"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf2", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", "n2", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"indices", " ", "for", " ", 
                RowBox[{"(", 
                 RowBox[{"N", ",", "k"}], ")"}], " ", "case"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf1", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"x2", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf2", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairsclh", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "listi1", ",", "tab1", ",", "set1", 
         ",", "listf1", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", 
              RowBox[{"k", "-", "2"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"Adding", " ", "up"}], ",", 
                RowBox[{"up", "  ", "at", " ", "n1"}], ",", "n2"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"listf1", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", 
                   RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], "]"}]}], ";", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"both", " ", 
                 RowBox[{"up", ":", " ", "tlh"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"k", "--"}], ">", " ", 
                 RowBox[{"k", "-", "2"}]}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf1", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tab1"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairschl", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "listi1", ",", "tab1", ",", "set1", 
         ",", "listf1", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", "k"}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"dn", ",", 
                RowBox[{"dn", " ", "at", " ", "n1"}], ",", "n2"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"set12", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tab1"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairsc", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "Htb", ",", 
         "coora", ",", "coorb", ",", "ntot1", ",", "tab1", ",", "tab2", ",", 
         "ind1", ",", "ind01", ",", "ind02", ",", "t1", ",", "t2", ",", 
         "Htsph", ",", "Htspl", ",", "m1", ",", "m2", ",", "m3"}], "}"}], ",",
        "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->18], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "1"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"k", " ", "loop", " ", "up", " ", "to", " ", "m3"}], "=", 
            
            RowBox[{
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{"m", ",", 
                RowBox[{"N", "-", "1"}]}], "]"}], " ", "so", " ", "that", " ",
               "\[IndentingNewLine]", "there", " ", "is", " ", "always", " ", 
              "a", " ", "down", " ", "spin", " ", "available", " ", "for", 
              " ", "non"}], "-", 
             RowBox[{"empty", " ", "map"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"starts", " ", "from", " ", "1"}]}], ",", " ", 
          RowBox[{
          "so", " ", "for", " ", "an", " ", "up", " ", "spin", " ", 
           "available"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapHtApairsc", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr1", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
              "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab1", "]"}], ">", "0"}], ",", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", "m3"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairsclh", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "coora", ",", 
         "ntot1", ",", "tab", ",", "ind1", ",", "ind01", ",", "Htsplh", ",", 
         "m1", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->12], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "2"}], ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"k", " ", "loop", " ", "up", " ", "to", " ", "m3"}], "=", 
            
            RowBox[{
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{"m", ",", 
                RowBox[{"N", "-", "1"}]}], "]"}], " ", "so", " ", "that", " ",
               "\[IndentingNewLine]", "there", " ", "is", " ", "always", " ", 
              "a", " ", "down", " ", "spin", " ", "available", " ", "for", 
              " ", "non"}], "-", 
             RowBox[{"empty", " ", "map"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"starts", " ", "from", " ", "1"}]}], ",", " ", 
          RowBox[{
          "so", " ", "for", " ", "an", " ", "up", " ", "spin", " ", 
           "available"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab", "=", 
            RowBox[{"mapHtApairsclh", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind01", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr0", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab"}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "-", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "2"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "}"}], "//", "Transpose"}]}], ";", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "2", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "Htsplh"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairschl", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "coora", ",", 
         "ntot1", ",", "tab", ",", "ind1", ",", "ind01", ",", "Htsphl", ",", 
         "m1", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->12], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"k", " ", "loop", " ", "up", " ", "to", " ", "m3"}], "=", 
            
            RowBox[{
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{"m", ",", 
                RowBox[{"N", "-", "1"}]}], "]"}], " ", "so", " ", "that", " ",
               "\[IndentingNewLine]", "there", " ", "is", " ", "always", " ", 
              "a", " ", "down", " ", "spin", " ", "available", " ", "for", 
              " ", "non"}], "-", 
             RowBox[{"empty", " ", "map"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"starts", " ", "from", " ", "1"}]}], ",", " ", 
          RowBox[{
          "so", " ", "for", " ", "an", " ", "up", " ", "spin", " ", 
           "available"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab", "=", 
            RowBox[{"mapHtApairschl", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind01", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr0", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab"}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", "k"}], "]"}]}], "}"}]}], 
                   "]"}]}], "}"}], "//", "Transpose"}]}], ";", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m3"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "Htsphl"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.704714608463573*^9, 3.70471460949757*^9}, {
   3.70471481279556*^9, 3.704714971927765*^9}, {3.704715004388317*^9, 
   3.704715105774981*^9}, {3.7047151717045116`*^9, 3.7047151728539743`*^9}, {
   3.7064384100016823`*^9, 3.706438425112146*^9}, {3.7068131670185537`*^9, 
   3.706813169284196*^9}, {3.70681674575072*^9, 3.7068167469519577`*^9}, {
   3.706817797704588*^9, 3.706817918201366*^9}, {3.706818043619362*^9, 
   3.706818203911108*^9}, {3.706818288436399*^9, 3.706818377951458*^9}, {
   3.706864653177023*^9, 3.7068647686967783`*^9}, {3.706981564948614*^9, 
   3.706981581548142*^9}, {3.706981628027186*^9, 3.70698163906468*^9}, {
   3.70698170188363*^9, 3.706981705968721*^9}, {3.70698174518009*^9, 
   3.7069817455622263`*^9}, 3.706981981555643*^9, {3.707025994730014*^9, 
   3.707026054423397*^9}, {3.707026108233594*^9, 3.7070264619559517`*^9}, {
   3.7070265064547567`*^9, 3.7070265171238937`*^9}, {3.70707772177667*^9, 
   3.707077722570725*^9}, {3.707115183826769*^9, 3.707115226807206*^9}, {
   3.707115274568321*^9, 3.707115279832485*^9}, {3.707116146050455*^9, 
   3.707116170256777*^9}, {3.7071167361828938`*^9, 3.7071167424927397`*^9}, {
   3.707116806414526*^9, 3.707116819098702*^9}, {3.707120291238853*^9, 
   3.707120300220521*^9}, {3.707120403480719*^9, 3.707120531820743*^9}, {
   3.707120583363739*^9, 3.707120595979162*^9}, {3.707438250392692*^9, 
   3.707438329171371*^9}, {3.7076469893336687`*^9, 3.707646996410509*^9}, {
   3.707647085509995*^9, 3.7076470957482347`*^9}, {3.7076471278089046`*^9, 
   3.7076471307707043`*^9}, {3.7076471881256933`*^9, 3.707647373708581*^9}, {
   3.70765091976376*^9, 3.7076509211426153`*^9}, {3.707651928810335*^9, 
   3.707652003452485*^9}, {3.7076520488330383`*^9, 3.707652071294634*^9}, {
   3.70768357454696*^9, 3.707683609263793*^9}, {3.707683709232265*^9, 
   3.7076837237247667`*^9}, {3.707683955325012*^9, 3.707684283749323*^9}, {
   3.707684335468093*^9, 3.707684875315362*^9}, {3.707684911011653*^9, 
   3.707684961648576*^9}, {3.70768505026888*^9, 3.7076850652133512`*^9}, {
   3.707685209995406*^9, 3.707685504428685*^9}, 3.707685683934684*^9, {
   3.7076857144072847`*^9, 3.707685734450735*^9}, {3.707687609639246*^9, 
   3.707687609805345*^9}, {3.70773233629884*^9, 3.707732337590308*^9}, {
   3.7077331985386744`*^9, 3.707733204207855*^9}, {3.707733275272684*^9, 
   3.7077333247092047`*^9}, {3.707733387968092*^9, 3.707733421479724*^9}, {
   3.707733486584794*^9, 3.707733489952889*^9}, {3.707735211426278*^9, 
   3.7077352198585453`*^9}, {3.707735562363145*^9, 3.7077355680866423`*^9}, {
   3.707735600014574*^9, 3.70773568434853*^9}, {3.7077357196998463`*^9, 
   3.707735768930241*^9}, 3.707735818584964*^9, {3.707735858625021*^9, 
   3.707736084869375*^9}, 3.707745158145357*^9, {3.707745257700436*^9, 
   3.707745296992408*^9}, {3.707745329301344*^9, 3.707745522634096*^9}, {
   3.707745553011898*^9, 3.707745677934808*^9}, {3.7077460157067966`*^9, 
   3.707746032524728*^9}, {3.707995401512171*^9, 3.707995410369718*^9}, {
   3.7079954426408978`*^9, 3.7079954546459513`*^9}, {3.707995494163608*^9, 
   3.7079958425089693`*^9}, {3.708431203745332*^9, 3.7084312039249163`*^9}, {
   3.7084533051740417`*^9, 3.708453349339126*^9}, 3.708453390692143*^9, {
   3.709379571524197*^9, 3.709379629500293*^9}, {3.709395568944882*^9, 
   3.709395570132142*^9}, 3.7093956107615337`*^9, 3.70939572725334*^9, {
   3.709395846269617*^9, 3.709395861961433*^9}, {3.709396010305069*^9, 
   3.7093960104223223`*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"D", "|", 
      RowBox[{"Phi", " ", "+", " ", "A"}]}], " ", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"D", "'"}], "|", 
      RowBox[{
       RowBox[{"Phi", "'"}], " ", "+", 
       RowBox[{"A", "'"}]}]}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "active", " ", "site", " ", "number", " ", "n", " ", "interacting", " ", 
     "with", " ", 
     RowBox[{"D", "/", "Phi"}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapHtDAc", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "taba", ",", "tabb", ",", "listi", ",", "tablh", ",", "tabhl", ",", 
         "xhl", ",", "xlh"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"taba", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabb", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\< DiagHt4DA --------------\>\"", "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\< DiagHt4DA,i=\>\"", ",", "i"}], "]"}], ";"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"listi", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "n"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "up"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"taba", ",", "i"}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "dn"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tabb", ",", "i"}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";"}],
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tabb", "=", 
            RowBox[{"{", "1", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"taba", ",", "tabb"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtDAcc", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "taba", ",", "tabb", ",", "listi", ",", "tablh", ",", "tabhl", ",", 
         "xhl", ",", "xlh", ",", "listf", ",", "listiall"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listiall", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\< DiagHt4DA --------------\>\"", "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\< DiagHt4DA,i,n=\>\"", ",", "i", ",", "\"\< \>\"", ",", 
                "n"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"listi", "=", 
               RowBox[{"listiall", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"listi", ",", "n"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "up"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"tlh", ":", " ", 
                  RowBox[{
                   RowBox[{"k", "--"}], ">", " ", 
                   RowBox[{"k", "-", "1"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"listf", "=", 
                  RowBox[{"Complement", "[", 
                   RowBox[{"listi", ",", 
                    RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<yes: listf = \>\"", ",", "listf"}], "]"}], 
                   ";"}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"drop", " ", "n", " ", "from", " ", "the", " ", 
                   RowBox[{"list", ":", " ", 
                    RowBox[{"k", "-", 
                    RowBox[{"1", " ", "up", " ", "spins", " ", "left"}]}]}]}],
                   "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"xlh", "=", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}], "-", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "1", "-", "p"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "2"}]}], "}"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tablh", ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "xlh"}], "}"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                   "\"\< no: ,k, listi = \>\"", ",", "k", ",", "\"\< \>\"", 
                    ",", "listi"}], "]"}], ";"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "dn"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"thl", ":", " ", 
                  RowBox[{
                   RowBox[{"k", "--"}], ">", " ", 
                   RowBox[{"k", "+", "1"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"listf", "=", 
                  RowBox[{"Sort", "[", 
                   RowBox[{"Join", "[", 
                    RowBox[{"listi", ",", 
                    RowBox[{"{", "n", "}"}]}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"xhl", "=", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", 
                    RowBox[{"k", "+", "1"}]}], "]"}], "-", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tabhl", ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "xhl"}], "}"}]}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listiall", "]"}]}], "}"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tabhl", "=", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"1", ",", "n"}], "}"}], "}"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tablh", ",", "tabhl"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtDAc", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "m1", ",", "pntr", ",", "ntot", ",", "Hta", ",", "Htb", ",", "tab1", 
         ",", "tab2", ",", "ind01", ",", "ind02", ",", "coora", ",", "coorb", 
         ",", "Htsph", ",", "Htspl", ",", "\[IndentingNewLine]", "Htsplh", 
         ",", "Htsphl", ",", "coorlh", ",", "coorhl", ",", "Htlh", ",", 
         "Hthl", ",", "tablh", ",", "tabhl", ",", "pntr2", ",", "pntr3", ",", 
         "ntot2", ",", "ntot3", ",", "ind2i", ",", "ind2f", ",", "ind3i", ",",
          "ind3f", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"m2", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
          RowBox[{"m3", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "+", "1"}], ",", "N"}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapHtDAc", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"th", ",", 
             RowBox[{"tl", ":", " ", "diagonal"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab1", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind01", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind02", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtDAcc", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "m1", ",", "pntr", ",", "ntot", ",", "Hta", ",", "Htb", ",", "tab1", 
         ",", "tab2", ",", "coora", ",", "coorb", ",", "Htsph", ",", "Htspl", 
         ",", "\[IndentingNewLine]", "Htsplh", ",", "Htsphl", ",", "coorlh", 
         ",", "coorhl", ",", "Htlh", ",", "Hthl", ",", "tablh", ",", "tabhl", 
         ",", "pntr2", ",", "pntr3", ",", "ntot2", ",", "ntot3", ",", "ind2i",
          ",", "ind2f", ",", "ind3i", ",", "ind3f", ",", "m2", ",", "m3"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ",", "N"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr3", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m3"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot3", "=", 
         RowBox[{"pntr3", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hthl", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htlh", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<xxxx \>\"", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tablh", ",", "tabhl"}], "}"}], "=", 
            RowBox[{"mapHtDAcc", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<xxxx 1 \>\"", "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"cross", " ", "Homo"}], "-", 
               RowBox[{"Lumo", " ", "transitions"}]}], ";", " ", "tlh"}], ",",
              "thl"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tablh", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind2i", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"tablh", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind2f", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr2", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "+", 
                  RowBox[{"tablh", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coorlh", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind2i", ",", "ind2f", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htlh", ",", "coorlh"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tabhl", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind3i", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"tabhl", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind3f", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr3", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
                  RowBox[{"tabhl", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coorhl", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind3i", ",", "ind3f", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hthl", ",", "coorhl"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "\[Equal]", "0"}], ",", 
          RowBox[{"ntot2", "=", "1"}]}], "]"}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"to", " ", "trick", " ", 
          RowBox[{"psi", ".", "Ht", ".", "U"}], " ", "instead", " ", "of", 
          " ", "If", " ", "statements", " ", "there"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htlh", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hthl", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.704714605692195*^9, 3.704714606511086*^9}, 
   3.704715189590897*^9, {3.704715266480604*^9, 3.70471530918913*^9}, {
   3.704715378077791*^9, 3.7047155241027718`*^9}, {3.7047155592067633`*^9, 
   3.704715585667077*^9}, {3.7047156328381023`*^9, 3.704715634971611*^9}, {
   3.706437809745233*^9, 3.706437810043591*^9}, {3.706437966350472*^9, 
   3.706437982855814*^9}, {3.7064380413821917`*^9, 3.706438148162887*^9}, {
   3.706610228992169*^9, 3.706610238186537*^9}, {3.7066102782558727`*^9, 
   3.706610300757362*^9}, {3.706610488701654*^9, 3.7066105088850527`*^9}, 
   3.706610677055632*^9, 3.7066131136713943`*^9, {3.706613175927685*^9, 
   3.7066131763984632`*^9}, {3.7066136377566338`*^9, 3.706613646723262*^9}, 
   3.70661399003686*^9, {3.706614145985784*^9, 3.7066141591285152`*^9}, 
   3.706614237717515*^9, {3.706614366032309*^9, 3.706614435296002*^9}, {
   3.706614513574514*^9, 3.706614513836746*^9}, {3.706799254045383*^9, 
   3.706799302578809*^9}, {3.706799849416422*^9, 3.706799849766717*^9}, {
   3.706799991102371*^9, 3.706800013949761*^9}, {3.7068000774896927`*^9, 
   3.706800157080764*^9}, {3.70680023736928*^9, 3.7068002865113277`*^9}, {
   3.706818752629966*^9, 3.706818761529006*^9}, {3.706954524638692*^9, 
   3.7069546110749817`*^9}, {3.7069547370654573`*^9, 3.706954747402433*^9}, {
   3.7069795214793987`*^9, 3.706979527083911*^9}, {3.706979823850582*^9, 
   3.706979839409704*^9}, {3.707121083425508*^9, 3.707121088391347*^9}, 
   3.7071211475514727`*^9, {3.707639217375141*^9, 3.707639230746326*^9}, {
   3.70764006584417*^9, 3.707640187641303*^9}, {3.707640231820842*^9, 
   3.707640528446183*^9}, {3.7076405925041437`*^9, 3.70764060012438*^9}, {
   3.707640728472129*^9, 3.707640879741893*^9}, 3.707640915273798*^9, {
   3.707640962119377*^9, 3.7076410111094437`*^9}, {3.707641764759128*^9, 
   3.7076418463785563`*^9}, {3.707641954788477*^9, 3.7076421091324*^9}, {
   3.707729466688364*^9, 3.707729526812262*^9}, {3.707729578791993*^9, 
   3.7077296339651947`*^9}, {3.707729667145823*^9, 3.7077297723965597`*^9}, {
   3.707729846575078*^9, 3.707729849719201*^9}, {3.707729985072968*^9, 
   3.707730057847602*^9}, {3.707730089784178*^9, 3.707730183032236*^9}, {
   3.707730231824233*^9, 3.707730271717514*^9}, {3.707730309014326*^9, 
   3.707730379635038*^9}, {3.707730421396871*^9, 3.707730507810934*^9}, {
   3.707730542627491*^9, 3.7077305681124287`*^9}, {3.7077306069421253`*^9, 
   3.7077308298628683`*^9}, 3.7077309714368343`*^9, {3.7079960580686893`*^9, 
   3.707996101043824*^9}, {3.707996174326687*^9, 3.707996312968369*^9}, {
   3.707996344402121*^9, 3.707996405629013*^9}, {3.708450530021901*^9, 
   3.708450537333515*^9}, {3.7093732107237997`*^9, 3.709373218569744*^9}, {
   3.709373636619928*^9, 3.709373637042227*^9}, {3.709374454338934*^9, 
   3.7093744822730827`*^9}, {3.709374582334158*^9, 3.709374597375299*^9}, {
   3.709374683148188*^9, 3.7093746908452797`*^9}, {3.7093747615501347`*^9, 
   3.709374778445166*^9}, {3.709374962801983*^9, 3.709374976090987*^9}, {
   3.7093750533055468`*^9, 3.709375059086192*^9}, {3.7093750992950068`*^9, 
   3.709375140853579*^9}, {3.7093776276051292`*^9, 3.7093776292365513`*^9}, {
   3.709377672002557*^9, 3.709377833077578*^9}, {3.709377865997813*^9, 
   3.7093778856588717`*^9}, {3.709377971204235*^9, 3.709377977234878*^9}, {
   3.709378227028488*^9, 3.709378286873855*^9}, {3.70937841046906*^9, 
   3.70937842977205*^9}, 3.709378606398521*^9, {3.7093786870901623`*^9, 
   3.709378697287558*^9}, 3.709378775481765*^9, {3.709382623039135*^9, 
   3.7093826332368517`*^9}, {3.709382853540135*^9, 3.7093829400625057`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"\[CapitalPi]", " ", "+", " ", "D"}], "|", 
      RowBox[{"Phi", " ", "+", " ", "A"}]}], " ", "\[Rule]", " ", 
     RowBox[{"\[CapitalPi]", " ", "+", " ", 
      RowBox[{"A", "'"}]}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{"Jh", ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Jl", " ", "for", " ", 
        RowBox[{"contacts", ":", " ", "\[IndentingNewLine]", 
         RowBox[{
         "no", " ", "interference", " ", "terms", " ", "for", " ", "the", " ",
           "contact", " ", "processes", " ", "btw", " ", "Jl"}]}]}], " ", 
       "&"}], " ", "Jh", "\[IndentingNewLine]", "So"}], ",", " ", 
     RowBox[{
     "just", " ", "deal", " ", "with", " ", "them", " ", "seperately"}]}], 
    "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  StyleBox[
   RowBox[{"(*", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"Jl", ":", " ", 
       RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
        RowBox[{"A", "[", 
         RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
      RowBox[{"\[CapitalPi]", " ", "+", " ", 
       RowBox[{"A", "[", 
        RowBox[{
         RowBox[{"N", "+", "1"}], ",", "m"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Jh", ":", " ", 
       RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
        RowBox[{"A", "[", 
         RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
      RowBox[{"\[CapitalPi]", " ", "+", " ", 
       RowBox[{"A", "[", 
        RowBox[{
         RowBox[{"N", "+", "1"}], ",", 
         RowBox[{"m", "+", "1"}]}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
    "*)"}],
   FontSize->14], 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"D", "/", "Phi"}], " ", "site", " ", "turning", " ", "to", " ", 
    "active", " ", "goes", " ", "to", " ", "the", " ", "end", " ", "of", " ", 
    "active", " ", 
    RowBox[{"list", "."}]}], "*)"}], "\[IndentingNewLine]", 
  StyleBox["\[IndentingNewLine]",
   FontSize->14], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapCDA", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x1", ",", "x2", ",", "listi", ",", "tab1", ",", "tab2", ",", "set1", 
         ",", "listf"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"n", ",", "k"}], ")"}], ":", " ", "ind"}], " ", "=", " ", 
          
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"n", ",", "k"}], "]"}], "-", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"n", "-", 
                RowBox[{"listi", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", 
                   RowBox[{"j", "+", "1"}]}], "]"}], "]"}]}], ",", 
               RowBox[{"k", "-", "j"}]}], " ", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "0", ",", 
               RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"listf", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{"N", "+", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", "last", 
             " ", "position"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x1", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "1"}], ",", 
               RowBox[{"k", "+", "1"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1", "-", 
                  RowBox[{"listf", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
           " ", 
           RowBox[{"(*", " ", 
            RowBox[{"for", " ", "adding", " ", "an", " ", "up", " ", "site"}],
             " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "1"}], ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "1", "-", 
                  RowBox[{"set1", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
            "for", " ", "adding", " ", "a", " ", "down", " ", "site"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtCDAN0", "[", "m_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot0", ",", "ntot1", ",", "ntot2", ",", "Htsph", ",", "Htspl"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot0", "=", "1"}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"init", " ", "state"}], ",", " ", 
          RowBox[{"tot", " ", "num", " ", "of", " ", "basis"}]}], " ", "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", "2"}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"Jh", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", "1", ",", "2"}], "]"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"Jl", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"Seperate", " ", "blocks", " ", "of", " ", "Jh"}], ",", 
     RowBox[{
      RowBox[{"Jl", " ", "terms"}], ";", " ", 
      RowBox[{
       RowBox[{
        RowBox[{
        "for", " ", "makeHtCPhiA", " ", "just", " ", "switch", " ", "Jh"}], 
        "&"}], "Jl", " ", "in", " ", "the", " ", "two", " ", "blocks"}]}]}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtCDA", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "pntr2", ",", "ind0", ",", "ntot0", ",", 
         "Hta", ",", "Htb", ",", "ind1", ",", "ind2", ",", "coora", ",", 
         "coorb", ",", "ntot1", ",", "Htsph", ",", "Htspl", ",", "ntot2", ",",
          "tab1", ",", "tab2", ",", "m1"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"N", "\[Equal]", "0"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Htsph", ",", "Htspl"}], "}"}], "=", 
           RowBox[{"makeHtCDAN0", "[", "m", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m1", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pntr0", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{"N", ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pntr1", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{
                    RowBox[{"m", "+", "1"}], ",", 
                    RowBox[{"N", "+", "1"}]}], "]"}]}], "}"}]}], "]"}], ",", 
              "0", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"pntr2", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{"m", ",", 
                    RowBox[{"N", "+", "1"}]}], "]"}]}], "}"}]}], "]"}], ",", 
              "0", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"pntr0", "=", 
              RowBox[{"Insert", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "j"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", 
                "0", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"pntr1", "=", 
              RowBox[{"Insert", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "0", ",", 
                    RowBox[{"m", "+", "1"}]}], "}"}]}], "]"}], ",", "0", ",", 
                "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"pntr2", "=", 
              RowBox[{"Insert", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Sum", "[", 
                   RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "+", "1"}], ",", "j"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "0", ",", "m"}], "}"}]}], "]"}], ",", 
                "0", ",", "1"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
            "*)"}], 
           RowBox[{"ntot0", "=", 
            RowBox[{"pntr0", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"ntot1", "=", 
            RowBox[{"pntr1", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", 
           RowBox[{"ntot2", "=", 
            RowBox[{"pntr2", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"Hta", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Htb", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ind0", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr0", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
                 "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
               RowBox[{"mapCDA", "[", 
                RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"pntr1", "[", 
                 RowBox[{"[", 
                  RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", "tab1"}]}], ";",
               " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"m", "+", 
                 RowBox[{"1", " ", "final", " ", "excitations"}]}], ";", " ", 
                
                RowBox[{
                "shift", " ", "k", " ", "by", " ", "1", " ", "bcs", " ", 
                 "one", " ", "up", " ", "spin", " ", "added"}]}], " ", "*)"}],
               "\[IndentingNewLine]", 
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"pntr2", "[", 
                 RowBox[{"[", 
                  RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}]}], ";",
               " ", 
              RowBox[{"(*", " ", 
               RowBox[{"m", " ", "final", " ", "excitations"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", "ind1", "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"Jh", " ", "for", " ", "D"}], ",", " ", 
                RowBox[{"Jl", " ", "for", " ", 
                 RowBox[{"Phi", ":", " ", 
                  RowBox[{"up", " ", "added"}]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"{", "ind2", "}"}], "//", "Transpose"}]}], ";", "  ", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"Jl", " ", "for", " ", "D"}], ",", " ", 
                RowBox[{"Jh", " ", "for", " ", 
                 RowBox[{"Phi", ":", " ", 
                  RowBox[{"dn", " ", "added"}]}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "tab1", "]"}], ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"coora", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind0", ",", "ind1", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
                RowBox[{
                 RowBox[{"coorb", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind0", ",", "ind2", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
              ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "Hta", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Hta", ",", "1"}], "]"}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Htb", ",", "1"}], "]"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"Htsph", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
           RowBox[{"(*", " ", "Jh", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Htspl", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";"}]}], 
         RowBox[{"(*", " ", "Jl", " ", "*)"}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   StyleBox["\[IndentingNewLine]",
    FontSize->24], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Jh", ":", " ", 
        StyleBox[
         RowBox[{"\[CapitalPi]", " ", "+", " ", 
          RowBox[{"A", "[", 
           RowBox[{"N", ",", "m"}], "]"}]}],
         FontSize->12]}], 
       StyleBox[" ",
        FontSize->12], 
       StyleBox["\[Rule]",
        FontSize->12], 
       StyleBox[" ",
        FontSize->12], 
       StyleBox[
        RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
         RowBox[{"A", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", 
           RowBox[{"m", "-", "1"}]}], "]"}]}],
        FontSize->12]}], 
      StyleBox[";",
       FontSize->12], 
      StyleBox["\[IndentingNewLine]",
       FontSize->12], 
      StyleBox[
       RowBox[{
        RowBox[{"Jl", ":", " ", 
         RowBox[{"\[CapitalPi]", " ", "+", " ", 
          RowBox[{"A", "[", 
           RowBox[{"N", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
        RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
         RowBox[{"A", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", "m"}], "]"}]}]}],
       FontSize->12], 
      StyleBox[";",
       FontSize->12], 
      StyleBox["\[IndentingNewLine]",
       FontSize->12], 
      StyleBox[
       RowBox[{"For", " ", "Phi", " ", "case"}],
       FontSize->12]}], 
     StyleBox[",",
      FontSize->12], 
     StyleBox[" ",
      FontSize->12], 
     StyleBox[
      RowBox[{
       RowBox[{
        RowBox[{"switch", " ", "Jh"}], " ", "&"}], " ", "Jl"}],
      FontSize->12]}], 
    StyleBox["\[IndentingNewLine]",
     FontSize->24], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapCA1", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x1", ",", "listi1", ",", "tab1", ",", "set1", ",", "listf", ",", 
         "set11"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"add", " ", "an", " ", "up", " ", 
           RowBox[{"site", ":", " ", 
            RowBox[{"final", " ", "\[Equal]", ">", "  ", "N"}]}]}], ",", 
          "k"}], " ", "*)"}], "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "1"}], ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "nth", " ", "position"}], ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "as", " ", "they", " ", 
                  "should", " ", "be"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", " ", "by"}], " ", "+", 
                 RowBox[{"1", " ", "all", " ", "labels"}]}], " ", 
                "\[GreaterEqual]", " ", 
                RowBox[{
                "n", " ", "to", " ", "make", " ", "room", " ", "for", " ", 
                 "n"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set11", ",", 
                  RowBox[{"{", "n", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "for", " ", "adding", " ", "an", " ", "up", " ", "site"}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tab1"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapCA2", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x2", ",", "listi2", ",", "tab2", ",", "set2", ",", "listf", ",", 
         "set11"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"add", " ", "a", " ", "down", " ", 
           RowBox[{"site", ":", " ", 
            RowBox[{"final", " ", "\[Equal]", ">", "  ", "N"}]}]}], ",", 
          "k"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"listi2", "=", 
         RowBox[{"comb", "[", 
          RowBox[{
           RowBox[{"N", "-", "1"}], ",", "k"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set2", "=", 
            RowBox[{"listi2", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"set11", "=", 
            RowBox[{"set2", "/.", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"q_Integer", "/;", 
                RowBox[{"q", "\[GreaterEqual]", " ", "n"}]}], "\[Rule]", 
               RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"shift", " ", "by"}], " ", "+", 
              RowBox[{"1", " ", "all", " ", "labels"}]}], " ", 
             "\[GreaterEqual]", " ", 
             RowBox[{
             "n", " ", "to", " ", "make", " ", "room", " ", "for", " ", 
              "n"}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"x2", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{"N", ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", 
                  RowBox[{"set2", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", " ", 
           RowBox[{"(*", " ", 
            RowBox[{
            "for", " ", "adding", " ", "a", " ", "down", " ", "site"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi2", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "tab2"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtCA", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "pntr2", ",", "ntot0", ",", "ntot2", ",", 
         "Hta", ",", "Htb", ",", "coora", ",", "coorb", ",", "ntot1", ",", 
         "Htsph", ",", "Htspl", ",", "tab1", ",", "tab2", ",", "ind1", ",", 
         "ind2", ",", "ind01", ",", "ind02"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"Min", "[", 
                RowBox[{"m", ",", "N"}], "]"}]}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{"m", "-", "1"}], ",", 
                 RowBox[{"N", "-", "1"}]}], "]"}]}], "}"}]}], "]"}], ",", "0",
            ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "1"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"Min", "[", 
                RowBox[{"m", ",", 
                 RowBox[{"N", "-", "1"}]}], "]"}]}], "}"}]}], "]"}], ",", "0",
            ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab1", "=", 
            RowBox[{"mapCA1", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "indices", " ", "list", " ", "of", " ", "final", " ", "states"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"m", "-", 
             RowBox[{"1", " ", 
              RowBox[{"case", ":", " ", 
               RowBox[{"up", " ", "removed"}]}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"k", ">", "0"}], "&&", 
              RowBox[{
               RowBox[{"Length", "[", "ind01", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "1"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab2", "=", 
            RowBox[{"mapCA2", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"m", " ", 
             RowBox[{"case", ":", " ", 
              RowBox[{"down", " ", "removed"}]}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "ind02", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr2", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "1"}], ",", "k"}], "]"}]}], "}"}]}], 
                   "]"}]}], "}"}], "//", "Transpose"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind2", ",", "2"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", 
              RowBox[{"N", "-", "1"}]}], "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Jh", " ", "for", " ", "D"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot2"}], "}"}]}], "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"Jl", " ", "for", " ", "D"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.70471564222936*^9, 3.7047156855868073`*^9}, {
   3.7047191062514963`*^9, 3.704719418479579*^9}, {3.704719454765753*^9, 
   3.704719526880319*^9}, {3.704719674229658*^9, 3.704719759433659*^9}, {
   3.704719818094739*^9, 3.7047198776109247`*^9}, {3.70471991904065*^9, 
   3.7047199195826073`*^9}, {3.7047203268111467`*^9, 3.704720368011285*^9}, {
   3.7047205085383177`*^9, 3.704720671741027*^9}, {3.704720758609118*^9, 
   3.704721039764311*^9}, {3.704721071300601*^9, 3.7047210981088247`*^9}, {
   3.704721153763069*^9, 3.704721236799212*^9}, {3.704721269338023*^9, 
   3.704721343923912*^9}, {3.704721395970655*^9, 3.7047218199225597`*^9}, {
   3.704721850056509*^9, 3.704722037584683*^9}, {3.704727776615264*^9, 
   3.704727810564814*^9}, {3.7047278441354847`*^9, 3.704727876414362*^9}, {
   3.7047279563583937`*^9, 3.704728019820174*^9}, {3.70472805641049*^9, 
   3.704728204411796*^9}, {3.704728241204834*^9, 3.704728241946953*^9}, 
   3.704728572905858*^9, 3.704728617065422*^9, {3.7047286653276033`*^9, 
   3.704728739727767*^9}, 3.7047288167066507`*^9, {3.704728887102583*^9, 
   3.704728888324421*^9}, {3.704728920831266*^9, 3.704729013790954*^9}, {
   3.704729064373402*^9, 3.704729066155026*^9}, {3.704729143128038*^9, 
   3.704729229710351*^9}, {3.704729303345982*^9, 3.704729318799469*^9}, {
   3.7047294065699177`*^9, 3.7047294604975853`*^9}, {3.704730172085589*^9, 
   3.704730499832035*^9}, {3.7047305305122557`*^9, 3.704730682414982*^9}, {
   3.704730721280636*^9, 3.704730916654707*^9}, {3.704730948602818*^9, 
   3.704731016057343*^9}, {3.7047310543991137`*^9, 3.704731065367305*^9}, {
   3.7047310954752083`*^9, 3.704731155786722*^9}, {3.704731202823576*^9, 
   3.704731301445259*^9}, {3.704731370471816*^9, 3.704731455828702*^9}, {
   3.704731499901173*^9, 3.7047315044032927`*^9}, {3.704731563617034*^9, 
   3.704731583635262*^9}, {3.704731657586863*^9, 3.704731680366177*^9}, {
   3.704731764884695*^9, 3.704731793824237*^9}, {3.704731957908206*^9, 
   3.704732016033313*^9}, {3.7047320850714273`*^9, 3.7047321798392687`*^9}, {
   3.70473223800521*^9, 3.704732293191122*^9}, {3.704732329334921*^9, 
   3.704732438400197*^9}, 3.704732949431288*^9, {3.704733072926655*^9, 
   3.7047331485418653`*^9}, {3.7047331999677753`*^9, 3.704733204317116*^9}, {
   3.704733257075979*^9, 3.70473325742607*^9}, {3.704733324615559*^9, 
   3.704733357012047*^9}, {3.704733403681177*^9, 3.704733407104433*^9}, {
   3.7047335753570232`*^9, 3.70473369313955*^9}, {3.704733730938693*^9, 
   3.704733760555891*^9}, {3.7047338052006273`*^9, 3.70473391253232*^9}, 
   3.7047339657312517`*^9, {3.70473401154243*^9, 3.704734081029595*^9}, {
   3.704734142587965*^9, 3.704734182626317*^9}, {3.704734354738261*^9, 
   3.704734398846651*^9}, {3.7047344321760273`*^9, 3.704734440787003*^9}, {
   3.704734522332786*^9, 3.704734529040741*^9}, 3.7047345637679567`*^9, {
   3.704734825475895*^9, 3.704734865649213*^9}, {3.704734957066861*^9, 
   3.704734974305592*^9}, {3.706438210546567*^9, 3.70643821123533*^9}, {
   3.706438274597365*^9, 3.706438274971569*^9}, {3.7064383336786222`*^9, 
   3.706438385459832*^9}, {3.706438441165269*^9, 3.7064384523734694`*^9}, {
   3.7064385405640917`*^9, 3.706438541378409*^9}, {3.706439278209345*^9, 
   3.706439388369965*^9}, {3.7064395376036243`*^9, 3.706439682416197*^9}, {
   3.7064410229414*^9, 3.706441029828095*^9}, {3.706441365098935*^9, 
   3.706441393002801*^9}, {3.706441490904954*^9, 3.706441623310816*^9}, {
   3.7064416568777857`*^9, 3.706441681874051*^9}, {3.706441745378821*^9, 
   3.706441753343813*^9}, {3.706442000271967*^9, 3.706442021422934*^9}, {
   3.706442090656695*^9, 3.7064421053753*^9}, {3.706515704110898*^9, 
   3.706515725101399*^9}, {3.706802422251617*^9, 3.706802432615049*^9}, {
   3.706802472914536*^9, 3.7068024790773983`*^9}, {3.7068025105851727`*^9, 
   3.706802515818658*^9}, {3.706802743553348*^9, 3.7068027479638977`*^9}, {
   3.706802785264496*^9, 3.706802802549424*^9}, {3.706802856431629*^9, 
   3.70680286517148*^9}, {3.7068029268020573`*^9, 3.706802933805621*^9}, {
   3.7068030365109797`*^9, 3.7068030367680473`*^9}, {3.706803069592495*^9, 
   3.70680309755938*^9}, {3.7068031612350063`*^9, 3.7068031794895077`*^9}, {
   3.706803216862616*^9, 3.706803232270884*^9}, {3.70681153052369*^9, 
   3.70681153951023*^9}, {3.706811651516204*^9, 3.706811678288537*^9}, {
   3.7068117647445927`*^9, 3.706811774520339*^9}, {3.706811996837727*^9, 
   3.706811997881351*^9}, {3.706812321633912*^9, 3.7068123346460953`*^9}, {
   3.706812371676209*^9, 3.706812376697806*^9}, {3.706818736052601*^9, 
   3.7068187380377502`*^9}, {3.7068644966719227`*^9, 3.706864624382072*^9}, {
   3.70698178397138*^9, 3.7069817885207663`*^9}, {3.7070268454777527`*^9, 
   3.707026888226709*^9}, {3.707026959907317*^9, 3.7070270818499937`*^9}, {
   3.7070272486560497`*^9, 3.707027316999702*^9}, {3.707121263617937*^9, 
   3.70712127157974*^9}, {3.707121382552629*^9, 3.707121466867199*^9}, {
   3.707121526112298*^9, 3.7071215326548767`*^9}, 3.707121567833074*^9, {
   3.7071216619851217`*^9, 3.7071216777876377`*^9}, {3.707122717902219*^9, 
   3.707122726236968*^9}, {3.70712287698135*^9, 3.707122886181121*^9}, {
   3.7071229175458307`*^9, 3.707122948796206*^9}, {3.707122990363062*^9, 
   3.707123010946012*^9}, {3.707123083084175*^9, 3.7071230978288403`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapGamma", "[", 
     RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "listi", ",", "tab1", ",", "set1", ",", "setf"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab1", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"listi", "=", 
        RowBox[{"comb", "[", 
         RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"set1", "=", 
           RowBox[{"listi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"set1", ",", "n"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"setf", "=", 
              RowBox[{"Complement", "[", 
               RowBox[{"set1", ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", 
                 RowBox[{"k", "-", "1"}]}], "]"}], "-", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{
                   RowBox[{"N", "-", 
                    RowBox[{"setf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                   RowBox[{"k", "-", "1", "-", "p"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"p", ",", "0", ",", 
                   RowBox[{"k", "-", "2"}]}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tab1", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "x"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "tab1"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HtGamma", "[", 
     RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr1", ",", "Hta", ",", "ind1", ",", "ind2", ",", "coora", ",", 
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "inds", ",", 
        "\[IndentingNewLine]", "m1", ",", "m2", ",", "pntr2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m1", "=", 
        RowBox[{"Min", "[", 
         RowBox[{"m", ",", "N"}], "]"}]}], ";", 
       RowBox[{"m2", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "just", " ", "to", " ", "be", " ", "consistent", " ", "with", " ", 
          "pther", " ", "functions", " ", "styles"}], ",", " ", 
         RowBox[{"insert", " ", "0", " ", "at", " ", "1"}], ",", " ", 
         RowBox[{
         "otherwise", " ", "we", " ", "dont", " ", "need", " ", "it", " ", 
          "here", " ", "if", " ", "we", " ", "modify", " ", "the", " ", 
          "lines", " ", "appropriately"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pntr1", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pntr2", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot1", "=", 
        RowBox[{"pntr1", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot2", "=", 
        RowBox[{"pntr2", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"maps", " ", "all", " ", "sectors", " ", 
          RowBox[{"(", 
           RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Hta", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"k", ">", 
          RowBox[{"0", " ", "only"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"inds", "=", 
           RowBox[{"MapGamma", "[", 
            RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", 
                RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ind2", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", "k", "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"ind1", ",", "ind2", ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "m1"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Htsp", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HtKappa", "[", 
    RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Hta", ",", "ntot1", ",", "Htsp", ",", "ntot2", ",", "nsec1", ",", "m1",
        ",", "m2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"maps", " ", "all", " ", "sectors", " ", 
        RowBox[{"(", 
         RowBox[{"up", " ", "spins"}], ")"}], " ", "at", " ", "once"}], ";", 
       " ", "\[IndentingNewLine]", 
       RowBox[{
       "just", " ", "remove", " ", "the", " ", "max", " ", "photon", " ", 
        "sector", " ", "and", " ", "shift", " ", "all", " ", "the", " ", 
        "indices"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m1", "=", 
       RowBox[{"Min", "[", 
        RowBox[{"m", ",", "N"}], "]"}]}], ";", 
      RowBox[{"m2", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ntot1", "=", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"N", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", "m1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ntot2", "=", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"N", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", "m2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "map", " ", "coupled", " ", "states", " ", "up", " ", "to", " ", "an", 
        " ", "upper", " ", "sector", " ", "det", " ", "by", " ", "m2"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Hta", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "i"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Htsp", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"Hta", "\[Rule]", " ", "1"}], ",", 
         RowBox[{"{", 
          RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.706008279353135*^9, 3.706008323221632*^9}, {
  3.706008363678896*^9, 3.706008619898666*^9}, {3.706008663709818*^9, 
  3.7060087165583963`*^9}, {3.7068127605881157`*^9, 3.7068127626663427`*^9}, {
  3.70712420381314*^9, 3.707124245284676*^9}, {3.707124336684984*^9, 
  3.70712444073781*^9}, {3.707124656518868*^9, 3.7071246639964123`*^9}, {
  3.7071247286941013`*^9, 3.707124741507475*^9}, {3.7071255843123617`*^9, 
  3.707125585774282*^9}, {3.7071256257598467`*^9, 3.7071256382056026`*^9}, {
  3.707126547677231*^9, 3.707126604450822*^9}, {3.70712664303269*^9, 
  3.707126649565364*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "Functions", " ", "to", " ", "be", " ", "used", " ", "for", " ", 
    "calculating", " ", "U", " ", "or", " ", "rates", " ", "for", " ", "bulk",
     " ", "and", " ", "contact", " ", 
    RowBox[{"processes", ":", "\[IndentingNewLine]", 
     StyleBox["Diagonalisation",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"DiagH", "\[IndentingNewLine]", "--"}], "--"}], "-", " ", 
      StyleBox[
       RowBox[{
        RowBox[{"Bulk", " ", "--"}], "--"}],
       FontSize->14,
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
      "makeHtDPhiA", "\[IndentingNewLine]", "mkHtDA", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mkHtPhiA", "\[IndentingNewLine]", "--"}], "--"}]}], "-", " ", 
      StyleBox[
       RowBox[{
        RowBox[{
         StyleBox["Contact",
          FontSize->16], 
         StyleBox[" ",
          FontSize->14], 
         StyleBox["--",
          FontSize->14]}], 
        StyleBox["--",
         FontSize->14]}],
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->16,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"makeHtCDA", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"makeHtCA", "\[IndentingNewLine]", "--"}], "--"}]}], "-", " ", 
      StyleBox[
       RowBox[{"Excirton", " ", "nondariative", " ", 
        RowBox[{
         RowBox[{"decays", " ", "--"}], "--"}]}],
       FontSize->14,
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[" ",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"HtGamma", "\[IndentingNewLine]", "--"}], "--"}], "-", " ", 
      StyleBox[
       RowBox[{
        StyleBox["Cavity",
         FontSize->16], 
        StyleBox[" ",
         FontSize->16], 
        RowBox[{
         RowBox[{
          StyleBox["leakages",
           FontSize->16], 
          StyleBox[" ",
           FontSize->14], 
          StyleBox["--",
           FontSize->14]}], 
         StyleBox["--",
          FontSize->14]}]}],
       FontWeight->"Plain"], 
      StyleBox["-",
       FontSize->14,
       FontWeight->"Plain"]}], 
     StyleBox[":",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox["\[IndentingNewLine]",
      FontSize->14,
      FontWeight->"Plain"], 
     StyleBox["HtKappa",
      FontSize->14]}]}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]",
   "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7047824263320303`*^9, 3.7047826101241713`*^9}, {
   3.7047826627965603`*^9, 3.704782672523602*^9}, {3.7047830158934593`*^9, 
   3.704783037396736*^9}, 3.704783154865097*^9, {3.7047997871680937`*^9, 
   3.704799948378956*^9}, {3.704800453010667*^9, 3.704800460915769*^9}, {
   3.70600731263883*^9, 3.706007405947576*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OneDLatticeWays", "[", 
    RowBox[{"Ntot_", ",", "Ds_", ",", "Phis_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "DhopsR", ",", "DhopsL", ",", "DPhiR", ",", "DPhiL", ",", 
       "\[IndentingNewLine]", "PhihopsR", ",", "PhihopsL", ",", "CDhopsR", 
       ",", "CDhopsL", ",", "\[IndentingNewLine]", "CPhihopsR", ",", 
       "CPhihopsL", ",", "LDs", ",", "LPhis", ",", "xD", ",", "xPhi", ",", 
       "Apairs", ",", "CAR", ",", "CAL"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"DhopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DhopsL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DPhiR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"DPhiL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PhihopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"PhihopsL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CDhopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CDhopsL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CPhihopsR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CPhihopsL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CAL", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"CAR", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"Apairs", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LDs", "=", 
       RowBox[{"Length", "[", "Ds", "]"}]}], ";", 
      RowBox[{"LPhis", "=", 
       RowBox[{"Length", "[", "Phis", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"find", " ", 
        RowBox[{"R", "/", "L"}], " ", "hops", " ", "for", " ", "Ds", " ", 
        "and", " ", "DPhi", " ", 
        RowBox[{"R", "/", "L"}], " ", "pairs"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"LDs", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"xD", "=", 
             RowBox[{"Ds", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"Phis", ",", 
                RowBox[{"xD", "+", "1"}]}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"DPhiR", ",", "xD"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"xD", "\[NotEqual]", " ", "Ntot"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xD", "+", "1"}]}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"DhopsR", ",", "xD"}], "]"}]}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"MemberQ", "[", 
               RowBox[{"Phis", ",", 
                RowBox[{"xD", "-", "1"}]}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"DPhiL", ",", "xD"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"xD", "\[NotEqual]", " ", "1"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xD", "-", "1"}]}], "]"}]}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"DhopsL", ",", "xD"}], "]"}]}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xD", "\[Equal]", "1"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CDhopsL", ",", "xD"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xD", "\[Equal]", "Ntot"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CDhopsR", ",", "xD"}], "]"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "LDs"}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"find", " ", 
        RowBox[{"R", "/", "L"}], " ", "hops", " ", "for", " ", "Phis"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"LPhis", ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"xPhi", "=", 
             RowBox[{"Phis", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"FreeQ", "[", 
                RowBox[{"Phis", ",", 
                 RowBox[{"xPhi", "+", "1"}]}], "]"}], "&&", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"Ds", ",", 
                 RowBox[{"xPhi", "+", "1"}]}], "]"}], "&&", 
               RowBox[{"xPhi", "\[NotEqual]", " ", "Ntot"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"PhihopsR", ",", "xPhi"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Phis", ",", 
                   RowBox[{"xPhi", "-", "1"}]}], "]"}], "&&", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"Ds", ",", 
                   RowBox[{"xPhi", "-", "1"}]}], "]"}], "&&", 
                 RowBox[{"xPhi", "\[NotEqual]", " ", "1"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"PhihopsL", ",", "xPhi"}], "]"}]}], "]"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xPhi", "\[Equal]", "1"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CPhihopsL", ",", "xPhi"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"xPhi", "\[Equal]", "Ntot"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"CPhihopsR", ",", "xPhi"}], "]"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "LPhis"}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Apairs", ",", "CAR", ",", "CAL"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{"Ds", ",", "Phis"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"i", "+", "1"}]}], "}"}]}], "]"}], "\[Equal]", 
            RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Apairs", ",", "i"}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Ntot", "-", "1"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"Ds", ",", "1"}], "]"}], "&&", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"Phis", ",", "1"}], "]"}]}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"CAL", ",", "1"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FreeQ", "[", 
          RowBox[{"Ds", ",", "Ntot"}], "]"}], "&&", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"Phis", ",", "Ntot"}], "]"}]}], ",", 
        RowBox[{"AppendTo", "[", 
         RowBox[{"CAR", ",", "Ntot"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
        "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", ",", 
        "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", "Apairs", ",", 
        "CAR", ",", "CAL"}], "}"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.70504549896553*^9, 3.705045738333622*^9}, {
   3.7050459115832577`*^9, 3.705046086369945*^9}, {3.705046130336101*^9, 
   3.705046172779091*^9}, {3.705046294684167*^9, 3.705046299490814*^9}, {
   3.705046371353319*^9, 3.705046500346755*^9}, {3.705046539381912*^9, 
   3.7050466500251207`*^9}, {3.705046700575245*^9, 3.7050467620844193`*^9}, {
   3.705046800540766*^9, 3.705046944985491*^9}, {3.7050469782268953`*^9, 
   3.705046988922833*^9}, {3.705047051752363*^9, 3.7050471939504833`*^9}, 
   3.7050472281104507`*^9, {3.7050478066942387`*^9, 3.7050478986858377`*^9}, {
   3.705048102249098*^9, 3.7050481047664824`*^9}, {3.705052455795651*^9, 
   3.7050527390715227`*^9}, {3.705052785578511*^9, 3.7050528516235447`*^9}, {
   3.7050529231804447`*^9, 3.705052925059116*^9}, {3.705053012748419*^9, 
   3.7050530469463987`*^9}, {3.705053121446436*^9, 3.705053170152327*^9}, {
   3.705053206939783*^9, 3.705053233072888*^9}, {3.705053279595809*^9, 
   3.705053285298525*^9}, {3.70505332284449*^9, 3.705053609473242*^9}, {
   3.705053655663692*^9, 3.7050537175234528`*^9}, {3.705063549877873*^9, 
   3.705063621473752*^9}, {3.705063651783477*^9, 3.705063721915572*^9}, {
   3.705063850919243*^9, 3.705063954969331*^9}, {3.7050640256499577`*^9, 
   3.705064101178584*^9}, 3.705064170206635*^9, {3.7064423849993763`*^9, 
   3.706442393508955*^9}, {3.706463696755846*^9, 3.706463759886174*^9}, {
   3.706463820027171*^9, 3.706463957507036*^9}, {3.706464004439618*^9, 
   3.706464017741399*^9}, {3.706464066363737*^9, 3.706464161461872*^9}, {
   3.70646426522556*^9, 3.7064642716284122`*^9}, {3.706464471269825*^9, 
   3.7064644780420513`*^9}, {3.706464539328771*^9, 3.706464568201128*^9}, 
   3.706464598777768*^9, 3.706464728511417*^9}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"WhichSite", "[", "rlist_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lrz", ",", "Rlist", ",", "eta", ",", "whichsite"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lrz", "=", 
         RowBox[{"Length", "[", "rlist", "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Rlist", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Accumulate", "[", "rlist", "]"}], ",", "0", ",", "1"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eta", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"Rlist", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"whichsite", "=", 
         RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"eta", ">", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{"eta", "\[LessEqual]", "  ", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"whichsite", "=", "i"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "lrz"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"whichsite", "\[Equal]", 
           RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<WhichSite: not found! Aborting... \>\"", "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<rlist: \>\"", ",", "rlist"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Rlist: \>\"", ",", "Rlist"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
         ";", "\[IndentingNewLine]", "whichsite"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"WhichSiteChannel", "[", "rlist_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "lrz", ",", "Rlist", ",", "eta", ",", "whichsite", ",", "wchannel", 
         ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"lrz", "=", 
         RowBox[{"Length", "[", "rlist", "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Rlist", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Accumulate", "[", "rlist", "]"}], ",", "0", ",", "1"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eta", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"Rlist", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"whichsite", "=", 
         RowBox[{"-", "1"}]}], ";", 
        RowBox[{"wchannel", "=", 
         RowBox[{"-", "1"}]}], ";", 
        RowBox[{"x", "=", 
         RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"eta", ">", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{"eta", "\[LessEqual]", "  ", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"x", "=", "i"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "lrz"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"x", "\[Equal]", 
           RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<WhichSiteChannel: not found! Aborting... \>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<rlist: \>\"", ",", "rlist"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Rlist: \>\"", ",", "Rlist"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"whichsite", "=", 
         RowBox[{"Quotient", "[", 
          RowBox[{
           RowBox[{"3", "+", "x"}], ",", "4"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"wchannel", "=", 
         RowBox[{"Mod", "[", 
          RowBox[{"x", ",", "4", ",", "1"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"whichsite", ",", "wchannel"}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FinalDegSec", "[", 
      RowBox[{"Eigs_", ",", "rate_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "i1", ",", "i2", ",", "Rlist", ",", "x", ",", "X", ",", "Elevels", 
         ",", "deg", ",", "nlevels", ",", "r", ",", "whichsec", ",", "eta"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"X", "=", 
         RowBox[{"Tally", "[", "Eigs", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Elevels", "=", 
         RowBox[{"X", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
        RowBox[{"nlevels", "=", 
         RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i1", "=", "0"}], ";", 
        RowBox[{"i2", "=", "0"}], ";", 
        RowBox[{"x", "=", "0"}], ";", 
        RowBox[{"Rlist", "=", 
         RowBox[{"{", "0", "}"}]}], ";", 
        RowBox[{"deg", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"nlevels", "=", 
         RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"i2", "+=", 
            RowBox[{"Elevels", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"deg", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"r", "=", 
            RowBox[{"rate", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"i1", "+", "1"}], ";;", "i2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x", "+=", 
            RowBox[{
             RowBox[{"Norm", "[", "r", "]"}], "^", "2"}]}], ";", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Rlist", ",", "x"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"i1", "=", "i2"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eta", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"Rlist", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"whichsec", "=", 
         RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"eta", ">", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{"eta", "\[LessEqual]", "  ", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"whichsec", "=", "i"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"whichsec", "\[Equal]", 
           RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "\"\<whichsec not found! Aborting... Rlist: \>\"", ",", "Rlist", 
              ",", "\"\< & eta:\>\"", " ", ",", " ", "eta"}], "}"}], ">>>", 
            "file"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"deg", "[", 
         RowBox[{"[", "whichsec", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"EUinds", "=", 
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "3"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "3"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "3"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "2", ",", "3"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "5", ",", "6"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"4", ",", "4", ",", "5", ",", "6"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"7", ",", "7", ",", "8", ",", "9"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"7", ",", "7", ",", "8", ",", "9"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"11", ",", "11", ",", "11", ",", "11"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"10", ",", "10", ",", "10", ",", "10"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"11", ",", "11", ",", "11", ",", "11"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"10", ",", "10", ",", "10", ",", "10"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"11", ",", "11", ",", "11", ",", "11"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"10", ",", "10", ",", "10", ",", "10"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"11", ",", "11", ",", "11", ",", "11"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"10", ",", "10", ",", "10", ",", "10"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"13", ",", "13", ",", "13", ",", "13"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"13", ",", "13", ",", "13", ",", "13"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"12", ",", "12", ",", "12", ",", "12"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"12", ",", "12", ",", "12", ",", "12"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"13", ",", "13", ",", "13", ",", "13"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"13", ",", "13", ",", "13", ",", "13"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"12", ",", "12", ",", "12", ",", "12"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"12", ",", "12", ",", "12", ",", "12"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2", ",", "2", ",", "2"}], "}"}]}], 
      "\[IndentingNewLine]", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ListdNm", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"0", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "2"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "2"}], ",", 
         RowBox[{"-", "2"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "2"}], ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "0"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "0"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"SelectFinalState", "[", 
      RowBox[{"Ef_", ",", "Uf_", ",", "coeff_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "X", ",", "psiff", ",", "deg", ",", "r", ",", "whichsec", ",", 
         "Elevels", ",", "nlevels", ",", "i1", ",", "i2", ",", "Rlist", ",", 
         "x", ",", "eta"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"X", "=", 
         RowBox[{"Tally", "[", "Ef", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Elevels", "=", 
         RowBox[{"X", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";", 
        RowBox[{"nlevels", "=", 
         RowBox[{"Length", "[", "Elevels", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"i1", "=", "0"}], ";", 
        RowBox[{"i2", "=", "0"}], ";", 
        RowBox[{"x", "=", "0"}], ";", 
        RowBox[{"Rlist", "=", 
         RowBox[{"{", "0", "}"}]}], ";", 
        RowBox[{"deg", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"i2", "+=", 
            RowBox[{"Elevels", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"deg", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "i2"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"r", "=", 
            RowBox[{"coeff", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"i1", "+", "1"}], ";;", "i2"}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"x", "+=", 
            RowBox[{
             RowBox[{"Norm", "[", "r", "]"}], "^", "2"}]}], ";", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Rlist", ",", "x"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"i1", "=", "i2"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"eta", "=", 
         RowBox[{"RandomReal", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"Rlist", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], " ", "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"whichsec", "=", 
         RowBox[{"-", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"eta", ">", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
             RowBox[{"eta", "\[LessEqual]", "  ", 
              RowBox[{"Rlist", "[", 
               RowBox[{"[", 
                RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
            RowBox[{
             RowBox[{"whichsec", "=", "i"}], ";", 
             RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "nlevels"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"whichsec", "\[Equal]", 
           RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<WhichSiteChannel: not found! Aborting... \>\"", 
            "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Rlist: \>\"", ",", "Rlist"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"whichsec", "\[Equal]", 
           RowBox[{"-", "1"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
             "\"\<whichsec not found! Aborting... Rlist: \>\"", ",", "Rlist", 
              ",", "\"\< & eta:\>\"", " ", ",", " ", "eta"}], "}"}], ">>>", 
            "file"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Abort", "[", "]"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i1", ",", "i2"}], "}"}], "=", 
         RowBox[{"deg", "[", 
          RowBox[{"[", "whichsec", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"psiff", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"coeff", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "*", 
            RowBox[{"Uf", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "i"}], "]"}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"i1", "+", "1"}], ",", "i2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"psiff", "/", 
         RowBox[{"Norm", "[", "psiff", "]"}]}], ";", "\[IndentingNewLine]", 
        "psiff"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"-", 
           RowBox[{"start", ":", " ", 
            RowBox[{
             RowBox[{"vib", " ", "probability", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"distributiob", " ", "--"}], "--"}], "--"}], 
                  "--"}], "--"}], "--"}], "--"}]}], "-"}]}]}]}]}]}]}]}]}], 
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHgv", "[", 
      RowBox[{"N_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr", ",", "ind1", ",", "ind2", ",", "coora", ",", "ntot", ",", 
         "Hg", ",", "ind2sub", ",", "m1"}], "}"}], ",", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "seperate", " ", "case", " ", "with", " ", "saturated", " ", 
         "polarisation"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"m", "\[LessEqual]", " ", "N"}], ",", 
            RowBox[{"m1", "=", "m"}], ",", 
            RowBox[{"m1", "=", "N"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hg", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"pntr", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
             RowBox[{"Table", "[", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"c", "[", 
                  RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind2", "=", 
            RowBox[{
             RowBox[{"pntr", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
             RowBox[{"HgMap", "[", 
              RowBox[{"N", ",", "k"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"HgMap", "[", 
               RowBox[{"N", ",", "k"}], "]"}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"coora", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ind2sub", "=", 
               RowBox[{"ind2", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"Do", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"coora", ",", " ", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ind1", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                    RowBox[{"ind2sub", "[", 
                    RowBox[{"[", "j2", "]"}], "]"}]}], "}"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"j2", ",", "1", ",", 
                  RowBox[{"Length", "[", "ind2sub", "]"}]}], "}"}]}], "]"}], 
              ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "ind1", "]"}]}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"caution", ":", " ", 
              RowBox[{
               RowBox[{"Sqrt", "[", 
                RowBox[{"m", "-", "k"}], "]"}], "*", "gg", " ", "contains", 
               " ", "m"}]}], ",", " ", 
             RowBox[{"not", " ", "m1"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Hg", "+=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{"coora", "\[Rule]", " ", 
               RowBox[{
                RowBox[{"Sqrt", "[", 
                 RowBox[{"m", "-", "k"}], "]"}], "*", "gg"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{"m1", "-", "1"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Hg", "//", "Num"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"HgMapflip", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "tab", ",", "ind1", ",", "listi", ",", "tabx", ",", "sites", ",", 
         "flipsites", ",", "set1", ",", "flip", ",", "listf", ",", "xb", ",", 
         "xa", ",", "tabflip", ",", "tabflipx"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tab", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabx", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabflip", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabflipx", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"sites", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"i", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"flipsites", "=", 
            RowBox[{"Complement", "[", 
             RowBox[{"sites", ",", "set1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"flip", "=", 
               RowBox[{"flipsites", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"listf", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set1", ",", 
                  RowBox[{"{", "flip", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"xa", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", 
                  RowBox[{"k", "+", "1"}]}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tabx", ",", "xa"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tabflipx", ",", "flip"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "flipsites", "]"}]}], "}"}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab", ",", "tabx"}], "]"}], ";", 
           RowBox[{"tabx", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tabflip", ",", "tabflipx"}], "]"}], ";", 
           RowBox[{"tabflipx", "=", 
            RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tab", ",", "tabflip"}], "}"}]}]}], "]"}]}], " ", ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkXb", "[", 
      RowBox[{"ii_", ",", "NN_", ",", "M_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list", ",", "IM", ",", "xb"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"xb", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"i", "+", "1"}]}], "}"}], "\[Rule]", " ", 
              RowBox[{"Sqrt", "[", "i", "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"M", "-", "1"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"M", ",", "M"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"xb", " ", "+=", " ", 
         RowBox[{"Transpose", "[", "xb", "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
           RowBox[{"xb", "//", "MatrixForm"}], "//", "Print"}], ";"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"list", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"IM", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Band", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"M", ",", "M"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"j", "\[Equal]", "ii"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", "xb"}], "]"}], ",", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"list", ",", "IM"}], "]"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "NN"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"KroneckerProduct", "@@", "list"}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"diagF", "=", 
     RowBox[{
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"Band", "[", 
         RowBox[{"{", 
          RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", 
        RowBox[{"{", "##", "}"}]}], "]"}], "&"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   StyleBox[
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"makeHb", "[", 
       RowBox[{
        RowBox[{"N", "=", "sites"}], ",", 
        RowBox[{"M", "=", "vib_levels"}], ",", 
        RowBox[{"m", "=", 
         RowBox[{"exciton", "+", "photons"}]}]}], "]"}], ",", " ", 
      RowBox[{"out", " ", "=", " ", 
       RowBox[{
       "Hb", " ", "in", " ", "Full", " ", "Hilnert", " ", "space"}]}]}], " ", 
     "*)"}],
    FontSize->12], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHb", "[", 
      RowBox[{"N_", ",", "M_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr", ",", "ind1", ",", "ind2", ",", "coora", ",", "ntot", ",", 
         "Hg", ",", "ind2sub", ",", "m1", ",", "tab", ",", "tabflip", ",", 
         "flips", ",", "i1", ",", "i2", ",", "iup", ",", "XB", ",", "Xb", ",",
          "Hb"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "1.", " ", "make", " ", "displacement", " ", "operators", " ", 
           RowBox[{"Xb", "[", "i", "]"}]}], " ", "=", " ", 
          RowBox[{
           SubscriptBox["b", "i"], "+", 
           SuperscriptBox[
            SubscriptBox["b", "i"], "\[Dagger]"]}]}], "*)"}],
        FontSize->14], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Xb", "[", "i", "]"}], "=", 
           RowBox[{"mkXb", "[", 
            RowBox[{"i", ",", "N", ",", "M"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "N"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"2.", " ", "make", " ", 
            RowBox[{"XB", "'"}], "s", " ", "for", " ", "all", " ", "basis", 
            " ", "states", " ", "of", " ", "electron"}], "-", 
           RowBox[{"photon", " ", "subsystem"}]}], " ", "*)"}],
         FontSize->14], 
        StyleBox["\[IndentingNewLine]",
         FontSize->14], 
        RowBox[{"(*", 
         StyleBox[
          RowBox[{"(*", " ", 
           RowBox[{
           "starting", " ", "state", " ", "needs", " ", "to", " ", "be", " ", 
            "defined", " ", "for", " ", "all", " ", "spin", " ", 
            RowBox[{"down", ":", " ", 
             RowBox[{"a", " ", "zero", " ", "matrix"}]}]}], " ", "*)"}],
          FontSize->14], "*)"}], 
        StyleBox["\[IndentingNewLine]",
         FontSize->14], 
        RowBox[{
         RowBox[{"XB", "[", "1", "]"}], "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"M", "^", "N"}], ",", 
             RowBox[{"M", "^", "N"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "seperate", " ", "case", " ", "with", " ", "saturated", " ", 
          "polarisation"}], " ", "*)"}], 
        StyleBox["\[IndentingNewLine]",
         FontSize->14], 
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"m", "\[LessEqual]", " ", "N"}], ",", 
            RowBox[{"m1", "=", "m"}], ",", 
            RowBox[{"m1", "=", "N"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"pntr", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
             RowBox[{"Table", "[", 
              RowBox[{"i", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"c", "[", 
                  RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab", ",", "tabflip"}], "}"}], "=", 
            RowBox[{"HgMapflip", "[", 
             RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind2", "=", 
            RowBox[{
             RowBox[{"pntr", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", "tab"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ind2sub", "=", 
               RowBox[{"ind2", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"flips", "=", 
               RowBox[{"tabflip", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"Do", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"i1", ",", "i2", ",", "iup"}], "}"}], "=", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"ind1", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                    RowBox[{"ind2sub", "[", 
                    RowBox[{"[", "j2", "]"}], "]"}], ",", 
                    RowBox[{"flips", "[", 
                    RowBox[{"[", "j2", "]"}], "]"}]}], "}"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"make", " ", "the", " ", "new", " ", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"Xb", "'"}], "s"}], "]"}], " ", "from", " ", 
                   "old", " ", "by", " ", "adding", " ", "the", " ", "flip", 
                   " ", 
                   RowBox[{"site", "'"}], "s", " ", "Xb"}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"XB", "[", "i2", "]"}], "=", 
                  RowBox[{
                   RowBox[{"XB", "[", "i1", "]"}], " ", "+", " ", 
                   RowBox[{"Xb", "[", "iup", "]"}]}]}], ";"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"j2", ",", "1", ",", 
                  RowBox[{"Length", "[", "ind2sub", "]"}]}], "}"}]}], "]"}], 
              ";"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "[", "ind1", "]"}]}], "}"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{"m1", "-", "1"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{"3.", " ", "place", " ", "the", " ", 
           RowBox[{"XB", "'"}], "s", " ", "to", " ", "the", " ", "correct", 
           " ", "position", " ", "in", " ", "full", " ", "Hilbert", " ", 
           "space"}], " ", "*)"}],
         FontSize->14], "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"blocks", " ", "of", " ", "dim", " ", 
           RowBox[{"M", "^", "N"}], " ", "corresponding", " ", "to", " ", 
           "each", " ", "elec"}], "-", 
          RowBox[{
          "photon", " ", "basis", " ", "along", " ", "its", " ", 
           "diagonal"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Hb", "=", 
         RowBox[{"diagF", " ", "@@", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"XB", "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", "ntot"}], "}"}]}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Hb", "+=", 
         RowBox[{"Transpose", "[", "Hb", "]"}]}], ";", "\[IndentingNewLine]", 
        "Hb"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHgv", "[", 
      RowBox[{"N_", ",", "M_", ",", "m_", ",", "gg_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Hg", ",", "Ivib", ",", "IM"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"vib", " ", "Identity"}], " ", "*)"}], "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"IM", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Band", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"M", "^", "N"}], ",", 
             RowBox[{"M", "^", "N"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"Hg", " ", "in", " ", "elec"}], "-", 
          RowBox[{"photon", " ", "subspace"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Hg", "=", 
         RowBox[{"mkHgv", "[", 
          RowBox[{"N", ",", "m", ",", "gg"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Hg", "+=", 
         RowBox[{"Transpose", "[", "Hg", "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"(*", " ", 
         RowBox[{"Hg", " ", "in", " ", "full", " ", "space"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{"Hg", ",", "IM"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHv", "[", 
      RowBox[{"NN_", ",", "M_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "list", ",", "IM", ",", "bdb", ",", "Ielec", ",", "Hv", ",", "ntot"}],
         "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"bdb", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"i", ",", "i"}], "}"}], "\[Rule]", " ", 
              RowBox[{"i", "-", "1"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"M", ",", "M"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"IM", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Band", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"M", ",", "M"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Hv", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"M", "^", "NN"}], ",", 
             RowBox[{"M", "^", "NN"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"list", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"j", "\[Equal]", "ii"}], ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"list", ",", "bdb"}], "]"}], ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"list", ",", "IM"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "NN"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Hv", " ", "+=", " ", 
            RowBox[{"KroneckerProduct", "@@", "list"}]}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"ii", ",", "1", ",", "NN"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"c", "[", 
            RowBox[{"NN", ",", "i"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", 
             RowBox[{"Min", "[", 
              RowBox[{"m", ",", "NN"}], "]"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Ielec", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Band", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], "}"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"KroneckerProduct", "[", 
         RowBox[{"Ielec", ",", "Hv"}], " ", "]"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"map1dn", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tabb", ",", "listi"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tabb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", 
            RowBox[{"(*", " ", 
             RowBox[{"1", "st", " ", "spin", " ", "is", " ", "dn"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"FreeQ", "[", 
                 RowBox[{
                  RowBox[{"listi", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "1"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tabb", ",", "i"}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";"}],
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tabb", "=", 
            RowBox[{"{", "1", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", "tabb"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"list", " ", "of", " ", "elec"}], "-", 
     RowBox[{
     "phot", " ", "states", " ", "with", " ", "site", " ", "1", " ", 
      "down"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mk1dnlist", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m1", ",", "pntr", ",", "Htb", ",", "tab2", ",", "ind02"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"m2", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
          RowBox[{"m3", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "+", "1"}], ",", "N"}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab2", "=", 
            RowBox[{"map1dn", "[", 
             RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"pntr", "[", 
              RowBox[{"[", 
               RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "ind02"}], "]"}], ";"}]}], "]"}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Htb", ",", "1"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}],
     ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Probvib1dn", "[", 
      RowBox[{"psi_", ",", "NN_", ",", "m_", ",", "M_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "lst1dn", " ", ",", "nvib", ",", "nep", ",", "psii", ",", "nvib1", 
         ",", "prob", ",", "psi1", ",", "tot"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "restructure", " ", "psi", " ", "to", " ", "make", " ", "the", " ", 
         "blocks", " ", "of", " ", "vib", " ", "subspace"}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"nvib", "=", 
         RowBox[{"M", "^", "NN"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<Length[psi]= \>\"", ",", 
            RowBox[{"Length", "[", "psi", "]"}]}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"nep", "=", 
         RowBox[{
          RowBox[{"Length", "[", "psi", "]"}], "/", "nvib"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<nep, nvib = \>\"", ",", "nep", ",", " ", "\"\< \>\"", ",", 
            "nvib"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"psi1", " ", "=", " ", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{"psi", ",", 
           RowBox[{"{", 
            RowBox[{"nep", ",", "nvib"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"psi1", "//", "Dimensions"}], "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"list", " ", "of", " ", "elec"}], "-", 
          RowBox[{
          "phot", " ", "states", " ", "with", " ", "site", " ", "1", " ", 
           "down"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"lst1dn", " ", "=", " ", 
         RowBox[{"mk1dnlist", "[", 
          RowBox[{"NN", ",", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "pick", " ", "these", " ", "sectors", " ", "and", " ", "reduce", " ",
           "vib", " ", "state"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"nvib1", "=", 
         RowBox[{"nvib", "/", "M"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"=", " ", 
          RowBox[{
           RowBox[{"M", "^", 
            RowBox[{"(", 
             RowBox[{"NN", "-", "1"}], ")"}]}], " ", "states", " ", "for", 
           " ", "each", " ", "vib", " ", "level", " ", "of", " ", "site", " ",
            "1"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"prob", "=", 
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "M"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"psii", "=", 
            RowBox[{"ArrayReshape", "[", 
             RowBox[{
              RowBox[{"psi1", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"M", ",", "nvib1"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"prob", " ", "+=", 
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", "psii", "]"}], "^", "2"}], ",", 
              RowBox[{"{", "2", "}"}]}], "]"}]}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "lst1dn"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tot", "=", 
         RowBox[{"Total", "[", "prob", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"tot", "\[NotEqual]", " ", "0"}], ",", 
          RowBox[{"prob", "=", 
           RowBox[{"prob", "/", "tot"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", "prob"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GetProbnv", "[", 
      RowBox[{
      "NN_", ",", "m_", ",", "M_", ",", "gg_", ",", "wv_", ",", "lam_"}], 
      "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot", ",", "wvlam", ",", "H", ",", "nn", ",", "eval", ",", "evec", 
         ",", "pr"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot", "=", 
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{"NN", ",", "i"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{"Min", "[", 
               RowBox[{"m", ",", "NN"}], "]"}]}], "}"}]}], "]"}], " ", "*", 
          " ", 
          RowBox[{"M", "^", "NN"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"wvlam", "=", 
         RowBox[{"wv", "*", "lam"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"H", " ", "=", " ", 
         RowBox[{
          RowBox[{"wv", "*", 
           RowBox[{"makeHv", "[", 
            RowBox[{"NN", ",", "M", ",", "m"}], "]"}]}], " ", "+", " ", 
          RowBox[{"makeHgv", "[", 
           RowBox[{"NN", ",", "M", ",", "m", ",", "gg"}], "]"}], " ", "+", 
          " ", 
          RowBox[{"wvlam", "*", 
           RowBox[{"makeHb", "[", 
            RowBox[{"NN", ",", "M", ",", "m"}], "]"}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"nn", "=", 
         RowBox[{"Norm", "[", 
          RowBox[{"Flatten", "[", "H", "]"}], "]"}]}], ";", "\n", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"eval", ",", "evec"}], "}"}], "=", 
         RowBox[{"Eigensystem", "[", 
          RowBox[{
           RowBox[{"H", "-", 
            RowBox[{"nn", "*", 
             RowBox[{"SparseArray", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Band", "[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}], "]"}], "\[Rule]", "1"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}]}], ",", "1"}],
           "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"eval", "=", 
         RowBox[{"eval", "+", "nn"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<N,m =\>\"", ",", "NN", ",", "\"\<,\>\"", ",", "m", ",", 
            "\"\< ==> E_LP with vibrations = \>\"", ",", "eval"}], "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pr", "=", 
         RowBox[{"Probvib1dn", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"evec", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "//", "Chop"}], ",", "NN", ",", 
           "m", ",", "M"}], "]"}]}], ";", "\[IndentingNewLine]", "pr"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"--", 
     RowBox[{"--", 
      RowBox[{"--", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"-", 
           RowBox[{"end", ":", " ", 
            RowBox[{
             RowBox[{"vib", " ", "probability", " ", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"distributiob", " ", "--"}], "--"}], "--"}], 
                  "--"}], "--"}], "--"}], "--"}]}], "-"}]}]}]}]}]}]}]}]}], 
    "*)"}], "\[IndentingNewLine]"}]}]], "Input",
 CellChangeTimes->{{3.706442387793564*^9, 3.706442389499921*^9}, {
   3.706597405116604*^9, 3.706597407575985*^9}, {3.707422416163041*^9, 
   3.7074224405457277`*^9}, {3.707431167263742*^9, 3.707431167720014*^9}, {
   3.707437501111212*^9, 3.7074375086856327`*^9}, {3.707438702062916*^9, 
   3.7074387647418633`*^9}, {3.707438800786371*^9, 3.70743882717566*^9}, {
   3.7074389293847427`*^9, 3.7074389298398867`*^9}, {3.707438992330653*^9, 
   3.707439004088991*^9}, 3.707474824797802*^9, {3.707476668189713*^9, 
   3.707476673744124*^9}, {3.707477144013877*^9, 3.707477147668951*^9}, {
   3.7074771836075983`*^9, 3.707477194646821*^9}, {3.707478184286105*^9, 
   3.707478411989221*^9}, {3.707486238464444*^9, 3.707486350514532*^9}, {
   3.7074886171429367`*^9, 3.707488651677621*^9}, {3.7074899978212843`*^9, 
   3.707490101631032*^9}, 3.7075562041084642`*^9, {3.707556465296913*^9, 
   3.707556465597128*^9}, {3.707570192815255*^9, 3.7075701948070517`*^9}, {
   3.707643443990693*^9, 3.707643461515698*^9}, {3.707767349533687*^9, 
   3.707767377798472*^9}, {3.707767429796701*^9, 3.707767550917728*^9}, {
   3.707828475271785*^9, 3.707828479486246*^9}, {3.707829239606718*^9, 
   3.7078292632852488`*^9}, 3.707997989236281*^9, {3.70800528292855*^9, 
   3.708005284077886*^9}, {3.708166287264021*^9, 3.70816629029732*^9}, {
   3.70817896860832*^9, 3.708178968983526*^9}, {3.708179863119193*^9, 
   3.70817986406187*^9}, {3.708424224751405*^9, 3.708424242094337*^9}, 
   3.708428375283702*^9, {3.7084304619354353`*^9, 3.708430464366641*^9}, {
   3.708430563067778*^9, 3.708430584244149*^9}, {3.7084307117049513`*^9, 
   3.708430760718299*^9}, {3.70843081941993*^9, 3.708430840762134*^9}, {
   3.708430885120529*^9, 3.7084309016955853`*^9}, {3.708430933389217*^9, 
   3.70843094512501*^9}, {3.708431218538072*^9, 3.708431223183185*^9}, {
   3.708450063713048*^9, 3.7084501243190937`*^9}, {3.708452422017679*^9, 
   3.7084524768614187`*^9}, {3.708452581427462*^9, 3.7084526073169737`*^9}, {
   3.708456543748239*^9, 3.708456544531498*^9}, {3.708456860075646*^9, 
   3.70845687941693*^9}, {3.7085158560150557`*^9, 3.70851587010318*^9}, 
   3.70851593637086*^9, 3.708516068556212*^9, {3.709451449807726*^9, 
   3.709451459502199*^9}, 3.7094515528936462`*^9, {3.709627720505548*^9, 
   3.70962772249842*^9}, {3.70962777385962*^9, 3.709628025938484*^9}, {
   3.709628096939396*^9, 3.709628151983346*^9}, 3.7096325333672533`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{GridBox[{
      {"jump", 
       RowBox[{"description", "               "}], 
       RowBox[{"   ", "IEig"}], "IHt", 
       RowBox[{"sites", "?", " ", "\[IndentingNewLine]", 
        RowBox[{"yes", ":", " ", 
         RowBox[{"calc", " ", "Ht", " ", "again"}]}]}]},
      {"1", 
       RowBox[{"D", " ", "hops", " ", "Right"}], "1", "1", "yes"},
      {"2", 
       RowBox[{"D", " ", "hops", " ", "Left"}], "1", "1", "yes"},
      {"3", 
       RowBox[{"\[Phi]", " ", "hops", " ", "Right"}], "1", "2", "yes"},
      {"4", 
       RowBox[{"\[Phi]", " ", "hops", " ", "Left"}], "1", "2", "yes"},
      {"5", 
       RowBox[{"D", ",", 
        RowBox[{"\[Phi]", " ", "annihilated"}]}], "2", "3", "no"},
      {"6", 
       RowBox[{"\[Phi]", ",", 
        RowBox[{"D", " ", "annihilated"}]}], "2", "3", 
       RowBox[{"no", ";", " ", "penalty"}]},
      {"7", 
       RowBox[{"D", ",", 
        RowBox[{"\[Phi]", " ", "created"}]}], "3", "4", "yes"},
      {"8", 
       RowBox[{"\[Phi]", ",", 
        RowBox[{"D", " ", "created"}]}], "3", "4", 
       RowBox[{"yes", ";", 
        RowBox[{"jump", "=", "6"}]}]},
      {"9", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", "m"}], "4", "5", "no"},
      {"10", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "5", "5", "no"},
      {"11", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", "m"}], "4", "5", "no"},
      {"12", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "5", "5", "no"},
      {"13", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", "m"}], "4", "5", 
       "no"},
      {"14", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "5", "5", "no"},
      {"15", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", "m"}], "4", "5", 
       "no"},
      {"16", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "5", "5", "no"},
      {"17", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", "m"}], "6", "6", 
       RowBox[{"-", "no"}]},
      {"18", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", "m"}], "6", "6", 
       RowBox[{"-", "no"}]},
      {"19", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "7", "6", 
       RowBox[{"-", "no"}]},
      {"20", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "7", "6", 
       RowBox[{"-", "np"}]},
      {"21", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", "m"}], "6", "7", 
       RowBox[{"-", "no"}]},
      {"22", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", "m"}], "6", "7", 
       RowBox[{"-", "no"}]},
      {"23", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "7", "7", 
       RowBox[{"-", "no"}]},
      {"24", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "7", "6", 
       RowBox[{"-", "no"}]},
      {"25", 
       RowBox[{"\[Kappa]", ":", " ", 
        RowBox[{"cavity", " ", "leackage"}]}], "8", "8", 
       RowBox[{"-", "no"}]},
      {"26", 
       RowBox[{"\[Gamma]", ":", " ", 
        RowBox[{"exciton", " ", "decay"}]}], "8", "9", "yes"},
      {"\[Placeholder]", "\[Placeholder]", "\[Placeholder]", "\[Placeholder]",
        "\[Placeholder]"},
      {"\[Placeholder]", "\[Placeholder]", "\[Placeholder]", "\[Placeholder]",
        "\[Placeholder]"}
     },
     GridBoxDividers->{
      "Columns" -> {{True}}, "ColumnsIndexed" -> {}, "Rows" -> {{True}}, 
       "RowsIndexed" -> {}}], "\[IndentingNewLine]", GridBox[{
      {"jump", "process", 
       RowBox[{"current", " ", "L", " ", "to", " ", "R"}]},
      {"9", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", "m"}], "1"},
      {"10", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "1"},
      {"11", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", "m"}], 
       RowBox[{"-", "1"}]},
      {"12", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], 
       RowBox[{"-", "1"}]},
      {"13", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", "m"}], 
       RowBox[{"-", "1"}]},
      {"14", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], 
       RowBox[{"-", "1"}]},
      {"15", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", "m"}], "1"},
      {"16", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "annihilated"}]}], ",", " ", 
        RowBox[{"m", "+", "1"}]}], "1"},
      {"17", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", "m"}], 
       RowBox[{"-", "1"}]},
      {"18", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", "m"}], "1"},
      {"19", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], 
       RowBox[{"-", "1"}]},
      {"20", 
       RowBox[{
        RowBox[{"RC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "1"},
      {"21", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", "m"}], "1"},
      {"22", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", "m"}], 
       RowBox[{"-", "1"}]},
      {"23", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"D", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], "1"},
      {"24", 
       RowBox[{
        RowBox[{"LC", ":", 
         RowBox[{"\[Phi]", " ", "created"}]}], ",", " ", 
        RowBox[{"m", "-", "1"}]}], 
       RowBox[{"-", "1"}]}
     },
     GridBoxDividers->{
      "Columns" -> {{True}}, "ColumnsIndexed" -> {}, "Rows" -> {{True}}, 
       "RowsIndexed" -> {}}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.707430571969721*^9, 3.707430578815934*^9}, {
  3.707475075456484*^9, 3.707475085014579*^9}, {3.707477279241929*^9, 
  3.70747729268852*^9}, {3.70747737179049*^9, 3.707477529519137*^9}, {
  3.7074775787890387`*^9, 3.707477639226885*^9}, {3.707478114739078*^9, 
  3.7074781155974903`*^9}, {3.7093971122472467`*^9, 3.7093971128439627`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"trajectory", "[", 
    RowBox[{
    "Ntot_", ",", "vars_", ",", "gg_", ",", "tpar_", ",", "kappa_", ",", 
     "gamma_", ",", "Er_", ",", "w0_", ",", "beta_", ",", "maxiter_", ",", 
     "includecross_", ",", "BlockInjection_", ",", "M_", ",", "wv_", ",", 
     "lam_", ",", "AlwaysLP_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "UNm", ",", "UNp1mp1", ",", "UNm1mm1", ",", "UNp1m", ",", "UNm1m", ",", 
       "HtDA", ",", "RDA", ",", "HtPhiA", ",", "RPhiA", ",", "HtDPhiA", ",", 
       "UNp2mp1", ",", "RDPhiA", ",", "HtDPhiAinv", ",", "UNm2mm1", ",", 
       "RDPhiAinv", ",", "HtCDAh", ",", "HtCDAl", ",", "RCDAh", ",", "RCDAl", 
       ",", "HtCAh", ",", "HtCAl", ",", "RCAh", ",", "RCAl", ",", "Es", ",", 
       "\[IndentingNewLine]", "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", 
       "PhihopsL", ",", "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", 
       "CDhopsR", ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", 
       "Apairs", ",", "CAR", ",", "CAL", ",", "Cproc", ",", "CDAproc", ",", 
       "\[IndentingNewLine]", "RDAM", ",", "RPhiAM", ",", "RDPhiAM", ",", 
       "RDPhiAinvM", ",", "RCDAhM", ",", "RCDAlM", ",", "RCAhM", ",", "RCAlM",
        ",", "n", ",", "Ds", ",", "Phis", ",", "m", ",", "ASites", ",", 
       "\[IndentingNewLine]", "ENm", ",", "ENp1mp1", ",", "ENm1mm1", ",", 
       "ENp1m", ",", "ENm1m", ",", "ENp2mp1", ",", "ENm2mm1", ",", "Elevels", 
       ",", "times", ",", "tmax", ",", "t", ",", "dt", ",", "R", ",", "ldr", 
       ",", "ldl", ",", "lpr", ",", "lpl", ",", "\[IndentingNewLine]", 
       "lApairs", ",", "si1", ",", "si2", ",", "sapos", ",", "lcdr", ",", 
       "lcdl", ",", "lcpr", ",", "lcpl", ",", "lcdaproc", ",", 
       "\[IndentingNewLine]", "lcar", ",", "lcal", ",", "CAproc", ",", "lcAp",
        ",", "r1", ",", "r1b", ",", "r2", ",", "r2b", ",", "r3", ",", "r4", 
       ",", "r5", ",", "r6", ",", "r7", ",", "r8", ",", "r9", ",", "r10", ",",
        "r11", ",", "r12", ",", "r13", ",", "r14", ",", "\[IndentingNewLine]",
        "r1z", ",", "r1bz", ",", "r2z", ",", "r2bz", ",", "r3z", ",", "r4z", 
       ",", "r5x", ",", "r6x", ",", "x1", ",", "x2", ",", "r9xh", ",", "r9xl",
        ",", "r10xh", ",", "r10xl", ",", "r11xh", ",", "r11xl", ",", "r12xh", 
       ",", "r12xl", ",", "\[IndentingNewLine]", "r9i", ",", "r10i", ",", 
       "r11i", ",", "r12i", ",", "rcd", ",", "rcp", ",", "rcdi", ",", "rcpi", 
       ",", "r14z", ",", "\[IndentingNewLine]", "HtDAR", ",", "HtDAL", ",", 
       "RDAR", ",", "RDAL", ",", "HtPhiAR", ",", "RPhiAR", ",", "HtPhiAL", 
       ",", "RPhiAL", ",", "\[IndentingNewLine]", "HtApairs", ",", "ENmm1", 
       ",", "UNmm1", ",", "RkappaM", " ", ",", "Rkappa", ",", "Rgamma", ",", 
       "rates", ",", "totrates", ",", "\[IndentingNewLine]", "ltotr", ",", 
       "slist", ",", "u", ",", "eta", ",", "wj", ",", "process", ",", "lp", 
       ",", "whichstates", ",", "pos", ",", "apos", ",", "rate", ",", 
       "\[IndentingNewLine]", "ldpr", ",", "ldpl", ",", "nlevels", ",", 
       "Rlist", ",", "degen", ",", "whichsec", ",", "psif", ",", "i1", ",", 
       "i2", ",", "xtot", ",", "Dsvst", ",", "Phisvst", ",", "mvst", ",", 
       "Neig", ",", "istate", ",", "psi", ",", "\[IndentingNewLine]", "ldpa", 
       ",", "NN", ",", "p1", ",", "p2", ",", "ITER", ",", "m1", ",", "Einit", 
       ",", "HtApaira", ",", "HtApairb", ",", "out2", ",", "Evst", ",", "tlh",
        ",", "thl", ",", "th", ",", "tl", ",", "tpard", ",", "tparp", ",", 
       "Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl", ",", "RDPhiAh", 
       ",", "RDPhiAl", ",", "RDPhiAhl", ",", "RDPhiAlh", ",", "ENp2m", ",", 
       "UNp2m", ",", "ENp2mp2", ",", "UNp2mp2", ",", "rr", ",", "ENmp1", ",", 
       "UNmp1", ",", "logkg", ",", "logNmm1", ",", "ws", ",", "wc", ",", "U", 
       ",", "ratef", ",", "dN", ",", "dm", ",", "RCAlR", ",", "RCAlL", ",", 
       "RCAhR", ",", "RCAhL", ",", "r", ",", "rz", ",", "HtDAc", ",", 
       "HtDAclh", ",", "HtDAchl", ",", "rlist", ",", "ii", ",", "saposOrder", 
       ",", "t1", ",", "t2", ",", "ts78", ",", "rrAinv", ",", "HtApairlh", 
       ",", "HtApairhl", ",", "rrcdal", ",", "rrcdah", ",", "rrcalr", ",", 
       "rrcahr", ",", "rrcall", ",", "rrcahl", ",", "j", ",", "HtCAhL", ",", 
       "HtCAlL", ",", "JhR", ",", "JlR", ",", "JhL", ",", "JlL", ",", "fr1", 
       ",", "fr2", ",", "fr3", ",", "fr4", ",", "fl1", ",", "fl2", ",", "fl3",
        ",", "fl4", ",", "pf", ",", "HtCAhR", ",", "HtCAlR", ",", "ZQ", ",", 
       "EBL", ",", "HBL", ",", "fl4v", ",", "fr4v"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ChooseFinalState", "[", 
        RowBox[{"wj_", ",", "ws_", ",", "wc_"}], "]"}], ":=", 
       RowBox[{"Module", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"ind", ",", "Ef", ",", "Uf", ",", "coeff"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ind", "=", 
           RowBox[{"EUinds", "[", 
            RowBox[{"[", 
             RowBox[{"wj", ",", "wc"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Ef", "=", 
           RowBox[{"Es", "[", "ind", "]"}]}], ";", 
          RowBox[{"Uf", "=", 
           RowBox[{"U", "[", "ind", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"coeff", "=", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"wj", "==", "1"}], ",", 
             RowBox[{"RDAR", "[", 
              RowBox[{"ws", ",", "wc"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"wj", "\[Equal]", "2"}], ",", 
             RowBox[{"RDAL", "[", 
              RowBox[{"ws", ",", "wc"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"wj", "\[Equal]", "3"}], ",", 
             RowBox[{"RPhiAR", "[", 
              RowBox[{"ws", ",", "wc"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"wj", "\[Equal]", "4"}], ",", 
             RowBox[{"RPhiAL", "[", 
              RowBox[{"ws", ",", "wc"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "5"}], "||", 
              RowBox[{"wj", "==", "6"}]}], ",", 
             RowBox[{"RDPhiA", "[", "wc", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "7"}], "||", 
              RowBox[{"wj", "\[Equal]", "8"}]}], ",", 
             RowBox[{"RDPhiAinv", "[", 
              RowBox[{"ws", ",", "wc"}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"9", ",", "11", ",", "13", ",", "15"}], "}"}], ",", 
               "wj"}], "]"}], ",", "RCDAl", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"10", ",", "12", ",", "14", ",", "16"}], "}"}], ",", 
               "wj"}], "]"}], ",", "RCDAh", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"10", ",", "12", ",", "14", ",", "16"}], "}"}], ",", 
               "wj"}], "]"}], ",", "RCDAh", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"17", ",", "18"}], "}"}], ",", "wj"}], "]"}], ",", 
             "RCAlR", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"19", ",", "20"}], "}"}], ",", "wj"}], "]"}], ",", 
             "RCAhR", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"21", ",", "22"}], "}"}], ",", "wj"}], "]"}], ",", 
             "RCAlL", ",", "\[IndentingNewLine]", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"23", ",", "24"}], "}"}], ",", "wj"}], "]"}], ",", 
             "RCAhL", ",", "\[IndentingNewLine]", 
             RowBox[{"wj", "\[Equal]", "25"}], ",", "Rkappa", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"wj", "\[Equal]", "26"}], ",", 
             RowBox[{"Rgamma", "[", "ws", "]"}]}], "\[IndentingNewLine]", 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{"AlwaysLP", ",", 
            RowBox[{"Uf", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"SelectFinalState", "[", 
             RowBox[{"Ef", ",", "Uf", ",", "coeff"}], "]"}]}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "th", ",", "tl", ",", "tlh", ",", "thl", ",", "JhR", ",", "JlR", ",", 
         "JhL", ",", "JlL"}], "}"}], "=", "tpar"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fr1", ",", "fr2", ",", "fr3", ",", "fr4"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1", ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "Er"}], "+", "w0"}], ">", "0"}], ",", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"-", "Er"}], "+", "w0"}], ")"}]}], "*", "beta"}], 
            "]"}], ",", "1"}], "]"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fl1", ",", "fl2", ",", "fl3", ",", "fl4"}], "}"}], "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "Er"}], "*", "beta"}], "]"}], ",", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", "Er"}], "*", "beta"}], "]"}], ",", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Er", "-", "w0"}], ">", "0"}], ",", 
           RowBox[{"Exp", "[", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"(", 
               RowBox[{"Er", "-", "w0"}], ")"}]}], "*", "beta"}], "]"}], ",", 
           "1"}], "]"}], ",", 
         RowBox[{"Exp", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"(", 
             RowBox[{"Er", "+", "w0"}], ")"}]}], "*", "beta"}], "]"}]}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pf", "=", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"th", "*", "fr1"}], ",", 
           RowBox[{"tl", "*", "fr2"}], ",", 
           RowBox[{"tlh", "*", "fr3"}], ",", 
           RowBox[{"thl", "*", "fr4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"th", "*", "fl1"}], ",", 
           RowBox[{"tl", "*", "fl2"}], ",", 
           RowBox[{"tlh", "*", "fl3"}], ",", 
           RowBox[{"thl", "*", "fl4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"tl", "*", "fl2"}], ",", 
           RowBox[{"th", "*", "fl1"}], ",", 
           RowBox[{"tlh", "*", "fl3"}], ",", 
           RowBox[{"thl", "*", "fl4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"tl", "*", "fr2"}], ",", 
           RowBox[{"th", "*", "fr1"}], ",", 
           RowBox[{"tlh", "*", "fr3"}], ",", 
           RowBox[{"thl", "*", "fr4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"th", "*", "fr1"}], ",", 
           RowBox[{"tl", "*", "fr2"}], ",", 
           RowBox[{"tlh", "*", "fr3"}], ",", 
           RowBox[{"thl", "*", "fr4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"th", "*", "fl1"}], ",", 
           RowBox[{"tl", "*", "fl2"}], ",", 
           RowBox[{"tlh", "*", "fl3"}], ",", 
           RowBox[{"thl", "*", "fl4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"th", "*", "fl1"}], ",", 
           RowBox[{"tl", "*", "fl2"}], ",", 
           RowBox[{"tlh", "*", "fl3"}], ",", 
           RowBox[{"thl", "*", "fl4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"tl", "*", "fr1"}], ",", 
           RowBox[{"th", "*", "fr2"}], ",", 
           RowBox[{"tlh", "*", "fr3"}], ",", 
           RowBox[{"thl", "*", "fr4"}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JlR", "*", "fr2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JhR", "*", "fr1"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JlL", "*", "fl2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JhL", "*", "fl1"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JhR", "*", "fl1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JlR", "*", "fl2"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JhL", "*", "fr1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JlL", "*", "fr2"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JlR", "*", "fl2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JhR", "*", "fr1"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JhR", "*", "fl1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JlR", "*", "fr2"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JlL", "*", "fr2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JhL", "*", "fl1"}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"JhL", "*", "fr1"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"JlL", "*", "fl2"}], "}"}]}], "\[IndentingNewLine]", 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "-"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}\
]}]}]}]}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Block", " ", "injecton"}], "..."}], " ", "ideally", " ", 
         "should", " ", "also", " ", "minimise", " ", "computation", " ", 
         "of", " ", "corresponding", " ", "transition", " ", "amplitudes"}], 
        "..."}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"EBL", ",", "HBL"}], "}"}], "=", "BlockInjection"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"jump", " ", "#", " ", "16"}], ",", 
        RowBox[{
         RowBox[{"21", " ", "prob"}], "\[Rule]", "0"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"EBL", "\[Equal]", "True"}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"pf", "[", 
           RowBox[{"[", 
            RowBox[{"16", ",", "1"}], "]"}], "]"}], "=", "0"}], ";", 
         RowBox[{
          RowBox[{"pf", "[", 
           RowBox[{"[", 
            RowBox[{"21", ",", "1"}], "]"}], "]"}], "=", "0"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"jump", " ", "#", " ", "10"}], ",", 
        RowBox[{
         RowBox[{"18", " ", "prob"}], "\[Rule]", "0"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"HBL", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"pf", "[", 
           RowBox[{"[", 
            RowBox[{"10", ",", "1"}], "]"}], "]"}], "=", "0"}], ";", 
         RowBox[{
          RowBox[{"pf", "[", 
           RowBox[{"[", 
            RowBox[{"18", ",", "1"}], "]"}], "]"}], "=", "0"}], ";"}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<pf = \>\"", ",", 
          RowBox[{
           RowBox[{"pf", "//", "Chop"}], "//", "MatrixForm"}]}], "]"}], ";"}],
        "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"--", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "-"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}\
]}]}]}]}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"beta", ",", " ", 
        RowBox[{"Erbeta", ":", " ", 
         RowBox[{
         "global", " ", "variable", " ", "to", " ", "avaoid", " ", "in", " ", 
          "arg", " ", "of", " ", "Rates"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Ds", ",", "Phis", ",", "m", ",", "tmax"}], "}"}], "=", 
       "vars"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"currents9to24", "=", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}], ",", 
         RowBox[{"-", "1"}], ",", "1", ",", "1", ",", 
         RowBox[{"-", "1"}], ",", "1", ",", 
         RowBox[{"-", "1"}], ",", "1", ",", "1", ",", 
         RowBox[{"-", "1"}], ",", "1", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Current", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"0", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "8"}], "}"}]}], "]"}], ",", 
         "currents9to24", ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"file", ":=", 
       RowBox[{
        RowBox[{"NotebookDirectory", "[", "]"}], "<>", 
        "\"\</INFO.txt\>\""}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"pfeR", ",", "pfeL"}], "}"}], "=", 
         RowBox[{"penaltyfunction", "[", 
          RowBox[{"Erbeta", ",", "omega0"}], "]"}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      StyleBox[
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"Define", " ", "m1"}], "=", 
          RowBox[{"Min", "[", 
           RowBox[{"m", ",", "N"}], "]"}]}], ",", " ", 
         RowBox[{
          RowBox[{
          "and", " ", "use", " ", "this", " ", "m1", " ", "in", " ", 
           "various", " ", "functions", " ", "that", " ", "have", " ", "k"}], 
          "=", 
          RowBox[{
           RowBox[{"0", "/", "1"}], " ", "to", " ", 
           RowBox[{"m", "."}]}]}]}], " ", "*)"}],
       FontSize->36], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t", "=", "0"}], ";", 
      RowBox[{"times", "=", 
       RowBox[{"{", "0", "}"}]}], ";", 
      RowBox[{"out2", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Dsvst", "=", 
       RowBox[{"{", "Ds", "}"}]}], ";", 
      RowBox[{"Phisvst", "=", 
       RowBox[{"{", "Phis", "}"}]}], ";", 
      RowBox[{"mvst", "=", 
       RowBox[{"{", "m", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ITER", "=", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{"ITER", "<", "maxiter"}], 
        RowBox[{"(*", 
         RowBox[{"t", "<", "tmax"}], "*)"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<*************** ITERATION # \>\"", ",", "ITER"}], 
           "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<*************** ITERATION # \>\"", ",", "ITER"}], 
           "}"}], ">>>", "file"}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "starting", " ", "list", " ", "of", " ", "active", " ", "sites"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ASites", "=", 
          RowBox[{"Complement", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{"i", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "Ntot"}], "}"}]}], "]"}], ",", 
            "Ds", ",", "Phis"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ITER", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"NN", "=", 
             RowBox[{"Length", "[", "ASites", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\"\<Initial variables: \>\"", ">>", "file"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<N,m: \>\"", ",", 
               RowBox[{"{", 
                RowBox[{"NN", ",", "m"}], "}"}]}], "}"}], ">>>", "file"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<Ds: \>\"", ",", "Ds"}], "}"}], ">>>", "file"}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"\"\<\[Phi]s: \>\"", ",", "Phis"}], "}"}], ">>>", 
             "file"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", " ", 
           RowBox[{"m", ",", 
            RowBox[{"NN", " ", "state"}]}], " ", "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ENm", ",", "UNm"}], "}"}], "=", 
            RowBox[{"DiagH", "[", 
             RowBox[{"NN", ",", "m", ",", "gg"}], "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Es", "[", "1", "]"}], ",", 
            RowBox[{"U", "[", "1", "]"}]}], "}"}], "=", 
          RowBox[{"DiagH", "[", 
           RowBox[{"NN", ",", "m", ",", "gg"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"secNm", "=", 
            RowBox[{"sectors", "[", "ENm", "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<ENm: \>\"", ",", "ENm"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "start", " ", "with", " ", "the", " ", "lowest", " ", 
           "eigenstate"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ITER", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"psi", "=", 
             RowBox[{
              RowBox[{"U", "[", "1", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"psi", "=", 
               RowBox[{"SelectFinalState", "[", 
                RowBox[{
                 RowBox[{"Es", "[", "1", "]"}], ",", 
                 RowBox[{"U", "[", "1", "]"}], ",", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"RandomReal", "[", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Es", "[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
                "]"}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
            RowBox[{"Einit", "=", 
             RowBox[{
              RowBox[{"Es", "[", "1", "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", 
            RowBox[{"Evst", "=", 
             RowBox[{"{", "Einit", "}"}]}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<ASites: \>\"", ",", "ASites", ",", "\"\< NN: \>\"", ",", 
             "NN"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"ITER", "+=", "1"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", "getrates", "*)"}],
          FontSize->24], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"get", " ", 
           RowBox[{"Ht", ".", "Ufinal"}], " ", "matrices", " ", "for", " ", 
           "rates"}], " ", "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "site", " ", "indices", " ", "for", " ", "various", " ", 
            "processes", " ", "can", " ", "occur"}], ";", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"no", ".", " ", "of"}], " ", "ways"}], " ", "=", " ", 
            RowBox[{"lengths", " ", "of", " ", "out", " ", "arrays"}]}]}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
            "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", ",",
             "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", "Apairs", 
            ",", "CAR", ",", "CAL"}], "}"}], "=", 
          RowBox[{"OneDLatticeWays", "[", 
           RowBox[{"Ntot", ",", "Ds", ",", "Phis"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<ways: \>\"", ",", 
             RowBox[{"{", 
              RowBox[{
              "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
               "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", 
               ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", 
               "Apairs", ",", "CAR", ",", "CAL"}], "}"}]}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<ways: \>\"", ",", 
            RowBox[{"{", 
             RowBox[{
             "DhopsR", ",", "DhopsL", ",", "PhihopsR", ",", "PhihopsL", ",", 
              "DPhiR", ",", "DPhiL", ",", "\[IndentingNewLine]", "CDhopsR", 
              ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL", ",", 
              "Apairs", ",", "CAR", ",", "CAL"}], "}"}]}], "}"}], ">>>", 
          "file"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", 
           RowBox[{"Bulk", " ", "Processes"}], "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"D", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"D", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "DhopsR", "]"}], ">", "0"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", "DhopsL", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"RDAM", "=", 
               RowBox[{
                RowBox[{"mkHtDA", "[", 
                 RowBox[{"NN", ",", "m", ",", "th", ",", "tl"}], "]"}], ".", 
                RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Nstates", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
               RowBox[{
                RowBox[{"Dimensions", "[", "RDAM", "]"}], "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "-"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}\
]}]}]}]}]}]}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Penalty", " ", "function", " ", "including", " ", "the", " ", 
            "vibrational", " ", "assistance", " ", "for", " ", "Homo"}], "-", 
           
           RowBox[{"Lumo", " ", "hop"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "calculate", " ", "vib", " ", "distribution", " ", "in", " ", "a", 
           " ", "down", " ", "site"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"M", "=", "5"}], ";", 
           RowBox[{"wv", "=", "0.2"}], ";", 
           RowBox[{"lam", "=", "1"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"Ignore", " ", "NN"}], "=", 
           RowBox[{
            RowBox[{
             RowBox[{
             "1", " ", "case", " ", "for", " ", "vib", " ", "assistance", " ",
               "for", " ", "simplicity"}], " ", "-", "  ", 
             RowBox[{
             "avoid", " ", "writing", " ", "new", " ", "funct", " ", 
              "GetProbnvN1", " ", "for", " ", "NN"}]}], "=", "1"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"NN", "\[GreaterEqual]", "2"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pr", "=", 
             RowBox[{"GetProbnv", "[", 
              RowBox[{
              "NN", ",", "m", ",", "M", ",", "gg", ",", "wv", ",", "lam"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
             "use", " ", "the", " ", "above", " ", "vib", " ", "distin", " ", 
              "penalty", " ", "function"}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"fr4v", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pr", "[", 
                 RowBox[{"[", 
                  RowBox[{"nv", "+", "1"}], "]"}], "]"}], "*", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "Er"}], "+", "w0", "-", 
                    RowBox[{"nv", "*", "wv"}]}], ">", "0"}], ",", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "Er"}], "+", "w0", "-", 
                    RowBox[{"nv", "*", "wv"}]}], ")"}]}], "*", "beta"}], 
                   "]"}], ",", "1"}], "]"}]}], "   ", ",", 
               RowBox[{"{", 
                RowBox[{"nv", ",", "0", ",", 
                 RowBox[{"M", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"fl4v", "=", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"pr", "[", 
                 RowBox[{"[", 
                  RowBox[{"nv", "+", "1"}], "]"}], "]"}], "*", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Er", "+", "w0", "-", 
                    RowBox[{"nv", "*", "wv"}]}], ">", "0"}], ",", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"(", 
                    RowBox[{"Er", "+", "w0", "-", 
                    RowBox[{"nv", "*", "wv"}]}], ")"}]}], "*", "beta"}], 
                   "]"}], ",", "1"}], "]"}]}], "   ", ",", 
               RowBox[{"{", 
                RowBox[{"nv", ",", "0", ",", 
                 RowBox[{"M", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"jump", " ", "#", " ", "3"}], ",", 
              RowBox[{"4", " ", 
               RowBox[{"(", 
                RowBox[{"hole", " ", "hops"}], ")"}]}], ",", " ", 
              RowBox[{"and", " ", "7"}], ",", 
              RowBox[{"8", " ", 
               RowBox[{"(", 
                RowBox[{"D", ",", 
                 RowBox[{"Phi", " ", "creation"}]}], ")"}], 
               "\[IndentingNewLine]", " ", "that", " ", "involve", " ", "e", 
               " ", "jumping", " ", "from", " ", "an", " ", "active", " ", 
               "sites"}]}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fl4v"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"4", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fr4v"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"7", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fl4v"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"8", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fr4v"}]}], ";"}], "\[IndentingNewLine]", 
           ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"3", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fl4"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"4", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fr4"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"7", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fl4"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"pf", "[", 
              RowBox[{"[", 
               RowBox[{"8", ",", "4"}], "]"}], "]"}], "=", 
             RowBox[{"thl", "*", "fr4"}]}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ITER", "\[Equal]", "20"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<pf for ZT: \>\"", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"thl", "*", "fr4"}], ",", 
                RowBox[{"thl", "*", "fl4"}]}], "}"}], ",", 
              RowBox[{"pf", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"3", ";;", "4"}], ",", "4"}], "]"}], "]"}]}], "]"}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates starting-------------\>\"", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "get", " ", "rates", " ", "for", " ", "current", " ", "state", " ", 
           "psi"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"r", "[", "j", "]"}], "=", "0"}], ";", 
              RowBox[{
               RowBox[{"rlist", "[", "j", "]"}], "=", 
               RowBox[{"{", "}"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "26"}], "}"}]}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Clear", " ", "and", " ", "initiate", " ", "as", " ", "definitions",
            " ", "works"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"Clear", "[", 
          RowBox[{"r", ",", "rz", ",", "rlist"}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"r", "[", "j_", "]"}], "=", "0"}], ";", 
         RowBox[{
          RowBox[{"rlist", "[", "j_", "]"}], "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"rz", "[", "j_", "]"}], "[", 
           RowBox[{"i_", ",", "ii_"}], "]"}], "=", "0"}], ";", 
         RowBox[{
          RowBox[{
           RowBox[{"rz", "[", "j_", "]"}], "[", "jj_", "]"}], "=", "0"}], ";",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"ldr", "=", 
          RowBox[{"Length", "[", "DhopsR", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ldl", "=", 
          RowBox[{"Length", "[", "DhopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lpr", "=", 
          RowBox[{"Length", "[", "PhihopsR", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lpl", "=", 
          RowBox[{"Length", "[", "PhihopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"logNmm1", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"ldr", "+", "ldl", "+", "lpr", "+", "lpl"}], ")"}], ">", 
            "0"}], "&&", "includecross"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"logkg", 
          StyleBox["=",
           FontSize->14], 
          RowBox[{
           RowBox[{"kappa", "+", "gamma"}], ">", "0"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"logNmm1", "||", "logkg"}], ",", 
           RowBox[{"(*", 
            RowBox[{"{", 
             RowBox[{"ENmm1", ",", "UNmm1"}], "}"}], "*)"}], 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Es", "[", "2", "]"}], ",", 
              RowBox[{"U", "[", "2", "]"}]}], "}"}], "=", 
            RowBox[{"DiagH", "[", 
             RowBox[{"NN", ",", 
              RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{"logNmm1", ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"{", 
             RowBox[{"ENmp1", ",", "UNmp1"}], "}"}], "*)"}], 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Es", "[", "3", "]"}], ",", 
              RowBox[{"U", "[", "3", "]"}]}], "}"}], "=", 
            RowBox[{"DiagH", "[", 
             RowBox[{"NN", ",", 
              RowBox[{"m", "+", "1"}], ",", "gg"}], "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
            "Lumo", " ", "to", " ", "homo", " ", "hop", " ", "requires", " ", 
             "minimum", " ", "of", " ", "m"}], "=", 
            RowBox[{
             RowBox[{"1", " ", "for", " ", "jump", " ", "1"}], "-", 
             RowBox[{
             "4.", " ", "\[IndentingNewLine]", "Instead", " ", "of", " ", 
              "applying", " ", "this", " ", "condition", " ", "on", " ", 
              "calculation", " ", "of", " ", "U", " ", "and", " ", "Ht"}]}]}],
            ",", "\[IndentingNewLine]", 
           RowBox[{
           "the", " ", "dimensions", " ", "of", " ", "corresponding", " ", 
            "empty", " ", "Ht", " ", "are", " ", "set", " ", "to", " ", 
            "make", " ", "it", " ", "compatible", " ", "for", " ", "dot", " ",
             "product", " ", "with", " ", "U"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=1\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"D", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"D", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"j", "=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"\"\<calc HtDAR[i], i= \>\"", ",", "i"}], "]"}], ";"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"DhopsR", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "+", "1"}]}], "]"}], 
              " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"HtDAc", "=", 
             RowBox[{"mkHtDAc", "[", 
              RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              StyleBox["=",
               FontSize->14], 
              RowBox[{"{", 
               RowBox[{"Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], 
               "}"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"RDAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", 
                 RowBox[{"HtDAc", "[", 
                  RowBox[{"[", "ii", "]"}], "]"}], ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtDAclh", ",", "HtDAchl"}], "}"}], "=", 
                RowBox[{"mkHtDAcc", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "3"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "Print", "[", "\"\<psi.HtDAclh.U[EUinds[[j,ii]]====> \>\"", 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"Dimensions", "[", "psi", "]"}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{
                   RowBox[{"Dimensions", "[", "HtDAclh", "]"}], ",", 
                   RowBox[{"Dimensions", "[", "HtDAchl", "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], "]"}], "]"}], ",", 
                   
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}], "]"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAclh", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "4"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAchl", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{
                RowBox[{"rlist", "[", "j", "]"}], ",", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=2\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 2-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"j", "=", "2"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"DhopsL", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "-", "1"}]}], "]"}], 
              " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"HtDAc", "=", 
             RowBox[{"mkHtDAc", "[", 
              RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              StyleBox["=",
               FontSize->14], 
              RowBox[{"{", 
               RowBox[{"Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], 
               "}"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"RDAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", 
                 RowBox[{"HtDAc", "[", 
                  RowBox[{"[", "ii", "]"}], "]"}], ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtDAclh", ",", "HtDAchl"}], "}"}], "=", 
                RowBox[{"mkHtDAcc", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "3"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAclh", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "4"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAchl", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RDAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{
                RowBox[{"rlist", "[", "j", "]"}], ",", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "ldl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 3 right -------------\>\"", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Phi", "+", "A"}], "\[Rule]", " ", 
           RowBox[{"Phi", "+", "A"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "PhihopsR", "]"}], ">", "0"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", "PhihopsL", "]"}], ">", "0"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"RPhiAM", "=", 
               RowBox[{
                RowBox[{"mkHtPhiA", "[", 
                 RowBox[{"NN", ",", "m", ",", "th", ",", "tl"}], "]"}], ".", 
                RowBox[{"Transpose", "[", "UNm", "]"}]}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=3\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"lpr", "=", 
            RowBox[{"Length", "[", "PhihopsR", "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<PhihopsR: \>\"", ",", "PhihopsR"}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"j", "=", "3"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"PhihopsR", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "+", "1"}]}], "]"}], 
              " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"HtDAc", "=", 
             RowBox[{"mkHtDAc", "[", 
              RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              StyleBox["=",
               FontSize->14], 
              RowBox[{"{", 
               RowBox[{"Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], 
               "}"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"RPhiAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", 
                 RowBox[{"HtDAc", "[", 
                  RowBox[{"[", "ii", "]"}], "]"}], ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtDAclh", ",", "HtDAchl"}], "}"}], "=", 
                RowBox[{"mkHtDAcc", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "3"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<j3,ii=4;Dims: psi,HtDAchl,U[EUinds[[j,ii]]]: \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "psi", "]"}], ",", "\"\< \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "HtDAclh", "]"}], ",", 
                   "\"\< \>\"", ",", 
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}], "]"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<EUinds[[j,ii]]= \>\"", ",", 
                   RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}]}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RPhiAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAclh", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "4"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<j3,ii=4;Dims: psi,HtDAchl,U[EUinds[[j,ii]]]: \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "psi", "]"}], ",", "\"\< \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "HtDAchl", "]"}], ",", 
                   "\"\< \>\"", ",", 
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}], "]"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<EUinds[[j,ii]]= \>\"", ",", 
                   RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}]}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RPhiAR", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAchl", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{
                RowBox[{"rlist", "[", "j", "]"}], ",", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpr"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=4\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 3 left-------------\>\"", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"lpl", "=", 
            RowBox[{"Length", "[", "PhihopsL", "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<PhihopsR: \>\"", ",", "PhihopsR"}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"j", "=", "4"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"n", "=", 
             RowBox[{
              RowBox[{"Position", "[", 
               RowBox[{"ASites", ",", 
                RowBox[{
                 RowBox[{"PhihopsL", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], " ", "-", "1"}]}], "]"}], 
              " ", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", " ", 
            RowBox[{"(*", " ", 
             RowBox[{
             "active", " ", "site", " ", "on", " ", "right", " ", "of", " ", 
              "D"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"HtDAc", "=", 
             RowBox[{"mkHtDAc", "[", 
              RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
              StyleBox["=",
               FontSize->14], 
              RowBox[{"{", 
               RowBox[{"Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], 
               "}"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"RPhiAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", 
                 RowBox[{"HtDAc", "[", 
                  RowBox[{"[", "ii", "]"}], "]"}], ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "2"}], "}"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "Print", "[", "\"\<----------- rates 3y-------------\>\"", 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtDAclh", ",", "HtDAchl"}], "}"}], "=", 
                RowBox[{"mkHtDAcc", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "3"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<N,m = \>\"", ",", "NN", ",", "\"\< \>\"", ",", "m"}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<ii=4;Dims: psi,HtDAchl,U[EUinds[[j,ii]]]: \>\"", ",", 
                   RowBox[{"Dimensions", "[", "psi", "]"}], ",", "\"\< \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "HtDAclh", "]"}], ",", 
                   "\"\< \>\"", ",", 
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}], "]"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<EUinds[[j,ii]]= \>\"", ",", 
                   RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}]}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RPhiAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAclh", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"ii", "=", "4"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<ii=4;Dims: psi,HtDAchl,U[EUinds[[j,ii]]]: \>\"", ",", 
                   RowBox[{"Dimensions", "[", "psi", "]"}], ",", "\"\< \>\"", 
                   ",", 
                   RowBox[{"Dimensions", "[", "HtDAchl", "]"}], ",", 
                   "\"\< \>\"", ",", 
                   RowBox[{"Dimensions", "[", 
                    RowBox[{"U", "[", 
                    RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}], "]"}]}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<EUinds[[j,ii]]= \>\"", ",", 
                   RowBox[{"EUinds", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}]}], "]"}], ";"}], 
                "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RPhiAL", "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{"psi", ".", "HtDAchl", ".", 
                 RowBox[{"U", "[", 
                  RowBox[{"EUinds", "[", 
                   RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"RPhiAL", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Ratesc", "[", 
                  RowBox[{
                   RowBox[{"RDAR", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Do", "[", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{
                RowBox[{"rlist", "[", "j", "]"}], ",", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", 
                 RowBox[{"i", ",", "ii"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "lpl"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 3 z-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], " ", "+", " ", "A"}], " ", 
           "\[Rule]", " ", 
           RowBox[{"A", "'"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"{", 
           RowBox[{"Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], 
           "}"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ldpr", "=", 
          RowBox[{"Length", "[", "DPhiR", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ldpl", "=", 
          RowBox[{"Length", "[", "DPhiL", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ldpa", "=", 
          RowBox[{"ldpr", "+", "ldpl"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=5\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Clear", "[", "RDPhiA", "]"}], ";", 
         RowBox[{
          RowBox[{"RDPhiA", "[", "x_", "]"}], ":=", "0"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ldpa", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"{", 
             RowBox[{"ENp2mp1", ",", "UNp2mp1"}], "}"}], "*)"}], 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Es", "[", "4", "]"}], ",", 
               RowBox[{"U", "[", "4", "]"}]}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "2"}], ",", 
               RowBox[{"m", "+", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Htsph", ",", "Htspl"}], "}"}], "=", 
             RowBox[{"makeHtDPhiAc", "[", 
              RowBox[{"NN", ",", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RDPhiA", "[", "1", "]"}], "=", 
             RowBox[{"psi", ".", "Htsph", ".", 
              RowBox[{"U", "[", "4", "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"RDPhiA", "[", "2", "]"}], "=", 
             RowBox[{"psi", ".", "Htspl", ".", 
              RowBox[{"U", "[", "4", "]"}]}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Htsplh", ",", "Htsphl"}], "}"}], "=", 
                RowBox[{"makeHtDPhiAcc", "[", 
                 RowBox[{"NN", ",", "m"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"{", 
                 RowBox[{"ENp2m", ",", "UNp2m"}], "}"}], "*)"}], 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Es", "[", "5", "]"}], ",", 
                  RowBox[{"U", "[", "5", "]"}]}], "}"}], "=", 
                RowBox[{"DiagH", "[", 
                 RowBox[{
                  RowBox[{"NN", "+", "2"}], ",", "m", ",", "gg"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDPhiA", "[", "3", "]"}], "=", 
                RowBox[{"psi", ".", "Htsplh", ".", 
                 RowBox[{"U", "[", "5", "]"}]}]}], ";", "\[IndentingNewLine]",
                " ", 
               RowBox[{"(*", 
                RowBox[{"{", 
                 RowBox[{"ENp2mp2", ",", "UNp2mp2"}], "}"}], "*)"}], 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Es", "[", "6", "]"}], ",", 
                  RowBox[{"U", "[", "6", "]"}]}], "}"}], "=", 
                RowBox[{"DiagH", "[", 
                 RowBox[{
                  RowBox[{"NN", "+", "2"}], ",", 
                  RowBox[{"m", "+", "2"}], ",", "gg"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"RDPhiA", "[", "4", "]"}], "=", 
                RowBox[{"psi", ".", "Htsphl", ".", 
                 RowBox[{"U", "[", "6", "]"}]}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"rr", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Norm", "[", 
                 RowBox[{"RDPhiA", "[", "i", "]"}], "]"}], "^", "2"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"break", " ", "into", " ", "D"}], ",", 
              RowBox[{"Phi", " ", "and", " ", "Phi"}], ",", 
              RowBox[{
               RowBox[{"D", " ", "pairs"}], ";", " ", 
               RowBox[{
                RowBox[{"diff", " ", "sgn"}], " ", "=", 
                RowBox[{">", " ", 
                 RowBox[{"diff", " ", "rates"}]}]}]}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"j", "=", "5"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"ldpr", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "jj", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "jj"}], "]"}], "]"}], "*", 
                    RowBox[{"rr", "[", 
                    RowBox[{"[", "jj", "]"}], "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "jj", "]"}], "*", 
                    "ldpr"}]}], ";"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{
                   RowBox[{"rlist", "[", "j", "]"}], ",", 
                   RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "ii", "]"}]}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"j", "=", "6"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"ldpl", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "jj", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "jj"}], "]"}], "]"}], "*", 
                    RowBox[{"rr", "[", 
                    RowBox[{"[", "jj", "]"}], "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "jj", "]"}], "*", 
                    "ldpl"}]}], ";"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"jj", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{
                   RowBox[{"rlist", "[", "j", "]"}], ",", 
                   RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", "ii", "]"}]}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}]}],
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<------j=6\>\"", "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 4-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"inv", " ", 
            RowBox[{"processes", ":", " ", "A"}]}], "\[Rule]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"D", ",", "Phi"}], ")"}], "+", "A"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"lApairs", "=", 
          RowBox[{"Length", "[", "Apairs", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"If", " ", "m"}], "\[Equal]", "0"}], ",", " ", 
           RowBox[{"no", " ", "D"}], ",", 
           RowBox[{"Phi", " ", "pair", " ", "generation", " ", "possible"}], 
           ",", " ", 
           RowBox[{
            RowBox[{"so", " ", "set", " ", "lApairs"}], "=", "0"}]}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lApairs", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             StyleBox[
              RowBox[{"conditions", " ", "on", " ", 
               RowBox[{"pf", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"7", ";;", "8"}], ",", "All"}], "]"}], "]"}], " ", 
               "can", " ", "avoid", " ", "unnecessary", " ", "calculations", 
               " ", "of", " ", 
               RowBox[{"Hts", "/", "Us"}], " ", "and", " ", "amplitudes"}],
              FontSize->14], 
             StyleBox[";",
              FontSize->14], 
             StyleBox["\[IndentingNewLine]",
              FontSize->14], 
             RowBox[{
              StyleBox["If",
               FontSize->14], 
              StyleBox["[",
               FontSize->14], 
              RowBox[{
               StyleBox[
                RowBox[{"lApairs", ">", 
                 RowBox[{"0", " ", "and", " ", "all", " ", "rates"}], ">", 
                 "0"}],
                FontSize->14], 
               StyleBox[",",
                FontSize->14], 
               StyleBox["\[IndentingNewLine]",
                FontSize->14], 
               RowBox[{
                StyleBox["m",
                 FontSize->14], 
                StyleBox["\[GreaterEqual]",
                 FontSize->14], 
                StyleBox[" ",
                 FontSize->36], 
                RowBox[{"1", " ", "and", " ", "th"}]}], ",", 
               RowBox[{"tl", " ", ">", "0"}], ",", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"and", " ", "similarly", " ", "m"}], 
                 "\[GreaterEqual]", " ", 
                 RowBox[{"2", " ", "and", " ", "tlh"}], ">", 
                 RowBox[{"0", " ", "etc"}]}], "..."}]}]}]}], "*)"}], "  ", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"m", "\[GreaterEqual]", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"{", 
                RowBox[{"ENm2mm1", ",", "UNm2mm1"}], "}"}], "*)"}], 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Es", "[", "7", "]"}], ",", 
                  RowBox[{"U", "[", "7", "]"}]}], "}"}], "=", 
                RowBox[{"DiagH", "[", 
                 RowBox[{
                  RowBox[{"NN", "-", "2"}], ",", 
                  RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"includecross", ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"m", "\[GreaterEqual]", "2"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"{", 
                   RowBox[{"ENm2mm2", ",", "UNm2mm2"}], "}"}], "*)"}], 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Es", "[", "8", "]"}], ",", 
                    RowBox[{"U", "[", "8", "]"}]}], "}"}], "=", 
                   RowBox[{"DiagH", "[", 
                    RowBox[{
                    RowBox[{"NN", "-", "2"}], ",", 
                    RowBox[{"m", "-", "2"}], ",", "gg"}], "]"}]}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"m", "\[GreaterEqual]", "0"}], ","}]}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"{", 
                 RowBox[{"ENm2m", ",", "UNm2m"}], "}"}], "*)"}], 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Es", "[", "9", "]"}], ",", 
                  RowBox[{"U", "[", "9", "]"}]}], "}"}], "=", 
                RowBox[{"DiagH", "[", 
                 RowBox[{
                  RowBox[{"NN", "-", "2"}], ",", "m", ",", "gg"}], "]"}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"saposOrder", "=", 
             RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<calc HtApairs[i], i= \>\"", ",", "i"}], "]"}], 
               ";"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"si1", "=", 
                RowBox[{"Apairs", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"site", " ", "indexes", " ", "in", " ", "lattice"}], 
                " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"p1", ",", "p2"}], "}"}], "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ASites", ",", "si1"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"ASites", ",", 
                    RowBox[{"si1", "+", "1"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"sapos", " ", "in", " ", "order"}], ",", " ", 
                 RowBox[{
                 "assume", " ", "abeling", " ", "from", " ", "left", " ", 
                  "to", " ", "right"}]}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"sapos", "=", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Min", "[", 
                   RowBox[{"p1", ",", "p2"}], "]"}], ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"p1", ",", "p2"}], "]"}]}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"sapos", "\[Equal]", 
                    RowBox[{"{", 
                    RowBox[{"p1", ",", "p2"}], "}"}]}], ",", 
                   RowBox[{"AppendTo", "[", 
                    RowBox[{"saposOrder", ",", "True"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"saposOrder", ",", "False"}], "]"}], ";"}]}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"saposOrder", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"t1", "=", "th"}], ";", 
                    RowBox[{"t2", "=", "tl"}]}], ",", 
                   RowBox[{
                    RowBox[{"t1", "=", "tl"}], ";", 
                    RowBox[{"t2", "=", "th"}]}]}], "]"}], ";"}], "*)"}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                StyleBox[
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"sapos", "\[Equal]", 
                    RowBox[{"{", 
                    RowBox[{"p1", ",", "p2"}], "}"}]}], ",", 
                    RowBox[{
                    RowBox[{"t1", "=", "th"}], ";", 
                    RowBox[{"t2", "=", "tl"}]}], ",", 
                    RowBox[{
                    RowBox[{"t1", "=", "tl"}], ";", 
                    RowBox[{"t2", "=", "th"}]}]}], "]"}], ";"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"ts78", "[", "7", "]"}], "=", 
                    RowBox[{"{", 
                    RowBox[{"t1", ",", "t2", ",", "tlh", ",", "thl"}], 
                    "}"}]}], ";", 
                   RowBox[{
                    RowBox[{"ts78", "[", "8", "]"}], "=", 
                    RowBox[{"{", 
                    RowBox[{"t2", ",", "t1", ",", "tlh", ",", "thl"}], 
                    "}"}]}], ";"}]}], "Code"], 
                StyleBox["\[IndentingNewLine]", "Code"], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "initialise", " ", "total", " ", "rates", " ", "for", " ", 
                 "four", " ", "channels"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"rrAinv", "[", "ii", "]"}], "=", "0"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"m", "\[GreaterEqual]", "1"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"sapos", "\[Equal]", 
                    RowBox[{"{", 
                    RowBox[{"p1", ",", "p2"}], "}"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"HtApaira", "[", "i", "]"}], ",", 
                    RowBox[{"HtApairb", "[", "i", "]"}]}], "}"}], "=", 
                    RowBox[{"makeHtApairsc", "[", 
                    RowBox[{"NN", ",", "m", ",", "sapos"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"HtApairb", "[", "i", "]"}], ",", 
                    RowBox[{"HtApaira", "[", "i", "]"}]}], "}"}], "=", 
                    RowBox[{"makeHtApairsc", "[", 
                    RowBox[{"NN", ",", "m", ",", "sapos"}], "]"}]}]}], 
                   "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"saposOrder", ":", " ", 
                    RowBox[{"True", " ", "===", 
                    RowBox[{">", " ", "th"}]}]}], "&"}], "tl", " ", "with", 
                    " ", "Hta"}], ",", 
                    RowBox[{"Htb", " ", "give", " ", "D"}], ",", 
                    RowBox[{"Phi", ";", " ", 
                    RowBox[{"else", " ", "give", " ", "Phi"}]}], ",", "D"}], 
                   "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "1"}], "]"}], "=", 
                   RowBox[{"psi", ".", 
                    RowBox[{"HtApaira", "[", "i", "]"}], ".", 
                    RowBox[{"U", "[", "7", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "2"}], "]"}], "=", 
                   RowBox[{"psi", ".", 
                    RowBox[{"HtApairb", "[", "i", "]"}], ".", 
                    RowBox[{"U", "[", "7", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"rrAinv", "[", "ii", "]"}], "=", 
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "]"}], "^", "2"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ii", ",", "1", ",", "2"}], "}"}]}], "]"}], 
                  ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", " ", "\"\< ----j=7,8\>\"", "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
               
               RowBox[{"If", "[", 
                RowBox[{"includecross", ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"m", "\[GreaterEqual]", "2"}], ",", " ", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"HtApairlh", "=", 
                    RowBox[{"makeHtApairsclh", "[", 
                    RowBox[{"NN", ",", "m", ",", "sapos"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "3"}], "]"}], "=", 
                    RowBox[{"psi", ".", "HtApairlh", ".", 
                    RowBox[{"U", "[", "8", "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"rrAinv", "[", "3", "]"}], "=", 
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}], "^", "2"}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"HtApairhl", "=", 
                   RowBox[{"makeHtApairschl", "[", 
                    RowBox[{"NN", ",", "m", ",", "sapos"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "4"}], "]"}], "=", 
                   RowBox[{"psi", ".", "HtApairhl", ".", 
                    RowBox[{"U", "[", "9", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rrAinv", "[", "4", "]"}], "=", 
                   RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"RDPhiAinv", "[", 
                    RowBox[{"i", ",", "4"}], "]"}], "]"}], "^", "2"}]}], 
                  ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"th", ",", "tl", ",", 
                 RowBox[{"tlh", " ", "or", " ", "thl"}], ",", " ", 
                 RowBox[{
                  RowBox[{
                  "include", " ", "in", " ", "pf", " ", "for", " ", "j"}], 
                  "=", "7"}], ",", "8", ",", " ", 
                 RowBox[{"and", " ", "others", " ", "if", " ", "needed"}]}], 
                " ", "*)"}], "\[IndentingNewLine]", 
               StyleBox[
                RowBox[{"(*", " ", 
                 RowBox[{
                  RowBox[{"j", "=", "7"}], ",", "8"}], " ", "*)"}],
                FontSize->16], "\[IndentingNewLine]", 
               RowBox[{"Do", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Do", "[", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", 
                    RowBox[{"i", ",", "1"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                    RowBox[{
                    RowBox[{"ts78", "[", "j", "]"}], "[", 
                    RowBox[{"[", "ii", "]"}], "]"}], "*", 
                    RowBox[{"rrAinv", "[", "ii", "]"}]}]}], ";"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", 
                    RowBox[{"i", ",", "ii"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "ii"}], "]"}], "]"}], "*", 
                    RowBox[{"rrAinv", "[", "ii", "]"}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"r", "[", "j", "]"}], "+=", 
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", 
                    RowBox[{"i", ",", "ii"}], "]"}]}], ";"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Do", "[", 
                   RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{
                    RowBox[{"rlist", "[", "j", "]"}], ",", 
                    RowBox[{
                    RowBox[{"rz", "[", "j", "]"}], "[", 
                    RowBox[{"i", ",", "ii"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"ii", ",", "1", ",", "4"}], "}"}]}], "]"}], ";"}],
                  "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "7", ",", "8"}], "}"}]}], "]"}], ";"}], 
              "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "lApairs"}], "}"}]}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 5 -------------\>\"", "]"}], 
           ";"}], "*)"}], " ", "\[IndentingNewLine]", 
         StyleBox[
          RowBox[{"(*", 
           RowBox[{"Contact", " ", "Processes"}], "*)"}],
          FontSize->16], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          StyleBox[
           RowBox[{
            RowBox[{
             RowBox[{"Jh", ":", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
             RowBox[{"\[CapitalPi]", " ", "+", " ", 
              RowBox[{"A", "[", 
               RowBox[{
                RowBox[{"NN", "+", "1"}], ",", 
                RowBox[{"m", "+", "1"}]}], "]"}]}]}], ";", 
            RowBox[{
             RowBox[{"Jl", ":", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", " ", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
             RowBox[{"\[CapitalPi]", " ", "+", " ", 
              RowBox[{"A", "[", 
               RowBox[{
                RowBox[{"NN", "+", "1"}], ",", "m"}], "]"}]}]}], ";"}],
           FontSize->14], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"CDAproc", "=", 
            RowBox[{"Join", "[", 
             RowBox[{
             "CDhopsR", ",", "CDhopsL", ",", "CPhihopsR", ",", "CPhihopsL"}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"lcdaproc", "=", 
            RowBox[{"Length", "[", "CDAproc", "]"}]}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "rrcdal", ",", "rrcdah", ",", "rrcalr", ",", "rrcahr", ",", 
            "rrcall", ",", "rrcahl"}], "}"}], "=", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
           "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"lcdr", "=", 
          RowBox[{"Length", "[", "CDhopsR", "]"}]}], ";", 
         RowBox[{"lcdl", "=", 
          RowBox[{"Length", "[", "CDhopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lcpr", "=", 
          RowBox[{"Length", "[", "CPhihopsR", "]"}]}], ";", 
         RowBox[{"lcpl", "=", 
          RowBox[{"Length", "[", "CPhihopsL", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"lcdaproc", "=", 
          RowBox[{"lcdr", "+", "lcdl", "+", "lcpr", "+", "lcpl"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lcdaproc", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<calc RCDAhM, RCDAlM ... \>\"", "]"}], 
             ";"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{"HtCDAh", ",", "HtCDAl"}], "}"}], "=", 
             RowBox[{"makeHtCDA", "[", 
              RowBox[{"NN", ",", "m"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"{", 
              RowBox[{"ENp1mp1", ",", "UNp1mp1"}], "}"}], "*)"}], 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Es", "[", "10", "]"}], ",", 
               RowBox[{"U", "[", "10", "]"}]}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "1"}], ",", 
               RowBox[{"m", "+", "1"}], ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"secNp1mp1", "=", 
               RowBox[{"sectors", "[", "ENp1mp1", "]"}]}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"{", 
              RowBox[{"ENp1m", ",", "UNp1m"}], "}"}], "*)"}], 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Es", "[", "11", "]"}], ",", 
               RowBox[{"U", "[", "11", "]"}]}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "+", "1"}], ",", "m", ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"secNp1m", "=", 
               RowBox[{"sectors", "[", "ENp1m", "]"}]}], ";"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"RCDAh", "=", 
             RowBox[{"psi", ".", "HtCDAh", ".", 
              RowBox[{"U", "[", "10", "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"RCDAl", "=", 
             RowBox[{"psi", ".", "HtCDAl", ".", 
              RowBox[{"U", "[", "11", "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"rrcdal", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "RCDAl", "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"rrcdah", "=", 
             RowBox[{
              RowBox[{"Norm", "[", "RCDAh", "]"}], "^", "2"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcdr", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"channel", " ", "m"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"j", "=", "9"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdal"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"tl", "*", "RCDAl"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNp1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"channel", " ", "m"}], "+", "1"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"j", "=", "10"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdah"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"rz", "[", "j", "]"}], "=", 
                  RowBox[{"Rates", "[", 
                   RowBox[{
                    RowBox[{"th", "*", "RCDAh"}], ",", 
                    RowBox[{"+", "1"}], ",", "secNp1mp1", ",", "Einit"}], 
                   "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcdl", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"channel", " ", "m"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"j", "=", "11"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdal"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"rz", "[", "j", "]"}], "=", 
                  RowBox[{"Rates", "[", 
                   RowBox[{
                    RowBox[{"tl", "*", "RCDAl"}], ",", 
                    RowBox[{"-", "1"}], ",", "secNp1m", ",", "Einit"}], 
                   "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"channel", " ", "m"}], "+", "1"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"j", "=", "12"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdah"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                  RowBox[{"rz", "[", "j", "]"}], "=", 
                  RowBox[{"Rates", "[", 
                   RowBox[{
                    RowBox[{"th", "*", "RCDAh"}], ",", 
                    RowBox[{"-", "1"}], ",", "secNp1mp1", ",", "Einit"}], 
                   "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcpr", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"channel", " ", "m"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"j", "=", "13"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdal"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"th", "*", "RCDAl"}], ",", 
                   RowBox[{"-", "1"}], ",", "secNp1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"channel", " ", "m"}], "+", "1"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"j", "=", "14"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdah"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"tl", "*", "RCDAh"}], ",", 
                   RowBox[{"-", "1"}], ",", "secNp1mp1", ",", "Einit"}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcpl", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"channel", " ", "m"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"j", "=", "15"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdal"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"th", "*", "RCDAl"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNp1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"channel", " ", "m"}], "+", "1"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"j", "=", "16"}], ";", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcdah"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"tl", "*", "RCDAh"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNp1mp1", ",", "Einit"}], 
                  "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 6-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Jh", ":", " ", 
              StyleBox[
               RowBox[{"\[CapitalPi]", " ", "+", " ", 
                RowBox[{"A", "[", 
                 RowBox[{"NN", ",", "m"}], "]"}]}],
               FontSize->12]}], 
             StyleBox[" ",
              FontSize->12], 
             StyleBox["\[Rule]",
              FontSize->12], 
             StyleBox[" ",
              FontSize->12], 
             StyleBox[
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "1"}], ",", 
                 RowBox[{"m", "-", "1"}]}], "]"}]}],
              FontSize->12]}], 
            StyleBox[";",
             FontSize->12], 
            StyleBox[
             RowBox[{
              RowBox[{"Jl", ":", " ", 
               RowBox[{"\[CapitalPi]", " ", "+", " ", 
                RowBox[{"A", "[", 
                 RowBox[{"NN", ",", "m"}], "]"}]}]}], " ", "\[Rule]", " ", 
              RowBox[{"\[CapitalPi]", " ", "+", " ", "D", "+", " ", 
               RowBox[{"A", "[", 
                RowBox[{
                 RowBox[{"NN", "-", "1"}], ",", "m"}], "]"}]}]}],
             FontSize->12], 
            StyleBox[";",
             FontSize->12], 
            StyleBox[
             RowBox[{"For", " ", "Phi", " ", "case"}],
             FontSize->12]}], 
           StyleBox[",",
            FontSize->12], 
           StyleBox[" ",
            FontSize->12], 
           StyleBox[
            RowBox[{
             RowBox[{
              RowBox[{"switch", " ", "Jh"}], " ", "&"}], " ", "Jl"}],
            FontSize->12]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"lcar", "=", 
          RowBox[{"Length", "[", "CAR", "]"}]}], ";", 
         RowBox[{"lcal", "=", 
          RowBox[{"Length", "[", "CAL", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CAproc", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"CAR", ",", "CAL"}], "]"}]}], ";", 
         RowBox[{"lcAp", "=", 
          RowBox[{"Length", "[", "CAproc", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"lcAp", ">", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
            "only", " ", "if", " ", "m", " ", "is", " ", "not", " ", "0"}], 
            " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"{", 
                RowBox[{"ENm1mm1", ",", "UNm1mm1"}], "}"}], "*)"}], 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Es", "[", "12", "]"}], ",", 
                  RowBox[{"U", "[", "12", "]"}]}], "}"}], "=", 
                RowBox[{"DiagH", "[", 
                 RowBox[{
                  RowBox[{"NN", "-", "1"}], ",", 
                  RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"{", 
              RowBox[{"ENm1m", ",", "UNm1m"}], "}"}], "*)"}], 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Es", "[", "13", "]"}], ",", 
               RowBox[{"U", "[", "13", "]"}]}], "}"}], "=", 
             RowBox[{"DiagH", "[", 
              RowBox[{
               RowBox[{"NN", "-", "1"}], ",", "m", ",", "gg"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcar", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"n", "=", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ASites", ",", "Ntot"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtCAhR", ",", "HtCAlR"}], "}"}], "=", 
                RowBox[{"makeHtCA", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"m", " ", "channels"}], ",", " ", 
                 RowBox[{"j", "=", "16"}], ",", "17"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"RCAlR", "=", 
                RowBox[{"psi", ".", "HtCAlR", ".", 
                 RowBox[{"U", "[", "13", "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rrcalr", "=", 
                RowBox[{
                 RowBox[{"Norm", "[", "RCAlR", "]"}], "^", "2"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"j", "=", "17"}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"D", " ", "created"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcalr"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"Jl", "*", "RCAlR"}], ",", 
                   RowBox[{"-", "1"}], ",", "secNm1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"j", "=", "18"}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"Phi", " ", "created"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcalr"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"Jh", "*", "RCAlR"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"m", "-", 
                  RowBox[{"1", " ", "channels"}]}], ",", " ", 
                 RowBox[{"j", "=", "18"}], ",", "19"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"RCAhR", "=", 
                   RowBox[{"psi", ".", "HtCAhR", ".", 
                    RowBox[{"U", "[", "12", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"rrcahr", "=", 
                   RowBox[{
                    RowBox[{"Norm", "[", "RCAhR", "]"}], "^", "2"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"j", "=", "19"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{"D", " ", "created"}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rz", "[", "j", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcahr"}]}], 
                  ";", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Rates", "[", 
                    RowBox[{
                    RowBox[{"Jh", "*", "RCAhR"}], ",", 
                    RowBox[{"-", "1"}], ",", "secNm1mm1", ",", "Einit"}], 
                    "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{"rz", "[", "j", "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"j", "=", "20"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{"Phi", " ", "created"}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rz", "[", "j", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcahr"}]}], 
                  ";", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Rates", "[", 
                    RowBox[{
                    RowBox[{"Jl", "*", "RCAhR"}], ",", 
                    RowBox[{"+", "1"}], ",", "secNm1mm1", ",", "Einit"}], 
                    "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"lcal", ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"n", "=", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{"ASites", ",", "1"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HtCAhL", ",", "HtCAlL"}], "}"}], "=", 
                RowBox[{"makeHtCA", "[", 
                 RowBox[{"NN", ",", "m", ",", "n"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"m", " ", "channels"}], ",", " ", 
                 RowBox[{"j", "=", "16"}], ",", "17"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"RCAlL", "=", 
                RowBox[{"psi", ".", "HtCAlL", ".", 
                 RowBox[{"U", "[", "13", "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"rrcall", "=", 
                RowBox[{
                 RowBox[{"Norm", "[", "RCAlL", "]"}], "^", "2"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"j", "=", "21"}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"D", " ", "created"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcall"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"Jl", "*", "RCAlL"}], ",", 
                   RowBox[{"+", "1"}], ",", "secNm1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"j", "=", "21"}], ";", 
               RowBox[{"(*", " ", 
                RowBox[{"Phi", " ", "created"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rz", "[", "j", "]"}], "=", 
                RowBox[{
                 RowBox[{"pf", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcall"}]}], 
               ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"Jh", "*", "RCAlL"}], ",", 
                   RowBox[{"-", "1"}], ",", "secNm1m", ",", "Einit"}], "]"}], 
                 ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{"m", "-", 
                  RowBox[{"1", " ", "channels"}]}], ",", " ", 
                 RowBox[{"j", "=", "18"}], ",", "19"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"m", ">", "0"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"RCAhL", "=", 
                   RowBox[{"psi", ".", "HtCAhL", ".", 
                    RowBox[{"U", "[", "12", "]"}]}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"rrcahl", "=", 
                   RowBox[{
                    RowBox[{"Norm", "[", "RCAhL", "]"}], "^", "2"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"j", "=", "23"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{"D", " ", "created"}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rz", "[", "j", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcahl"}]}], 
                  ";", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Rates", "[", 
                    RowBox[{
                    RowBox[{"Jh", "*", "RCAhL"}], ",", 
                    RowBox[{"+", "1"}], ",", "secNm1mm1", ",", "Einit"}], 
                    "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{"rz", "[", "j", "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"j", "=", "24"}], ";", 
                  RowBox[{"(*", " ", 
                   RowBox[{"Phi", " ", "created"}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"rz", "[", "j", "]"}], "=", 
                   RowBox[{
                    RowBox[{"pf", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", "rrcahl"}]}], 
                  ";", 
                  RowBox[{"(*", 
                   RowBox[{
                    RowBox[{"Rates", "[", 
                    RowBox[{
                    RowBox[{"Jl", "*", "RCAhL"}], ",", 
                    RowBox[{"-", "1"}], ",", "secNm1mm1", ",", "Einit"}], 
                    "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"r", "[", "j", "]"}], "+=", 
                   RowBox[{"rz", "[", "j", "]"}]}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
             "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 7-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"kappa", " ", "and", " ", "gamma"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"kappa", ">", "0"}], "||", 
              RowBox[{"gamma", ">", "0"}]}], ")"}], "&&", 
            RowBox[{"m", ">", "0"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"ENmm1", ",", "UNmm1"}], "}"}], "=", 
              RowBox[{"DiagH", "[", 
               RowBox[{"NN", ",", 
                RowBox[{"m", "-", "1"}], ",", "gg"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"secNmm1", "=", 
              RowBox[{"sectors", "[", "ENmm1", "]"}]}], ";"}], 
            "\[IndentingNewLine]", "*)"}], 
           RowBox[{"(*", " ", "kappa", " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Rkappa", "=", 
             RowBox[{
              RowBox[{"Sqrt", "[", "kappa", "]"}], "*", 
              RowBox[{"psi", ".", 
               RowBox[{"HtKappa", "[", 
                RowBox[{"NN", ",", "m"}], "]"}], ".", 
               RowBox[{"U", "[", "2", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"j", "=", "25"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"rz", "[", "j", "]"}], "=", 
             RowBox[{
              RowBox[{"Norm", "[", "Rkappa", "]"}], "^", "2"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Rates", "[", 
               RowBox[{"Rkappa", ",", "0", ",", "secNmm1", ",", "Einit"}], 
               "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"r", "[", "j", "]"}], "+=", 
             RowBox[{"rz", "[", "j", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", "gamma", " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"j", "=", "26"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Rgamma", "[", "i", "]"}], " ", "=", " ", 
                RowBox[{
                 RowBox[{"Sqrt", "[", "gamma", "]"}], "*", 
                 RowBox[{"psi", ".", 
                  RowBox[{"HtGamma", "[", 
                   RowBox[{"NN", ",", "m", ",", "i"}], "]"}], ".", 
                  RowBox[{"U", "[", "2", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", "i", "]"}], "=", 
                RowBox[{
                 RowBox[{"Norm", "[", 
                  RowBox[{"Rgamma", "[", "i", "]"}], "]"}], "^", "2"}]}], ";", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Rates", "[", 
                  RowBox[{
                   RowBox[{"Rgamma", "[", "i", "]"}], ",", "0", ",", 
                   "secNmm1", ",", "Einit"}], "]"}], ";"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"r", "[", "j", "]"}], "+=", 
                RowBox[{
                 RowBox[{"rz", "[", "j", "]"}], "[", "i", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{
                 RowBox[{"rlist", "[", "j", "]"}], ",", 
                 RowBox[{
                  RowBox[{"rz", "[", "j", "]"}], "[", "i", "]"}]}], "]"}], 
               ";"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "NN"}], "}"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates 8-------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"total", " ", "rate", " ", "etc"}], ";", " ", 
           RowBox[{"add", " ", 
            RowBox[{"kappa", "/", 
             RowBox[{"gamma", " ", "!"}]}]}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<calc: r[j]: \>\"", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"r", "[", "j", "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "1", ",", "26"}], "}"}]}], "]"}]}], "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"totrates", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"r", "[", "j", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "26"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<totrates: \>\"", ",", "totrates"}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"wj", "=", 
          RowBox[{"WhichSite", "[", "totrates", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"R", "=", " ", 
          RowBox[{"Total", "[", "totrates", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"time", " ", "increment"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"u", "=", 
          RowBox[{"RandomReal", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"10", "^", 
              RowBox[{"-", "10"}]}], ",", "1"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dt", " ", "=", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "/", "R"}], " ", ")"}], "*", 
           RowBox[{"Log", "[", 
            RowBox[{"1", "/", "u"}], "]"}]}]}], ";", " ", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"or", " ", "just", " ", "average", " ", "value"}], "=", 
           " ", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{"R", " ", "?", " ", "dev"}]}], " ", "\[Sigma]"}], "=", 
            RowBox[{"1", "/", "R"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"t", " ", "+=", " ", "dt"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"times", ",", "t"}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- rates done -------------\>\"", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{"which", " ", 
             RowBox[{"process", ":", " ", "wj"}]}], "=", "?"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"eta", "=", 
            RowBox[{"RandomReal", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "R"}], " ", "}"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"wj", "=", "0"}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"eta", ">", 
                 RowBox[{"slist", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "&&", 
                RowBox[{"eta", "\[LessEqual]", "  ", 
                 RowBox[{"slist", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "+", "1"}], "]"}], "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"wj", "=", "i"}], ";", 
                RowBox[{"Break", "[", "]"}]}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "ltotr"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"wj", "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<Seems all rates are zero - check for errors! \>\"", 
                "]"}], ";"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
              "\"\<Seems all rates are zero - check for errors! \>\"", ">>>", 
               "file"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
            "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"Shorten", " ", "names", " ", "for", " ", "readability"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"wj", "=", "wj"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"ws", "=", "ws"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"wc", " ", "=", " ", 
           RowBox[{"whichchannel", "?"}]}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"which", " ", "sites", " ", "for", " ", "selected", " ", 
            RowBox[{"jump", "?"}]}], ":", " ", 
           RowBox[{"ws", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"nways", "[", "1", "]"}], ",", 
              RowBox[{"nways", "[", "2", "]"}], ",", 
              RowBox[{"nways", "[", "3", "]"}], ",", 
              RowBox[{"nways", "[", "4", "]"}], ",", 
              RowBox[{"nways", "[", "7", "]"}], ",", 
              RowBox[{"nways", "[", "8", "]"}], ",", 
              RowBox[{"nways", "[", "26", "]"}]}], "}"}], "=", 
            RowBox[{"{", 
             RowBox[{
             "ldr", ",", "ldl", ",", "lpr", ",", "lpl", ",", "lApairs", ",", 
              "lApairs", ",", "NN"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
          "*)"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                "1", ",", "2", ",", "3", ",", "4", ",", "7", ",", "8", ",", 
                 "26"}], "}"}], ",", "wj"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ws", "=", 
               RowBox[{"WhichSite", "[", 
                RowBox[{"rlist", "[", "wj", "]"}], "]"}]}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
          "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<rlist: \>\"", ",", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"rlist", "[", "j", "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", "26"}], "}"}]}], "]"}], "//", 
              "Chop"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"wc", "=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[LessEqual]", " ", "8"}], ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{
              "\"\<wj = \>\"", ",", "wj", ",", "\"\< rlist[wj]: \>\"", ",", 
               RowBox[{"rlist", "[", "wj", "]"}]}], "]"}], ";"}], "*)"}], 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"ws", ",", "wc"}], "}"}], "=", 
            RowBox[{"WhichSiteChannel", "[", 
             RowBox[{"rlist", "[", "wj", "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"wj", "\[Equal]", "26"}], ",", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Print", "[", "\"\<---- wj=26\>\"", "]"}], ";"}], 
              "*)"}], 
             RowBox[{"ws", "=", 
              RowBox[{"WhichSite", "[", 
               RowBox[{"rlist", "[", "wj", "]"}], "]"}]}]}], "]"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Not", "[", "includecross", "]"}], "&&", 
            RowBox[{"wc", ">", "2"}]}], ",", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{
             "\"\< Someting wrong... includecross=False, still wc>2; wc=\>\"",
               ",", "wc"}], "]"}], ";", " ", 
            RowBox[{"Abort", "[", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<totrates: \>\"", ",", "totrates"}], "}"}], ">>>", 
          "file"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<wj: \>\"", ",", "wj"}], "}"}], ">>>", "file"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<CAproc: 1 or Ntot? : \>\"", ",", "CAproc"}], "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<N,m: \>\"", ",", 
             RowBox[{"{", 
              RowBox[{"NN", ",", "m"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Ds: \>\"", ",", "Ds"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<\[Phi]s: \>\"", ",", "Phis"}], "]"}], ";"}], 
          "\[IndentingNewLine]", "*)"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Apairs: \>\"", ",", "Apairs"}], "]"}], ";"}], "*)"}],
          "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<ws in relevant list (not actual site label): \>\"", ",", 
             "ws"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         
         RowBox[{"(*", " ", 
          RowBox[{"change", " ", "state"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"psi", "=", 
          RowBox[{"ChooseFinalState", "[", 
           RowBox[{"wj", ",", "ws", ",", "wc"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"change", " ", "N", " ", "and", " ", "m"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"dN", ",", "dm"}], "}"}], "=", 
          RowBox[{"ListdNm", "[", 
           RowBox[{"[", 
            RowBox[{"EUinds", "[", 
             RowBox[{"[", 
              RowBox[{"wj", ",", "wc"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"NN", " ", "+=", " ", "dN"}], ";", " ", 
         RowBox[{"m", " ", "+=", "dm"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "Excitations", " ", "added", " ", "or", " ", "lost", " ", "due", 
            " ", "to", " ", "Homo"}], "-", 
           RowBox[{"Lumo", " ", "or", " ", "Lumo"}], "-", 
           RowBox[{"Homo", " ", 
            RowBox[{"hops", "?"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"ZQ", "=", "0"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[LessEqual]", "8"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wc", "\[Equal]", "3"}], ",", 
              RowBox[{"ZQ", "=", 
               RowBox[{"-", "1"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wc", "\[Equal]", "4"}], ",", 
              RowBox[{"ZQ", "=", "1"}]}], "]"}]}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- psi updated -----------\>\"", "]"}],
            ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"which", " ", "final", " ", 
            RowBox[{"state", "/", "degenerate"}], " ", 
            RowBox[{"sector", "?"}]}], ":", " ", 
           RowBox[{"whichsec", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"DhopsR", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "+", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Ds", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"DhopsL", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Ds", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "3"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"PhihopsR", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "+", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Phis", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "4"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"update", " ", "Ds"}], ",", " ", 
             RowBox[{"positions", " ", "of", " ", "D", " ", "sites"}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", "=", 
             RowBox[{"PhihopsL", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"apos", "=", 
             RowBox[{"pos", "-", "1"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Phis", "/.", 
              RowBox[{"{", 
               RowBox[{"pos", "\[Rule]", " ", "apos"}], "}"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"ASites", "/.", 
              RowBox[{"{", 
               RowBox[{"apos", "\[Rule]", " ", "pos"}], "}"}]}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"DPhiR", " ", "and", " ", "DPhiL", " ", "cases"}], ";", 
            " ", 
            RowBox[{"j", "=", "5"}]}], ",", "6"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "5"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ws", "=", 
             RowBox[{"RandomInteger", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "ldpr"}], "}"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"update", " ", "Ds"}], " ", "&"}], " ", "Phis"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"DPhiR", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"Ds", ",", "pos"}], "]"}]}], ";", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Ds", "=", 
               RowBox[{"Drop", "[", 
                RowBox[{"Ds", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"Position", "[", 
                    RowBox[{"Ds", ",", "pos"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "}"}]}], "]"}]}], 
              ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"Phis", ",", 
               RowBox[{"pos", "+", "1"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"ASites", ",", "pos"}], "]"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "first", " ", "D", " ", "then", " ", "Phi", " ", "sites"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"ASites", ",", 
              RowBox[{"pos", "+", "1"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "6"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ws", "=", 
             RowBox[{"RandomInteger", "[", 
              RowBox[{"{", 
               RowBox[{"1", ",", "ldpl"}], "}"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{
               RowBox[{"update", " ", "Ds"}], " ", "&"}], " ", "Phis"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"DPhiL", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Ds", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"Ds", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Phis", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"Phis", ",", 
               RowBox[{"pos", "-", "1"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"ASites", ",", "pos"}], "]"}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "first", " ", "D", " ", "then", " ", "Phi", " ", "sites"}], " ", 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"ASites", ",", 
              RowBox[{"pos", "-", "1"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"Apairs", " ", "cases"}], ";", " ", "DPhi"}], ",", 
           RowBox[{"PhiD", " ", "\[Equal]", ">", " ", 
            RowBox[{"j", " ", "7"}]}], ",", "8"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "7"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds", " ", "and", " ", "Phis"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"Apairs", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Ds", ",", "pos"}], "]"}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Phis", ",", 
              RowBox[{"pos", "+", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "pos"}], "]"}]}], ";", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{"pos", "+", "1"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"wj", "\[Equal]", "8"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"update", " ", "Ds", " ", "and", " ", "Phis"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"pos", 
             StyleBox["=",
              FontSize->14], 
             RowBox[{"Apairs", "[", 
              RowBox[{"[", "ws", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Ds", ",", 
              RowBox[{"pos", "+", "1"}]}], "]"}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"Phis", ",", "pos"}], "]"}], ";", "\[IndentingNewLine]", 
            
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "pos"}], "]"}]}], ";", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", 
               RowBox[{"pos", "+", "1"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "9"}], "||", 
            RowBox[{"wj", "\[Equal]", "11"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "9"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Ds", ",", "Ntot"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Ds", ",", "1"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}], ";"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", " ", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "10"}], "||", 
            RowBox[{"wj", "\[Equal]", "12"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "10"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Ds", ",", "Ntot"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{
               RowBox[{"Ds", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Ds", ",", "1"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}]}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "13"}], "||", 
            RowBox[{"wj", "\[Equal]", "15"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "13"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Phis", ",", "Ntot"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Phis", ",", "1"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}]}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "14"}], "||", 
            RowBox[{"wj", "\[Equal]", "16"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "14"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Phis", ",", "Ntot"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "Ntot"}], "]"}], ";"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{
               RowBox[{"Phis", "=", 
                RowBox[{"Dropp", "[", 
                 RowBox[{"Phis", ",", "1"}], "]"}]}], ";", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"ASites", ",", "1"}], "]"}], ";"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "17"}], "||", 
            RowBox[{"wj", "\[Equal]", "18"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "17"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Ds", ",", "Ntot"}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Phis", ",", "Ntot"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "Ntot"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "19"}], "||", 
            RowBox[{"wj", "\[Equal]", "20"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "19"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Ds", ",", "Ntot"}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Phis", ",", "Ntot"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "Ntot"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "21"}], "||", 
            RowBox[{"wj", "\[Equal]", "22"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "21"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Ds", ",", "1"}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Phis", ",", "1"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "1"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"wj", "\[Equal]", "23"}], "||", 
            RowBox[{"wj", "\[Equal]", "24"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"wj", "\[Equal]", "23"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Ds", ",", "1"}], "]"}], ",", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Phis", ",", "1"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"ASites", "=", 
             RowBox[{"Dropp", "[", 
              RowBox[{"ASites", ",", "1"}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<----------- all done -------------\>\"", "]"}], 
           ";"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Elevels: \>\"", ",", "Elevels"}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"Dsvst", ",", "Ds"}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"Phisvst", ",", "Phis"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"mvst", ",", "m"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<t = \>\"", ",", "t"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Iteration # \>\"", ",", "ITER"}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Evst", ",", "Einit"}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"out2", ",", 
           RowBox[{"{", 
            RowBox[{"ITER", ",", "t", ",", 
             RowBox[{"Current", "[", 
              RowBox[{"[", "wj", "]"}], "]"}], ",", "dt", ",", "Ds", ",", 
             "Phis", ",", "NN", ",", "m", ",", 
             RowBox[{
              RowBox[{"Length", "[", "Ds", "]"}], "+", "m"}], ",", "totrates",
              ",", "wj", ",", "wc", ",", "ZQ"}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<psi: \>\"", ",", "psi"}], "]"}], ";"}], 
          "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"psi", "=", 
            RowBox[{"psif", "/", 
             RowBox[{"Norm", "[", "psif", "]"}]}]}], ";"}], 
          "\[IndentingNewLine]", "*)"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "psi", "]"}], "\[Equal]", "1"}], ",", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<psif: \>\"", ",", "psi"}], "]"}]}], "]"}], ";"}], 
          "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{"\"\<N,m: \>\"", ",", 
             RowBox[{"{", 
              RowBox[{"NN", ",", "m"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Ds: \>\"", ",", "Ds"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<\[Phi]s: \>\"", ",", "Phis"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<Einit: \>\"", ",", "Einit"}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<t = \>\"", ",", "t"}], "}"}], ">>>", "file"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<N,m: \>\"", ",", 
            RowBox[{"{", 
             RowBox[{"NN", ",", "m"}], "}"}]}], "}"}], ">>>", "file"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Ds: \>\"", ",", "Ds"}], "}"}], ">>>", "file"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<\[Phi]s: \>\"", ",", "Phis"}], "}"}], ">>>", "file"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\"\<Einit: \>\"", ",", "Einit"}], "}"}], ">>>", "file"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"output", " ", 
        RowBox[{"??", "?"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Evst", "=", 
       RowBox[{"Insert", "[", 
        RowBox[{
         RowBox[{"Differences", "[", "Evst", "]"}], ",", "0", ",", "1"}], 
        "]"}]}], ";", 
      RowBox[{"(*", " ", 
       RowBox[{"get", " ", "dE"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<N = \>\"", ",", 
        RowBox[{"out2", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "7"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<m = \>\"", ",", 
        RowBox[{"out2", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "8"}], "]"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<j = \>\"", ",", 
        RowBox[{
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"Tally", "[", 
            RowBox[{"out2", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", 
               RowBox[{"-", "3"}]}], "]"}], "]"}], "]"}], ",", "Last"}], 
          "]"}], "//", "Reverse"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"out2", "=", 
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"out2", "//", "Transpose"}], ",", 
           RowBox[{"Evst", "//", "Transpose"}], ",", "2"}], "]"}]}], ";"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"out2", ",", "Evst"}], "}"}]}]}], 
    RowBox[{"(*", 
     RowBox[{"{", 
      RowBox[{"times", ",", "Dsvst", ",", "Phisvst", ",", "mvst"}], "}"}], 
     "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.704783172421139*^9, 3.7047833359558783`*^9}, {
   3.704783486810378*^9, 3.704783561532089*^9}, {3.704783618794695*^9, 
   3.7047837283106537`*^9}, {3.704783775128314*^9, 3.7047837895580482`*^9}, {
   3.704783830904345*^9, 3.7047839658066263`*^9}, {3.704784129133769*^9, 
   3.7047841459876432`*^9}, {3.704784192038864*^9, 3.704784560153019*^9}, {
   3.704786369819558*^9, 3.704786486736259*^9}, {3.7047865267200413`*^9, 
   3.704786607019348*^9}, {3.70478664673158*^9, 3.704786758061687*^9}, {
   3.7047867892982273`*^9, 3.704786814247991*^9}, {3.704786848440436*^9, 
   3.7047868933629513`*^9}, {3.7047869320186987`*^9, 3.704787014042985*^9}, {
   3.704787052574963*^9, 3.704787172605968*^9}, {3.704787389469852*^9, 
   3.704787402954513*^9}, {3.704790843596768*^9, 3.704791068640873*^9}, {
   3.7047911011072073`*^9, 3.7047911186253366`*^9}, {3.70479123857541*^9, 
   3.704791301455451*^9}, {3.704792963911644*^9, 3.7047934003686123`*^9}, 
   3.70479344973145*^9, {3.705059513112097*^9, 3.7050595138643513`*^9}, {
   3.705059588351756*^9, 3.7050596479609118`*^9}, {3.705061758157002*^9, 
   3.705061954238187*^9}, {3.705062014768548*^9, 3.705062767498807*^9}, {
   3.705062821104437*^9, 3.705063030567404*^9}, {3.7050630696394787`*^9, 
   3.705063108734951*^9}, {3.7050631456941547`*^9, 3.705063342306601*^9}, {
   3.70506353727276*^9, 3.7050635417821407`*^9}, {3.7051255964481497`*^9, 
   3.705125742097025*^9}, {3.705125775880097*^9, 3.705126006222837*^9}, {
   3.705126058407432*^9, 3.705126087606455*^9}, {3.705126130393464*^9, 
   3.705126209479981*^9}, {3.705126263040592*^9, 3.7051263403671417`*^9}, {
   3.705128535085127*^9, 3.705128616888104*^9}, {3.705128656480611*^9, 
   3.705128704184763*^9}, {3.705128755889853*^9, 3.7051288005502977`*^9}, {
   3.70512958204272*^9, 3.705129924780792*^9}, {3.705129957455364*^9, 
   3.705129979627635*^9}, {3.705130014599234*^9, 3.705130070846201*^9}, {
   3.7051301403611937`*^9, 3.705130169616908*^9}, {3.705130213635092*^9, 
   3.70513026417274*^9}, {3.705130296668211*^9, 3.705130332491054*^9}, 
   3.705130417665039*^9, {3.70513101982754*^9, 3.7051316362274103`*^9}, {
   3.7051316898164043`*^9, 3.705131720950481*^9}, {3.7051317727363873`*^9, 
   3.705131803316923*^9}, {3.705131879783592*^9, 3.7051318848424387`*^9}, 
   3.705131925634592*^9, {3.705131957767816*^9, 3.7051322212253532`*^9}, {
   3.705133240871599*^9, 3.705133250575276*^9}, {3.705133286504322*^9, 
   3.705133313869225*^9}, {3.705133344297269*^9, 3.7051333816767282`*^9}, {
   3.705133434563531*^9, 3.705133517450326*^9}, {3.705133586364935*^9, 
   3.7051336131051617`*^9}, {3.705133652823696*^9, 3.7051336532785273`*^9}, {
   3.7051337405045843`*^9, 3.70513411842062*^9}, {3.705134160861816*^9, 
   3.705134293541276*^9}, {3.705134331152937*^9, 3.705134359390081*^9}, {
   3.705134393916771*^9, 3.705134438714485*^9}, {3.705134475322234*^9, 
   3.705134518136128*^9}, {3.705134552299152*^9, 3.7051346231578617`*^9}, {
   3.7051346568268433`*^9, 3.705134701013432*^9}, {3.705134742471919*^9, 
   3.705134754589505*^9}, {3.705134818978344*^9, 3.705134848490744*^9}, {
   3.705136850559153*^9, 3.705136877807722*^9}, {3.705136978677987*^9, 
   3.7051370440888147`*^9}, {3.7051370840313683`*^9, 3.705137122144758*^9}, {
   3.7051372365013523`*^9, 3.705137301977664*^9}, {3.705137343655925*^9, 
   3.70513740175257*^9}, {3.705137495942437*^9, 3.705137589557526*^9}, {
   3.705137633236888*^9, 3.705137862356967*^9}, {3.706509873943427*^9, 
   3.706509881575404*^9}, {3.70651002017414*^9, 3.706510032334733*^9}, {
   3.7065131411035023`*^9, 3.706513159662982*^9}, {3.706513289955968*^9, 
   3.706513439163087*^9}, {3.706513495851425*^9, 3.7065135906028423`*^9}, {
   3.7065136274404917`*^9, 3.7065136896645727`*^9}, {3.7065137495575657`*^9, 
   3.7065139446788588`*^9}, {3.706513978303144*^9, 3.7065140005959272`*^9}, {
   3.706514323249061*^9, 3.706514330247436*^9}, {3.7065146659835777`*^9, 
   3.7065147125346327`*^9}, {3.706514923898381*^9, 3.706515064373992*^9}, 
   3.706515786325506*^9, {3.706515842465146*^9, 3.70651586145531*^9}, {
   3.706518343358388*^9, 3.706518349603982*^9}, {3.7065183917171173`*^9, 
   3.7065184014167624`*^9}, {3.706518433443201*^9, 3.706518522727351*^9}, {
   3.706518554111517*^9, 3.70651861985944*^9}, 3.7065186577108383`*^9, {
   3.706521723067787*^9, 3.70652174126503*^9}, {3.706534234666196*^9, 
   3.706534235938246*^9}, {3.706536583984984*^9, 3.7065366821358423`*^9}, {
   3.706537365015826*^9, 3.706537452204118*^9}, {3.7065383010170593`*^9, 
   3.706538379002997*^9}, {3.706545865648337*^9, 3.7065458725733232`*^9}, {
   3.706545910914023*^9, 3.706546019468893*^9}, {3.706595810812895*^9, 
   3.706595817435524*^9}, {3.706595865963649*^9, 3.706595878611367*^9}, {
   3.706595923932712*^9, 3.7065959681151447`*^9}, {3.706597552991376*^9, 
   3.7065975736391973`*^9}, {3.706597630608406*^9, 3.706597646805417*^9}, {
   3.70659769276257*^9, 3.706597751208255*^9}, {3.70659783662741*^9, 
   3.706597860439271*^9}, {3.706598260026404*^9, 3.70659829894306*^9}, {
   3.7065983581509743`*^9, 3.7065984300634623`*^9}, {3.706598466617525*^9, 
   3.706598523550221*^9}, {3.706603363728672*^9, 3.706603437956768*^9}, {
   3.7066034725848227`*^9, 3.706603594318576*^9}, {3.706603638081397*^9, 
   3.7066037791953506`*^9}, {3.706603829851663*^9, 3.70660392906595*^9}, {
   3.706603962450411*^9, 3.7066040030163116`*^9}, {3.706604060300254*^9, 
   3.70660406486514*^9}, {3.706604120473002*^9, 3.706604176324741*^9}, {
   3.706604238815672*^9, 3.706604386370186*^9}, {3.706604520877483*^9, 
   3.706604528060874*^9}, {3.706604663779698*^9, 3.706604685682488*^9}, {
   3.706604746629105*^9, 3.706605071436154*^9}, {3.706605101994122*^9, 
   3.7066051222431927`*^9}, {3.70660576240668*^9, 3.706605799600741*^9}, {
   3.7066058973464518`*^9, 3.706605898193409*^9}, {3.706607919945128*^9, 
   3.706607940031229*^9}, {3.7066079736600943`*^9, 3.706608244661215*^9}, {
   3.706608315789989*^9, 3.706608316181827*^9}, {3.706608366916226*^9, 
   3.706608369468254*^9}, {3.706608487773247*^9, 3.706608514692258*^9}, 
   3.706608565356036*^9, {3.706608805848152*^9, 3.7066088094873753`*^9}, {
   3.706608932336582*^9, 3.70660894422617*^9}, {3.70660898741103*^9, 
   3.706609025309536*^9}, {3.706609101682107*^9, 3.706609104654673*^9}, {
   3.7066092081287537`*^9, 3.706609239529347*^9}, 3.706609270002934*^9, {
   3.7066099326965446`*^9, 3.706609943393063*^9}, {3.7066106027302113`*^9, 
   3.706610618132289*^9}, {3.706610708645006*^9, 3.706610734395289*^9}, {
   3.7066108151296*^9, 3.7066108267455072`*^9}, {3.7066108742393217`*^9, 
   3.706610897438221*^9}, {3.706610931364291*^9, 3.70661094317912*^9}, {
   3.706610996326351*^9, 3.706611004622718*^9}, {3.7066110989729424`*^9, 
   3.706611124124144*^9}, {3.706611164266272*^9, 3.706611195095063*^9}, {
   3.706611268194743*^9, 3.706611281417799*^9}, {3.7066113670341988`*^9, 
   3.706611392185605*^9}, {3.706611430328508*^9, 3.706611530869961*^9}, 
   3.706611572527708*^9, {3.706612625332357*^9, 3.706612645731523*^9}, {
   3.706612693933943*^9, 3.706612708430121*^9}, {3.7066127428118668`*^9, 
   3.706612749985382*^9}, {3.706612814653928*^9, 3.7066128257911263`*^9}, {
   3.70661287768003*^9, 3.706612879230733*^9}, {3.7066129798311987`*^9, 
   3.706613033697703*^9}, {3.706613213425725*^9, 3.706613223656927*^9}, {
   3.7066132703060427`*^9, 3.706613285682077*^9}, {3.706613326009914*^9, 
   3.706613326888667*^9}, {3.7066133637223263`*^9, 3.706613422776167*^9}, {
   3.706613458941738*^9, 3.7066134912489443`*^9}, {3.706614485946495*^9, 
   3.706614489512269*^9}, {3.7067990569120703`*^9, 3.706799065076029*^9}, {
   3.706799105589189*^9, 3.706799152286755*^9}, {3.706799382964511*^9, 
   3.706799390051456*^9}, {3.706799456143239*^9, 3.706799462462285*^9}, {
   3.7067995715032454`*^9, 3.706799657306563*^9}, {3.7067997567972097`*^9, 
   3.7067997910646*^9}, {3.706799874175828*^9, 3.706799910087903*^9}, {
   3.7068003537474403`*^9, 3.7068003827709*^9}, {3.7068013887076883`*^9, 
   3.7068013938831167`*^9}, {3.7068014251877117`*^9, 3.706801484286682*^9}, {
   3.706801769786557*^9, 3.706801824070918*^9}, {3.7068018856345797`*^9, 
   3.706801958253146*^9}, {3.706802044964902*^9, 3.706802098480714*^9}, {
   3.7068021641483097`*^9, 3.706802285507266*^9}, {3.7068029702830563`*^9, 
   3.706802988267655*^9}, {3.706812407046031*^9, 3.706812560244092*^9}, {
   3.706812630886078*^9, 3.706812659104816*^9}, {3.706812908907963*^9, 
   3.706812922350101*^9}, {3.706817936268448*^9, 3.706817942990999*^9}, {
   3.706817973328759*^9, 3.7068180210135803`*^9}, {3.706818217663375*^9, 
   3.7068182423539667`*^9}, {3.706818440398896*^9, 3.706818457835308*^9}, 
   3.706818493132701*^9, {3.706818588641736*^9, 3.7068186820109386`*^9}, {
   3.7068187144454937`*^9, 3.706818729156329*^9}, {3.706818838653962*^9, 
   3.706818841046473*^9}, {3.706819001367852*^9, 3.706819067659362*^9}, {
   3.7068191793218813`*^9, 3.706819276541692*^9}, 3.7068194852863827`*^9, {
   3.7068195704708967`*^9, 3.7068196213406353`*^9}, {3.706819733871563*^9, 
   3.7068197623658457`*^9}, {3.706819881557279*^9, 3.706819921585165*^9}, {
   3.706820020012499*^9, 3.706820026746523*^9}, {3.706820140008994*^9, 
   3.7068201846675253`*^9}, {3.706820219149828*^9, 3.7068203879378366`*^9}, {
   3.706820455534668*^9, 3.70682055671462*^9}, {3.706820805009758*^9, 
   3.706820853035634*^9}, {3.70686414054748*^9, 3.7068641758670883`*^9}, {
   3.706865576847663*^9, 3.706865596373768*^9}, {3.7068656560115967`*^9, 
   3.706865675657983*^9}, {3.7068657688930902`*^9, 3.706865771960717*^9}, {
   3.706865833538558*^9, 3.706865889118916*^9}, {3.70686594746532*^9, 
   3.706865966407058*^9}, {3.7068660541671133`*^9, 3.706866152424388*^9}, {
   3.7068669855065603`*^9, 3.706867001229067*^9}, {3.70686752244597*^9, 
   3.706867536349134*^9}, {3.7068676814407387`*^9, 3.706867713782263*^9}, {
   3.706867839383494*^9, 3.7068678727713614`*^9}, {3.706867921369946*^9, 
   3.706867960617537*^9}, {3.706868412396632*^9, 3.706868416855505*^9}, {
   3.706868482272785*^9, 3.706868493305138*^9}, {3.706868562704898*^9, 
   3.706868613349305*^9}, {3.706868783557411*^9, 3.706868816806634*^9}, {
   3.70686905288794*^9, 3.70686908956033*^9}, {3.7068692241783943`*^9, 
   3.706869234031941*^9}, {3.7068695197708387`*^9, 3.7068695647268143`*^9}, {
   3.706875750444603*^9, 3.7068757880155077`*^9}, {3.706875895171781*^9, 
   3.706875904212925*^9}, {3.706876130515038*^9, 3.706876165141712*^9}, {
   3.706876252704343*^9, 3.7068762900527573`*^9}, {3.7068763593893137`*^9, 
   3.70687635957143*^9}, {3.70687655162044*^9, 3.706876581892149*^9}, {
   3.706877344909102*^9, 3.706877347069663*^9}, {3.706877530827804*^9, 
   3.706877573624424*^9}, {3.706877678614237*^9, 3.70687768105379*^9}, {
   3.706945107672452*^9, 3.706945159772511*^9}, {3.7069453823165417`*^9, 
   3.706945548334036*^9}, {3.706945697167466*^9, 3.706945706938045*^9}, {
   3.706949810600993*^9, 3.706949902733562*^9}, {3.706949984596388*^9, 
   3.7069500184637527`*^9}, {3.706950095960967*^9, 3.706950183200349*^9}, {
   3.706950443391224*^9, 3.706950472704021*^9}, {3.7069505148721533`*^9, 
   3.7069505192659492`*^9}, {3.706950977767359*^9, 3.7069511041223793`*^9}, {
   3.7069511626958647`*^9, 3.7069512834148684`*^9}, {3.706951410151729*^9, 
   3.7069514405014553`*^9}, {3.7069518995811043`*^9, 3.706951931731307*^9}, {
   3.706952038521633*^9, 3.706952062596208*^9}, {3.70695268898332*^9, 
   3.7069526977129507`*^9}, {3.706953563655384*^9, 3.706953585626975*^9}, {
   3.7069536333358383`*^9, 3.706953779391068*^9}, 3.706954015591402*^9, {
   3.70695487074964*^9, 3.706954907754259*^9}, {3.706954999742259*^9, 
   3.706955003652726*^9}, {3.706955101416648*^9, 3.706955110957039*^9}, {
   3.706955153223144*^9, 3.706955159648882*^9}, {3.7069552238255453`*^9, 
   3.706955399112224*^9}, {3.706965156466342*^9, 3.7069651941369057`*^9}, {
   3.706965278203692*^9, 3.706965313836733*^9}, {3.706977106616974*^9, 
   3.706977172480888*^9}, {3.706977748054043*^9, 3.7069778093780107`*^9}, {
   3.706977975666453*^9, 3.706977976632317*^9}, {3.7069795577547626`*^9, 
   3.7069796548212967`*^9}, {3.706979686676147*^9, 3.7069797616213503`*^9}, 
   3.706980330768794*^9, 3.70698052478911*^9, {3.706980624818881*^9, 
   3.706980631584763*^9}, {3.706980795328545*^9, 3.7069808281227493`*^9}, {
   3.706981071980934*^9, 3.706981102335576*^9}, {3.706981139647217*^9, 
   3.7069813043508787`*^9}, {3.706981350257668*^9, 3.7069813623220673`*^9}, {
   3.706981409100527*^9, 3.7069815075373898`*^9}, {3.706981924221408*^9, 
   3.706981924432145*^9}, {3.707031951907673*^9, 3.707031973817018*^9}, {
   3.707032024996976*^9, 3.707032077763987*^9}, 3.7070321301251707`*^9, {
   3.707032308774404*^9, 3.7070324114608393`*^9}, {3.7070324623696423`*^9, 
   3.707032470171609*^9}, {3.707032632159247*^9, 3.70703286496145*^9}, {
   3.707032973678144*^9, 3.7070329937840137`*^9}, {3.707078412268784*^9, 
   3.7070784912751503`*^9}, {3.707114498829337*^9, 3.707114532234054*^9}, {
   3.707114598881935*^9, 3.7071146150004683`*^9}, 3.707114676496119*^9, {
   3.707115053758727*^9, 3.707115055148697*^9}, {3.707127976311824*^9, 
   3.707128011670862*^9}, {3.707128082157331*^9, 3.707128136020152*^9}, {
   3.7071282284585*^9, 3.707128240007594*^9}, {3.707128341831828*^9, 
   3.707128364470326*^9}, {3.7071284135003*^9, 3.707128427123947*^9}, {
   3.707128474202423*^9, 3.707128483273594*^9}, {3.707128562953072*^9, 
   3.707128605114244*^9}, 3.7071297960489683`*^9, {3.707129826812801*^9, 
   3.70712982692697*^9}, {3.707129882588839*^9, 3.707129894377606*^9}, {
   3.707129929168397*^9, 3.70713008643091*^9}, {3.707130201572953*^9, 
   3.70713027330224*^9}, 3.707133801967572*^9, {3.707133990858861*^9, 
   3.707134041999831*^9}, {3.707134124121233*^9, 3.707134131704339*^9}, 
   3.707134184574418*^9, {3.707134217221533*^9, 3.7071342197009153`*^9}, {
   3.7071345381608562`*^9, 3.707134659058621*^9}, {3.7071377073587646`*^9, 
   3.707137717557722*^9}, {3.707421978218014*^9, 3.707422052758395*^9}, {
   3.707422111136056*^9, 3.7074221245522013`*^9}, {3.707422502011422*^9, 
   3.707422526881319*^9}, {3.707422558745614*^9, 3.707422559480315*^9}, {
   3.70742264503503*^9, 3.707422730843542*^9}, {3.70742280902003*^9, 
   3.707422920852594*^9}, {3.707422996391962*^9, 3.70742304410535*^9}, {
   3.707423084951748*^9, 3.707423304389914*^9}, {3.70742355113973*^9, 
   3.7074237884288473`*^9}, {3.707423821742032*^9, 3.707423887600354*^9}, {
   3.707423925096113*^9, 3.707424018770583*^9}, {3.7074240864656277`*^9, 
   3.7074240866656847`*^9}, {3.70742413277619*^9, 3.707424148841321*^9}, {
   3.707424210963591*^9, 3.7074242918596897`*^9}, {3.707424362766016*^9, 
   3.7074244930757713`*^9}, {3.707424532509994*^9, 3.707424666770349*^9}, {
   3.7074247464372187`*^9, 3.707424981647725*^9}, {3.70742501839817*^9, 
   3.7074251120637407`*^9}, {3.707425171969903*^9, 3.707425184014285*^9}, 
   3.7074252329140377`*^9, {3.707425264368431*^9, 3.707425273425045*^9}, {
   3.707425313654545*^9, 3.707425432591395*^9}, {3.707425528833336*^9, 
   3.707425572270451*^9}, {3.707425643856003*^9, 3.707425682087895*^9}, {
   3.707425729894105*^9, 3.707425741509515*^9}, {3.707425779014577*^9, 
   3.707425916478269*^9}, {3.707426118251792*^9, 3.707426313618778*^9}, {
   3.707426343955817*^9, 3.7074264243787317`*^9}, {3.707426463926344*^9, 
   3.7074265171937513`*^9}, {3.707426626878499*^9, 3.707426682737935*^9}, {
   3.707426715190089*^9, 3.707426715809466*^9}, {3.7074267657449417`*^9, 
   3.7074267889248753`*^9}, {3.707426824983493*^9, 3.707426962226622*^9}, {
   3.70742699796169*^9, 3.7074270535742188`*^9}, {3.707427106888102*^9, 
   3.707427162545514*^9}, {3.707427237533361*^9, 3.707427342442511*^9}, {
   3.707427402558837*^9, 3.707427579724554*^9}, {3.707427755702105*^9, 
   3.707427789706729*^9}, {3.7074278359370737`*^9, 3.707427878633362*^9}, {
   3.70742792631225*^9, 3.707427933761424*^9}, {3.707428088531415*^9, 
   3.707428105029168*^9}, {3.70742813681735*^9, 3.70742816089132*^9}, {
   3.7074281965257473`*^9, 3.707428198793292*^9}, {3.707428297309895*^9, 
   3.707428303052355*^9}, {3.707428352796157*^9, 3.707428539338376*^9}, {
   3.7074285758978167`*^9, 3.7074287730485373`*^9}, {3.707428836903068*^9, 
   3.7074288421499443`*^9}, {3.707428874458733*^9, 3.7074289279453783`*^9}, {
   3.707429006215967*^9, 3.707429094094816*^9}, {3.707429125664762*^9, 
   3.7074291259048147`*^9}, {3.707429198445793*^9, 3.707429305624937*^9}, {
   3.707429403650344*^9, 3.707429487489094*^9}, {3.707429654112049*^9, 
   3.707429658201881*^9}, {3.707429703633066*^9, 3.707429730423897*^9}, {
   3.707429768792376*^9, 3.707429771447042*^9}, {3.707429826415945*^9, 
   3.7074300627473516`*^9}, 3.7074300934455*^9, {3.707430249141099*^9, 
   3.707430250450308*^9}, {3.7074302956811*^9, 3.7074302984006233`*^9}, {
   3.707430609661083*^9, 3.7074306129660273`*^9}, {3.7074306466552896`*^9, 
   3.707430663956114*^9}, {3.7074309295454607`*^9, 3.707430952181271*^9}, {
   3.707431189952114*^9, 3.7074312327869053`*^9}, {3.70743126785526*^9, 
   3.707431351772189*^9}, 3.707431415371449*^9, {3.7074314727843*^9, 
   3.707431474738083*^9}, {3.707431648910516*^9, 3.707431668998911*^9}, {
   3.7074317436637897`*^9, 3.707431992934462*^9}, {3.7074321671986647`*^9, 
   3.7074322114219227`*^9}, {3.707432290908279*^9, 3.7074323437743273`*^9}, 
   3.7074323875645247`*^9, {3.707432427708975*^9, 3.707432464706283*^9}, {
   3.7074325462700653`*^9, 3.707432739190762*^9}, {3.707433042038485*^9, 
   3.7074332044287033`*^9}, {3.707433241557753*^9, 3.70743324261229*^9}, {
   3.707433336843268*^9, 3.707433554990307*^9}, {3.707433649899005*^9, 
   3.707433719086891*^9}, {3.707433795361105*^9, 3.7074339735370502`*^9}, {
   3.7074340428758173`*^9, 3.707434051276805*^9}, {3.7074341053462667`*^9, 
   3.7074341100917273`*^9}, {3.707434165849386*^9, 3.707434191903417*^9}, {
   3.707434332313882*^9, 3.707434386080551*^9}, {3.7074344201057873`*^9, 
   3.707434508982613*^9}, {3.707434545043288*^9, 3.707434645407415*^9}, {
   3.707434677162508*^9, 3.707434866324085*^9}, {3.70743490120418*^9, 
   3.707434999520597*^9}, {3.707435043477284*^9, 3.707435047708508*^9}, {
   3.707435104329197*^9, 3.7074351374681787`*^9}, {3.707435318045589*^9, 
   3.7074353460274057`*^9}, {3.707435393397634*^9, 3.707435540596117*^9}, {
   3.707435679618762*^9, 3.707435704472139*^9}, {3.707435745600422*^9, 
   3.7074358195140457`*^9}, {3.707435862182495*^9, 3.707436054263921*^9}, 
   3.707436153837927*^9, {3.707436214480523*^9, 3.707436335565938*^9}, {
   3.707436371453121*^9, 3.707436379562686*^9}, {3.707436786645866*^9, 
   3.707436803573352*^9}, {3.707436973910347*^9, 3.707437141738269*^9}, {
   3.707437181330385*^9, 3.707437201920671*^9}, {3.7074372646350307`*^9, 
   3.707437474799333*^9}, {3.7074375345822363`*^9, 3.707437683839283*^9}, {
   3.707438058593663*^9, 3.707438124310261*^9}, {3.707438158361291*^9, 
   3.707438164967066*^9}, {3.7074382123553553`*^9, 3.7074382129492483`*^9}, {
   3.707438359218914*^9, 3.7074384506951923`*^9}, {3.7074385160055017`*^9, 
   3.70743851770605*^9}, {3.7074385516793413`*^9, 3.7074386097519836`*^9}, {
   3.7074386885356207`*^9, 3.707438694278549*^9}, {3.707438908610486*^9, 
   3.707438917591271*^9}, {3.707439126606495*^9, 3.7074391630003643`*^9}, {
   3.707439303655726*^9, 3.7074393597402143`*^9}, {3.707439432541696*^9, 
   3.707439439486684*^9}, {3.707439501300838*^9, 3.7074395228872232`*^9}, {
   3.7074396406042128`*^9, 3.707439681378058*^9}, {3.70743975188414*^9, 
   3.707439763753859*^9}, {3.707439799817079*^9, 3.70743980416707*^9}, {
   3.7074398351061573`*^9, 3.707439959401544*^9}, {3.7074401530450153`*^9, 
   3.7074401598357887`*^9}, {3.7074405533642483`*^9, 3.70744059089746*^9}, {
   3.707440781662705*^9, 3.707440805079*^9}, {3.707441179866899*^9, 
   3.707441202378429*^9}, {3.7074413062627153`*^9, 3.707441322916849*^9}, {
   3.707441428206937*^9, 3.707441486837838*^9}, {3.707441536360279*^9, 
   3.70744155342225*^9}, {3.707442056502799*^9, 3.7074420573023453`*^9}, {
   3.707442162687429*^9, 3.707442173365855*^9}, {3.707442255840432*^9, 
   3.707442260711698*^9}, {3.7074423603101997`*^9, 3.707442379859851*^9}, {
   3.707442437106941*^9, 3.707442460018488*^9}, {3.707442553297069*^9, 
   3.7074425586224003`*^9}, {3.707442589999648*^9, 3.707442594727646*^9}, {
   3.707442671917807*^9, 3.707442806325791*^9}, {3.7074431660179443`*^9, 
   3.707443167676187*^9}, {3.707443376981769*^9, 3.70744337733916*^9}, 
   3.707443500325959*^9, {3.707466394347229*^9, 3.7074665124843197`*^9}, {
   3.7074665668000393`*^9, 3.707466655257741*^9}, {3.707466688145543*^9, 
   3.707466708976355*^9}, {3.707466910154292*^9, 3.707466981494775*^9}, {
   3.7074670156034517`*^9, 3.7074672247093277`*^9}, {3.707467279492023*^9, 
   3.7074675081031017`*^9}, {3.707467595129915*^9, 3.707467604278646*^9}, {
   3.707468477740547*^9, 3.707468493213964*^9}, {3.707468557750139*^9, 
   3.707468575977522*^9}, {3.707470475598137*^9, 3.7074704853574677`*^9}, {
   3.707476041163506*^9, 3.707476049814184*^9}, {3.707476391143218*^9, 
   3.70747639643893*^9}, {3.707476602096303*^9, 3.707476651823597*^9}, {
   3.707476682783341*^9, 3.707476757665762*^9}, {3.707478420073018*^9, 
   3.707478463645144*^9}, {3.707486539022417*^9, 3.70748661429123*^9}, 
   3.707486775941036*^9, {3.7074875838619137`*^9, 3.707487591861162*^9}, {
   3.707487667210335*^9, 3.707487718670602*^9}, {3.7074878087582006`*^9, 
   3.707487812089446*^9}, {3.7074879380149603`*^9, 3.707487970950479*^9}, {
   3.707488017396579*^9, 3.707488099060906*^9}, {3.707488266158719*^9, 
   3.7074885573485193`*^9}, {3.707488660228406*^9, 3.707488669475787*^9}, 
   3.7074891194237013`*^9, {3.707489370473494*^9, 3.707489372911282*^9}, {
   3.707489647573434*^9, 3.707489716012679*^9}, {3.707490311310388*^9, 
   3.707490327660391*^9}, {3.707490359420886*^9, 3.707490372289599*^9}, {
   3.707511216575712*^9, 3.7075112182830553`*^9}, 3.707570266346871*^9, {
   3.707642161450411*^9, 3.707642215460285*^9}, {3.707642370214161*^9, 
   3.707642761628043*^9}, {3.707642856067759*^9, 3.707642917251071*^9}, {
   3.707642956304166*^9, 3.7076429848589487`*^9}, {3.707643078388803*^9, 
   3.707643090632638*^9}, {3.70764331821725*^9, 3.70764342558454*^9}, {
   3.707643589198243*^9, 3.707643660051661*^9}, {3.70764369102246*^9, 
   3.707643707285783*^9}, {3.707643896296874*^9, 3.707643930695549*^9}, {
   3.7076439747699842`*^9, 3.707644130245578*^9}, {3.707645833693185*^9, 
   3.707645868622047*^9}, {3.707645950098467*^9, 3.70764598212761*^9}, {
   3.707646017567643*^9, 3.7076461306290607`*^9}, {3.707646351068678*^9, 
   3.707646374687195*^9}, {3.707685900653378*^9, 3.7076859214101877`*^9}, {
   3.7076859614023647`*^9, 3.707686422047024*^9}, {3.707686478648559*^9, 
   3.7076864942930107`*^9}, {3.707686565045053*^9, 3.707686784192108*^9}, {
   3.707686821406353*^9, 3.707686938504908*^9}, {3.7076869818265467`*^9, 
   3.707687086583536*^9}, {3.7076872172637253`*^9, 3.707687409127881*^9}, {
   3.707687442770355*^9, 3.707687492028213*^9}, {3.7076875675929413`*^9, 
   3.707687592716001*^9}, {3.707731156388204*^9, 3.70773128817428*^9}, {
   3.7077313245296803`*^9, 3.707731379575891*^9}, {3.707731467052549*^9, 
   3.7077314762013693`*^9}, {3.70773151895665*^9, 3.707731641027136*^9}, {
   3.7077317099194813`*^9, 3.707731748373632*^9}, {3.7077317945786877`*^9, 
   3.707731867090953*^9}, {3.707746117390786*^9, 3.707746120188734*^9}, {
   3.7077489808033657`*^9, 3.707748987679071*^9}, {3.70774902029027*^9, 
   3.707749139912745*^9}, {3.7077491715101233`*^9, 3.707749447840144*^9}, {
   3.7077495006722507`*^9, 3.707749501036873*^9}, {3.7077495758978577`*^9, 
   3.7077496626498327`*^9}, {3.707754799282756*^9, 3.707754954684609*^9}, {
   3.7077550206773167`*^9, 3.707755113473362*^9}, {3.707755171806509*^9, 
   3.707755227507394*^9}, {3.7077552614232492`*^9, 3.70775547966908*^9}, {
   3.7077555261415577`*^9, 3.70775552721349*^9}, {3.707755613988282*^9, 
   3.707755642244156*^9}, {3.707755682315784*^9, 3.707755686421097*^9}, {
   3.707755729855132*^9, 3.7077557551982*^9}, {3.707755952717013*^9, 
   3.707756023368178*^9}, {3.7077560711772413`*^9, 3.7077561467473373`*^9}, {
   3.7077562134516706`*^9, 3.707756233543694*^9}, {3.707756277347609*^9, 
   3.707756345510951*^9}, {3.707756393765645*^9, 3.707756466725881*^9}, {
   3.707756498793309*^9, 3.707756637599202*^9}, {3.7077566938824577`*^9, 
   3.7077567437299433`*^9}, {3.707756775022169*^9, 3.7077567908442593`*^9}, {
   3.7077569318683043`*^9, 3.707757151712201*^9}, {3.707762829032774*^9, 
   3.7077631732321243`*^9}, {3.707763576640222*^9, 3.7077640220640097`*^9}, {
   3.707764590397367*^9, 3.7077645997586937`*^9}, {3.707764631057527*^9, 
   3.707764903004483*^9}, {3.707764940638088*^9, 3.7077649690563583`*^9}, {
   3.707765190841724*^9, 3.707765203913706*^9}, {3.707765273391189*^9, 
   3.707765323458613*^9}, {3.707765384294937*^9, 3.707765392237335*^9}, {
   3.707765571091777*^9, 3.7077655790037403`*^9}, {3.7077656117617683`*^9, 
   3.707765676329445*^9}, {3.707765797688862*^9, 3.707765855096603*^9}, {
   3.707765888385078*^9, 3.7077659255306873`*^9}, {3.707765965150928*^9, 
   3.7077659817240477`*^9}, {3.707766206520013*^9, 3.707766269245894*^9}, {
   3.707767088274926*^9, 3.7077671415758743`*^9}, {3.707767191458284*^9, 
   3.707767305730937*^9}, {3.707816689159813*^9, 3.707816689247719*^9}, {
   3.707816745173901*^9, 3.707816772767774*^9}, {3.7078168871800413`*^9, 
   3.707816924116481*^9}, {3.707817044825039*^9, 3.7078170478311853`*^9}, 
   3.707817180442811*^9, {3.707817225978627*^9, 3.707817238286964*^9}, {
   3.707817400210032*^9, 3.7078174504373007`*^9}, {3.707817638929072*^9, 
   3.707817649733966*^9}, {3.707817764363213*^9, 3.707817772665859*^9}, {
   3.707817814110552*^9, 3.707817817412484*^9}, {3.707817910603683*^9, 
   3.707818032976013*^9}, {3.707818073579342*^9, 3.707818210078928*^9}, {
   3.707824839353077*^9, 3.707824997989532*^9}, {3.707825091448594*^9, 
   3.707825157190969*^9}, {3.7078251886086893`*^9, 3.707825210006432*^9}, {
   3.707825240280614*^9, 3.707825386224126*^9}, {3.707825428013361*^9, 
   3.707825451739707*^9}, {3.7078255156905823`*^9, 3.7078255406645107`*^9}, {
   3.707825643007696*^9, 3.707825707470086*^9}, {3.7078257519181843`*^9, 
   3.707825771446231*^9}, {3.7078265764794407`*^9, 3.707826643019902*^9}, {
   3.707826689033477*^9, 3.707826690182929*^9}, {3.7078267209860573`*^9, 
   3.7078267757027817`*^9}, {3.7078268139826097`*^9, 
   3.7078269185300627`*^9}, {3.7078269498406477`*^9, 
   3.7078270272030573`*^9}, {3.707827115073515*^9, 3.707827262658545*^9}, {
   3.707827617020878*^9, 3.707827715512866*^9}, {3.7078278013209867`*^9, 
   3.707827811723303*^9}, {3.707827880413619*^9, 3.707827920270252*^9}, {
   3.707827954483214*^9, 3.707827956929736*^9}, 3.7078281572121363`*^9, {
   3.707828267194107*^9, 3.707828294399688*^9}, 3.707828346972897*^9, {
   3.7078283787435083`*^9, 3.707828439545622*^9}, {3.707828548530267*^9, 
   3.707829034995873*^9}, {3.707829073418253*^9, 3.707829189994691*^9}, {
   3.7078293300769033`*^9, 3.707829332568348*^9}, {3.7078293744249077`*^9, 
   3.7078293840083733`*^9}, {3.707840367950945*^9, 3.7078404111050253`*^9}, 
   3.707840641436467*^9, {3.7078407071034937`*^9, 3.707840749368475*^9}, 
   3.707840839817465*^9, {3.707840940579296*^9, 3.707840950748074*^9}, {
   3.707841022200585*^9, 3.707841040439636*^9}, {3.707841160926437*^9, 
   3.7078412004751453`*^9}, {3.707841785002364*^9, 3.707841824428783*^9}, {
   3.707841891358186*^9, 3.7078419172262993`*^9}, {3.707841961289918*^9, 
   3.7078419886636353`*^9}, {3.70784202101365*^9, 3.707842042496717*^9}, {
   3.707842174562751*^9, 3.707842215270813*^9}, {3.707842334235527*^9, 
   3.7078424622877073`*^9}, 3.707842573891033*^9, {3.7078426695484037`*^9, 
   3.707842770489746*^9}, {3.70784291147213*^9, 3.707842984325843*^9}, {
   3.707843018462884*^9, 3.70784306653972*^9}, {3.7078431579899282`*^9, 
   3.707843211938644*^9}, {3.707843280901106*^9, 3.707843300545863*^9}, {
   3.707843341206192*^9, 3.707843397450325*^9}, {3.707843433884042*^9, 
   3.70784350007137*^9}, 3.707996670163734*^9, {3.7081650500945263`*^9, 
   3.708165104623703*^9}, {3.708165144135312*^9, 3.708165172427712*^9}, {
   3.708165217453124*^9, 3.7081654117728987`*^9}, {3.708167897827117*^9, 
   3.708167971471067*^9}, {3.7081680118814163`*^9, 3.7081681258596563`*^9}, {
   3.708178624083044*^9, 3.708178637945835*^9}, {3.708178774689872*^9, 
   3.708178807314986*^9}, {3.708178988916171*^9, 3.708179043178134*^9}, {
   3.708179091716281*^9, 3.7081793162083607`*^9}, {3.708179351826449*^9, 
   3.708179370606567*^9}, {3.708179793415613*^9, 3.708179793997883*^9}, {
   3.70817990782257*^9, 3.7081800536022243`*^9}, {3.70818025018349*^9, 
   3.708180283315296*^9}, 3.708415750027658*^9, 3.708419459171294*^9, {
   3.708420321746211*^9, 3.708420416813195*^9}, {3.70842424985266*^9, 
   3.7084243498005857`*^9}, 3.708424941086996*^9, {3.7084249865741243`*^9, 
   3.7084250430659037`*^9}, {3.708426710798283*^9, 3.708426767938727*^9}, {
   3.708426842590966*^9, 3.7084269116394167`*^9}, {3.7084269547456512`*^9, 
   3.708426980038146*^9}, {3.708427016242185*^9, 3.708427038830645*^9}, {
   3.708427373465603*^9, 3.708427373851033*^9}, {3.708427749053607*^9, 
   3.708427766808055*^9}, 3.708427894446171*^9, {3.70842809727964*^9, 
   3.7084280976002007`*^9}, {3.708428159412732*^9, 3.708428159748283*^9}, {
   3.708428291910861*^9, 3.7084283347647123`*^9}, {3.7084284121304417`*^9, 
   3.7084285204217157`*^9}, {3.708428603926456*^9, 3.708428608188978*^9}, {
   3.708428661025879*^9, 3.708428711907089*^9}, {3.708428754659954*^9, 
   3.7084288157823763`*^9}, {3.70842884848182*^9, 3.708428883185824*^9}, {
   3.708428964809376*^9, 3.7084289670639267`*^9}, {3.708429119072997*^9, 
   3.708429122637577*^9}, {3.7084292916794987`*^9, 3.708429293965604*^9}, {
   3.70842933413612*^9, 3.7084293378272867`*^9}, {3.708429384965885*^9, 
   3.7084293881741867`*^9}, {3.708429439260071*^9, 3.708429443244742*^9}, {
   3.708429572763699*^9, 3.708429608664706*^9}, {3.708429681400557*^9, 
   3.708429765520976*^9}, {3.708429883102441*^9, 3.708429894594689*^9}, 
   3.708429950697711*^9, 3.7084299882052383`*^9, {3.708430122512785*^9, 
   3.708430213546171*^9}, {3.708430258952796*^9, 3.70843028690198*^9}, {
   3.708430362100429*^9, 3.708430383573185*^9}, 3.708430415620063*^9, {
   3.708430494205324*^9, 3.7084305075462027`*^9}, {3.708430620968648*^9, 
   3.7084306651911707`*^9}, {3.7084310090639877`*^9, 3.708431009734665*^9}, {
   3.708431115512066*^9, 3.7084311469809303`*^9}, {3.7084315853226433`*^9, 
   3.708431596690236*^9}, {3.7084318688156567`*^9, 3.708431879475177*^9}, {
   3.7084319126575623`*^9, 3.708431963417609*^9}, {3.708450240108659*^9, 
   3.708450283196865*^9}, {3.708450369083662*^9, 3.708450378823246*^9}, {
   3.708450743077159*^9, 3.708450745092462*^9}, {3.708450891250049*^9, 
   3.708450934436688*^9}, {3.708451208658998*^9, 3.708451242032246*^9}, 
   3.708451428407301*^9, {3.7084516318962193`*^9, 3.708451644075164*^9}, {
   3.708451795870286*^9, 3.7084518001488667`*^9}, {3.708452046810095*^9, 
   3.708452051932887*^9}, {3.7084521499693604`*^9, 3.708452270201727*^9}, {
   3.708452713586231*^9, 3.7084527438816767`*^9}, {3.7084528205427227`*^9, 
   3.708452848964016*^9}, {3.70845290168423*^9, 3.708452923356365*^9}, {
   3.7084530786483793`*^9, 3.708453079507942*^9}, {3.708453208071994*^9, 
   3.708453234178458*^9}, {3.708453583933659*^9, 3.708453584231702*^9}, {
   3.7084536353408213`*^9, 3.708453672937056*^9}, {3.7084537243234797`*^9, 
   3.708453803447029*^9}, {3.708454070273365*^9, 3.708454147939374*^9}, {
   3.708454203469273*^9, 3.7084542691149063`*^9}, {3.7084543185715218`*^9, 
   3.708454340556716*^9}, {3.708454372567643*^9, 3.708454376755546*^9}, {
   3.708454485007372*^9, 3.708454489025166*^9}, {3.708454563713125*^9, 
   3.708454566631056*^9}, {3.708454606495811*^9, 3.708454608886326*^9}, {
   3.708454695598061*^9, 3.708454828755905*^9}, {3.708456243710096*^9, 
   3.708456252253283*^9}, {3.708456302430382*^9, 3.7084563804090853`*^9}, {
   3.708456661744403*^9, 3.708456672382689*^9}, {3.7084567256478357`*^9, 
   3.708456757992591*^9}, {3.708456917301058*^9, 3.708456933795828*^9}, {
   3.7084583637035027`*^9, 3.708458369842346*^9}, {3.70851596754331*^9, 
   3.708515968336989*^9}, {3.708612271706621*^9, 3.7086123073173656`*^9}, {
   3.708612342221562*^9, 3.7086123432494173`*^9}, {3.708612551048018*^9, 
   3.708612564508874*^9}, {3.709374353213427*^9, 3.709374412787476*^9}, {
   3.709378373366611*^9, 3.7093783894475594`*^9}, {3.709378797792282*^9, 
   3.709378889996031*^9}, {3.709378977733748*^9, 3.709378992675908*^9}, {
   3.709379027169558*^9, 3.709379038369907*^9}, {3.70937907885611*^9, 
   3.709379134779538*^9}, {3.709379166015986*^9, 3.709379169803997*^9}, 
   3.7093792240861053`*^9, {3.7093794527343893`*^9, 3.709379501149534*^9}, {
   3.7093797711495247`*^9, 3.709379858267644*^9}, {3.7093799073451033`*^9, 
   3.709379929539452*^9}, {3.709380028694016*^9, 3.709380100339608*^9}, {
   3.7093801573071127`*^9, 3.7093801891189127`*^9}, {3.709380514696723*^9, 
   3.7093805758456707`*^9}, {3.709380692417327*^9, 3.7093808314205923`*^9}, {
   3.709380884789857*^9, 3.709380890331114*^9}, {3.7093822589558897`*^9, 
   3.709382412750165*^9}, {3.709382491298868*^9, 3.709382523884152*^9}, {
   3.709382559649075*^9, 3.709382594662499*^9}, {3.709385942420411*^9, 
   3.7093859807755527`*^9}, {3.70938614698178*^9, 3.709386157331389*^9}, {
   3.7093862340809107`*^9, 3.709386305663776*^9}, {3.7093864905687103`*^9, 
   3.709386519888036*^9}, {3.709386665857092*^9, 3.709386730169735*^9}, {
   3.709386852172566*^9, 3.709386966099571*^9}, {3.709386997593944*^9, 
   3.7093870117668133`*^9}, {3.709387270482471*^9, 3.7093874731324863`*^9}, {
   3.7093875064383307`*^9, 3.709387564613077*^9}, {3.7093876042195873`*^9, 
   3.709387652513186*^9}, {3.709387775046824*^9, 3.709387806870717*^9}, {
   3.7093952173627443`*^9, 3.709395268740621*^9}, {3.709396645464705*^9, 
   3.709396660186466*^9}, {3.709397912364406*^9, 3.709397931706113*^9}, {
   3.709398137398675*^9, 3.7093981487361917`*^9}, {3.709445951809292*^9, 
   3.7094459670561743`*^9}, {3.709446571285437*^9, 3.7094466206344*^9}, 
   3.709446689415736*^9, {3.70944746666543*^9, 3.709447466831038*^9}, {
   3.709448761402812*^9, 3.709448906124919*^9}, {3.7094489426721907`*^9, 
   3.7094490166586637`*^9}, {3.709449085412508*^9, 3.7094491620909777`*^9}, {
   3.7094515742865067`*^9, 3.7094515800232887`*^9}, {3.7096265732123413`*^9, 
   3.709626613174507*^9}, {3.709628170697987*^9, 3.709628538787551*^9}, {
   3.709629250703966*^9, 3.709629256940572*^9}, {3.70962939072237*^9, 
   3.7096294299781303`*^9}, {3.709629481643263*^9, 3.709629520190298*^9}, {
   3.709629556949479*^9, 3.7096296520025787`*^9}, {3.709629682010605*^9, 
   3.709629830236451*^9}, {3.7096316543887243`*^9, 3.709631995637144*^9}, {
   3.709632066792736*^9, 3.709632200707944*^9}, {3.709635770614036*^9, 
   3.709635815760744*^9}, {3.709636250292945*^9, 3.709636334722094*^9}, {
   3.7096364828201*^9, 3.709636497190528*^9}, 3.709636700435349*^9, {
   3.7096368018192368`*^9, 3.7096368051486187`*^9}, {3.709637752858255*^9, 
   3.70963775887355*^9}, 3.709638054758713*^9, {3.709638209231134*^9, 
   3.709638242045858*^9}, {3.709638350256526*^9, 3.7096383684208107`*^9}, {
   3.709638458405209*^9, 3.709638459500519*^9}, {3.709638590032353*^9, 
   3.709638619184341*^9}, {3.709641151061234*^9, 3.7096411512065763`*^9}, {
   3.70987830931568*^9, 3.709878383459516*^9}, {3.7098785010647707`*^9, 
   3.709878507672546*^9}, {3.709878587492625*^9, 3.7098786229709272`*^9}, {
   3.709878876749371*^9, 3.709878879960388*^9}, {3.7098789149404984`*^9, 
   3.709878917581251*^9}, {3.709879112742831*^9, 3.709879120625655*^9}, {
   3.709879303616664*^9, 3.7098793837922897`*^9}, {3.709879512493908*^9, 
   3.7098795125920486`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"Temp", "=", "0.025"}], ";", 
   RowBox[{"(*", 
    RowBox[{"300", "K"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{"beta", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"1", "/", "Temp"}], "\[IndentingNewLine]", "Erbeta"}], "=", 
     RowBox[{
      RowBox[{"10", "^", "6"}], "*", 
      RowBox[{"ev", "/", "cm"}], " ", "*", " ", "5", "nm", "*", 
      RowBox[{"40", "/", "ev"}]}]}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"nm", "=", 
    RowBox[{
     RowBox[{"10", "^", 
      RowBox[{"-", "9"}]}], "met"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"cm", "=", 
    RowBox[{
     RowBox[{"10", "^", 
      RowBox[{"-", "2"}]}], "met"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"Erbeta", "/", "beta"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.707467735304195*^9, 3.707467767029307*^9}, {
  3.707467828089313*^9, 3.70746788441724*^9}, {3.707467932167493*^9, 
  3.707468059134137*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7093870658131247`*^9, 3.709387239608391*^9}}]
},
WindowSize->{1137, 795},
WindowMargins->{{3, Automatic}, {Automatic, 0}},
PrintingCopies->1,
PrintingPageRange->{1, Automatic},
Magnification:>1.5 Inherited,
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 340, 9, 358, "Input"],
Cell[923, 33, 7419, 108, 43, "Output"]
}, Open  ]],
Cell[8357, 144, 14439, 357, 1619, "Input"],
Cell[22799, 503, 77796, 1856, 8133, "Input"],
Cell[100598, 2361, 28779, 660, 3305, "Input"],
Cell[129380, 3023, 44691, 1057, 3967, "Input"],
Cell[174074, 4082, 10624, 266, 1244, "Input"],
Cell[184701, 4350, 3458, 112, 445, "Input"],
Cell[188162, 4464, 10717, 243, 1069, "Input"],
Cell[198882, 4709, 61803, 1544, 8085, "Input"],
Cell[260688, 6255, 7601, 222, 1464, "Input"],
Cell[268292, 6479, 219190, 4738, 22673, "Input"],
Cell[487485, 11219, 946, 25, 169, "Input"],
Cell[488434, 11246, 94, 1, 43, "Input"]
}
]
*)

