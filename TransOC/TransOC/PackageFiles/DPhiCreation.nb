(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     38841,        941]
NotebookOptionsPosition[     38524,        925]
NotebookOutlinePosition[     38913,        942]
CellTagsIndexPosition[     38870,        939]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"mapHtApairs", ":", " ", 
       RowBox[{
       "for", " ", "Apairs", " ", "that", " ", "can", " ", "make", " ", 
        "D"}]}], " ", "&"}], " ", 
     RowBox[{"Phi", ":", " ", 
      RowBox[{
      "start", " ", "with", " ", "final", " ", "basis", " ", "combination", 
       " ", "and", " ", "add", " ", "two", " ", "sites", " ", "at", " ", 
       "appropriate", " ", "positions", " ", "in", " ", "the", " ", "list", 
       " ", "of", " ", "active", " ", "sites", " ", "with", " ", "one", " ", 
       "being", " ", "up", " ", "and", " ", "other", " ", "down"}]}]}], ",", 
    " ", 
    RowBox[{
    "and", " ", "calc", " ", "index", " ", "for", " ", "initial", " ", 
     "state"}]}], " ", "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairsc", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "x2", ",", "listi1", ",", "listi2", 
         ",", "tab1", ",", "tab2", ",", "set1", ",", "set2", ",", "listf1", 
         ",", "listf2", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tab2", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", 
              RowBox[{"k", "-", "1"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"up", "/", "down"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf1", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", "n1", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"Adding", " ", 
                RowBox[{"down", "/", "up"}], "  ", "at", " ", 
                RowBox[{"n1", "/", "n2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"listf2", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", "n2", "}"}]}], "]"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"indices", " ", "for", " ", 
                RowBox[{"(", 
                 RowBox[{"N", ",", "k"}], ")"}], " ", "case"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf1", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"x2", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf2", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab2", ",", "x2"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"tab1", ",", "tab2"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairsclh", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "listi1", ",", "tab1", ",", "set1", 
         ",", "listf1", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", 
              RowBox[{"k", "-", "2"}]}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"Adding", " ", "up"}], ",", 
                RowBox[{"up", "  ", "at", " ", "n1"}], ",", "n2"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"listf1", "=", 
               RowBox[{"Sort", "[", 
                RowBox[{"Join", "[", 
                 RowBox[{"set12", ",", 
                  RowBox[{"{", 
                   RowBox[{"n1", ",", "n2"}], "}"}]}], "]"}], "]"}]}], ";", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"both", " ", 
                 RowBox[{"up", ":", " ", "tlh"}]}], ",", " ", 
                RowBox[{
                 RowBox[{"k", "--"}], ">", " ", 
                 RowBox[{"k", "-", "2"}]}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf1", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tab1"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtApairschl", "[", 
      RowBox[{"N_", ",", "k_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "n1", ",", "n2", ",", "x1", ",", "listi1", ",", "tab1", ",", "set1", 
         ",", "listf1", ",", "set11", ",", "set12"}], "}"}], 
       "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"n1", ",", "n2"}], "}"}], "=", "sapos"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"tab1", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"N", "-", "2"}], ",", 
            RowBox[{"k", "-", "1"}]}], ")"}], ",", " ", 
          RowBox[{"add", " ", "desired", " ", 
           RowBox[{"up", "/", "dn"}], " ", "or", " ", 
           RowBox[{"dn", "/", "up"}], " ", "to", " ", "make", " ", 
           RowBox[{"(", 
            RowBox[{"N", ",", "k"}], ")"}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{"exclude", " ", "k"}], "=", 
           RowBox[{"0", " ", "case"}]}], " ", "*)"}],
         FontSize->12], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"listi1", "=", 
            RowBox[{"comb", "[", 
             RowBox[{
              RowBox[{"N", "-", "2"}], ",", "k"}], "]"}]}], ";", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"set1", "=", 
               RowBox[{"listi1", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "add", " ", "an", " ", "up", " ", "site", " ", "at", " ", 
                 "n1", " ", "position", "\[IndentingNewLine]", "and", " ", 
                 "a", " ", "down", " ", "at", " ", "n2", " ", "position"}], 
                ";", " ", 
                RowBox[{
                 RowBox[{"shift", " ", "n1"}], "+", " ", 
                 RowBox[{"and", " ", "n2"}], "+", " ", 
                 RowBox[{
                 "labels", " ", "by", " ", "1", " ", "or", " ", "2", " ", 
                  "as", " ", "they", " ", "should", " ", "be"}]}]}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"shift", " ", "by"}], " ", "+", 
                RowBox[{
                "1", " ", "twice", " ", "for", " ", "second", " ", "case", 
                 " ", "means"}], " ", "+", 
                RowBox[{"2", " ", "total", " ", "as", " ", "desired"}]}], " ",
                "*)"}], "\[IndentingNewLine]", 
              RowBox[{"set11", "=", 
               RowBox[{"set1", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n1"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"set12", "=", 
               RowBox[{"set11", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"q_Integer", "/;", 
                   RowBox[{"q", "\[GreaterEqual]", " ", "n2"}]}], "\[Rule]", 
                  RowBox[{"q", "+", "1"}]}], "}"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"dn", ",", 
                RowBox[{"dn", " ", "at", " ", "n1"}], ",", "n2"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"x1", "=", 
               RowBox[{
                RowBox[{"c", "[", 
                 RowBox[{"N", ",", "k"}], "]"}], "-", 
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"set12", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "p"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"tab1", ",", "x1"}], "]"}], ";"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi1", "]"}]}], "}"}]}], "]"}], 
           ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "tab1"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairsc", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "Htb", ",", 
         "coora", ",", "coorb", ",", "ntot1", ",", "tab1", ",", "tab2", ",", 
         "ind1", ",", "ind01", ",", "ind02", ",", "t1", ",", "t2", ",", 
         "Htsph", ",", "Htspl", ",", "m1", ",", "m2", ",", "m3"}], "}"}], ",",
        "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->18], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "1"}]}], "]"}]}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"m3", "=", 
          RowBox[{">", " ", 
           RowBox[{
           "a", " ", "dn", " ", "is", " ", "also", " ", "needed", " ", "so", 
            " ", "all", " ", "up", " ", "excludeed", " ", "in", " ", "the", 
            " ", "loop", " ", "below"}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"k", " ", "loop", " ", "up", " ", "to", " ", "m3"}], "=", 
            
            RowBox[{
             RowBox[{
              RowBox[{"Min", "[", 
               RowBox[{"m", ",", 
                RowBox[{"N", "-", "1"}]}], "]"}], " ", "so", " ", "that", " ",
               "\[IndentingNewLine]", "there", " ", "is", " ", "always", " ", 
              "a", " ", "down", " ", "spin", " ", "available", " ", "for", 
              " ", "non"}], "-", 
             RowBox[{"empty", " ", "map"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"starts", " ", "from", " ", "1"}]}], ",", " ", 
          RowBox[{
          "so", " ", "for", " ", "an", " ", "up", " ", "spin", " ", 
           "available"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapHtApairsc", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr0", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind1", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr1", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "+", 
               RowBox[{"Table", "[", 
                RowBox[{"i", ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", 
                   RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}]}], "}"}]}], "]"}]}], 
              "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab1", "]"}], ">", "0"}], ",", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "1", ",", "m3"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", " ", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairsclh", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "coora", ",", 
         "ntot1", ",", "tab", ",", "ind1", ",", "ind01", ",", "Htsplh", ",", 
         "m1", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->12], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "2"}], ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab", "=", 
            RowBox[{"mapHtApairsclh", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind01", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr0", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab"}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "-", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", 
                    RowBox[{"k", "-", "2"}]}], "]"}]}], "}"}]}], "]"}]}], 
                 "}"}], "//", "Transpose"}]}], ";", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "2", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "Htsplh"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtApairschl", "[", 
      RowBox[{"N_", ",", "m_", ",", "sapos_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr0", ",", "pntr1", ",", "ntot0", ",", "Hta", ",", "coora", ",", 
         "ntot1", ",", "tab", ",", "ind1", ",", "ind01", ",", "Htsphl", ",", 
         "m1", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       StyleBox[
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"v", " ", "v", " ", 
           RowBox[{"importnat", ":", " ", 
            RowBox[{"in", "  ", "sapos"}]}]}], ",", " ", 
          RowBox[{"n2", ">", "n1"}]}], " ", "*)"}],
        FontSize->12], "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", 
           RowBox[{"N", "-", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr0", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr1", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "-", "2"}], ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot0", "=", 
         RowBox[{"pntr0", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot1", "=", 
         RowBox[{"pntr1", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"tab", "=", 
            RowBox[{"mapHtApairschl", "[", 
             RowBox[{"N", ",", "k", ",", "sapos"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind01", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr0", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab"}], 
                 "}"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", "2"}], ",", "k"}], "]"}]}], "}"}]}], 
                   "]"}]}], "}"}], "//", "Transpose"}]}], ";", 
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind1", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m3"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot0", ",", "ntot1"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "Htsphl"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.712820980888237*^9, 3.712821016790818*^9}, 
   3.712836801739757*^9, 3.712837183043713*^9, 3.7128372160018806`*^9}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{808, 706},
WindowMargins->{{Automatic, 2}, {Automatic, 0}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 37962, 903, 2998, "Input",
 InitializationCell->True]
}
]
*)

