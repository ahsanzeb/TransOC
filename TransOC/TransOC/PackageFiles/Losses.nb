(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     11062,        300]
NotebookOptionsPosition[     10745,        284]
NotebookOutlinePosition[     11135,        301]
CellTagsIndexPosition[     11092,        298]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"MapGamma", "[", 
     RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "listi", ",", "tab1", ",", "set1", ",", "setf"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab1", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"listi", "=", 
        RowBox[{"comb", "[", 
         RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"set1", "=", 
           RowBox[{"listi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"set1", ",", "n"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"setf", "=", 
              RowBox[{"Complement", "[", 
               RowBox[{"set1", ",", 
                RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"x", "=", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", 
                 RowBox[{"k", "-", "1"}]}], "]"}], "-", 
               RowBox[{"Sum", "[", 
                RowBox[{
                 RowBox[{"c", "[", 
                  RowBox[{
                   RowBox[{"N", "-", 
                    RowBox[{"setf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                   RowBox[{"k", "-", "1", "-", "p"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"p", ",", "0", ",", 
                   RowBox[{"k", "-", "2"}]}], "}"}]}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{"tab1", ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "x"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "tab1"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"HtGamma", "[", 
     RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "pntr1", ",", "Hta", ",", "ind1", ",", "ind2", ",", "coora", ",", 
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "inds", ",", 
        "\[IndentingNewLine]", "m1", ",", "m2", ",", "pntr2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"m1", "=", 
        RowBox[{"Min", "[", 
         RowBox[{"m", ",", "N"}], "]"}]}], ";", 
       RowBox[{"m2", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "just", " ", "to", " ", "be", " ", "consistent", " ", "with", " ", 
          "pther", " ", "functions", " ", "styles"}], ",", " ", 
         RowBox[{"insert", " ", "0", " ", "at", " ", "1"}], ",", " ", 
         RowBox[{
         "otherwise", " ", "we", " ", "dont", " ", "need", " ", "it", " ", 
          "here", " ", "if", " ", "we", " ", "modify", " ", "the", " ", 
          "lines", " ", "appropriately"}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"pntr1", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"pntr2", "=", 
        RowBox[{"Insert", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{"N", ",", "j"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot1", "=", 
        RowBox[{"pntr1", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ntot2", "=", 
        RowBox[{"pntr2", "[", 
         RowBox[{"[", 
          RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"maps", " ", "all", " ", "sectors", " ", 
          RowBox[{"(", 
           RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Hta", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        StyleBox[
         RowBox[{"(*", " ", 
          RowBox[{"k", ">", 
           RowBox[{"0", " ", "only"}]}], " ", "*)"}],
         FontSize->14], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"inds", "=", 
           RowBox[{"MapGamma", "[", 
            RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"ind1", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", 
                RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"ind2", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"pntr1", "[", 
               RowBox[{"[", "k", "]"}], "]"}], "+", 
              RowBox[{"inds", "[", 
               RowBox[{"[", 
                RowBox[{";;", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
            "Transpose"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"coora", "=", 
           RowBox[{"Join", "[", 
            RowBox[{"ind1", ",", "ind2", ",", "2"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "m1"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Htsp", "=", 
        RowBox[{"SparseArray", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"HtKappa", "[", 
    RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Hta", ",", "ntot1", ",", "Htsp", ",", "ntot2", ",", "nsec1", ",", "m1",
        ",", "m2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{"maps", " ", "all", " ", "sectors", " ", 
        RowBox[{"(", 
         RowBox[{"up", " ", "spins"}], ")"}], " ", "at", " ", "once"}], ";", 
       " ", "\[IndentingNewLine]", 
       RowBox[{
       "just", " ", "remove", " ", "the", " ", "max", " ", "photon", " ", 
        "sector", " ", "and", " ", "shift", " ", "all", " ", "the", " ", 
        "indices"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"m1", "=", 
       RowBox[{"Min", "[", 
        RowBox[{"m", ",", "N"}], "]"}]}], ";", 
      RowBox[{"m2", "=", 
       RowBox[{"Min", "[", 
        RowBox[{
         RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ntot1", "=", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"N", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", "m1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ntot2", "=", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"c", "[", 
          RowBox[{"N", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "0", ",", "m2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "map", " ", "coupled", " ", "states", " ", "up", " ", "to", " ", "an", 
        " ", "upper", " ", "sector", " ", "det", " ", "by", " ", "m2"}], " ", 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Hta", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"i", ",", "i"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Htsp", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"Hta", "\[Rule]", " ", "1"}], ",", 
         RowBox[{"{", 
          RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "Htsp"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7128660595473423`*^9, 3.7128660930810013`*^9}, 
   3.712866123985824*^9}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{808, 706},
WindowMargins->{{Automatic, -3}, {Automatic, 0}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 10183, 262, 845, "Input",
 InitializationCell->True]
}
]
*)

