(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     26037,        650]
NotebookOptionsPosition[     25718,        634]
NotebookOutlinePosition[     26109,        651]
CellTagsIndexPosition[     26066,        648]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"D", "|", 
      RowBox[{"Phi", " ", "+", " ", "A"}]}], " ", "\[Rule]", " ", 
     RowBox[{
      RowBox[{"D", "'"}], "|", 
      RowBox[{
       RowBox[{"Phi", "'"}], " ", "+", 
       RowBox[{"A", "'"}]}]}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
    "active", " ", "site", " ", "number", " ", "n", " ", "interacting", " ", 
     "with", " ", 
     RowBox[{"D", "/", "Phi"}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"mapHtDAc", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "taba", ",", "tabb", ",", "listi", ",", "tablh", ",", "tabhl", ",", 
         "xhl", ",", "xlh"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"taba", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabb", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\< DiagHt4DA --------------\>\"", "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\< DiagHt4DA,i=\>\"", ",", "i"}], "]"}], ";"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{
                  RowBox[{"listi", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "n"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "up"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"taba", ",", "i"}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "dn"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tabb", ",", "i"}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";"}],
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tabb", "=", 
            RowBox[{"{", "1", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"taba", ",", "tabb"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapHtDAcc", "[", 
      RowBox[{"N_", ",", "k_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "taba", ",", "tabb", ",", "listi", ",", "tablh", ",", "tabhl", ",", 
         "xhl", ",", "xlh", ",", "listf", ",", "listiall"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"listiall", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\< DiagHt4DA --------------\>\"", "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"k", ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\< DiagHt4DA,i,n=\>\"", ",", "i", ",", "\"\< \>\"", ",", 
                "n"}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"listi", "=", 
               RowBox[{"listiall", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"MemberQ", "[", 
                 RowBox[{"listi", ",", "n"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "up"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"tlh", ":", " ", 
                  RowBox[{
                   RowBox[{"k", "--"}], ">", " ", 
                   RowBox[{"k", "-", "1"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"listf", "=", 
                  RowBox[{"Complement", "[", 
                   RowBox[{"listi", ",", 
                    RowBox[{"{", "n", "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<yes: listf = \>\"", ",", "listf"}], "]"}], 
                   ";"}], "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{"drop", " ", "n", " ", "from", " ", "the", " ", 
                   RowBox[{"list", ":", " ", 
                    RowBox[{"k", "-", 
                    RowBox[{"1", " ", "up", " ", "spins", " ", "left"}]}]}]}],
                   "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"xlh", "=", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", 
                    RowBox[{"k", "-", "1"}]}], "]"}], "-", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "-", "1", "-", "p"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"p", ",", "0", ",", 
                    RowBox[{"k", "-", "2"}]}], "}"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tablh", ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "xlh"}], "}"}]}], "]"}], ";"}], 
                "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                RowBox[{"(*", 
                 RowBox[{
                  RowBox[{"Print", "[", 
                   RowBox[{
                   "\"\< no: ,k, listi = \>\"", ",", "k", ",", "\"\< \>\"", 
                    ",", "listi"}], "]"}], ";"}], "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"nth", " ", "spin", " ", "is", " ", "dn"}], " ", 
                 "*)"}], "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"thl", ":", " ", 
                  RowBox[{
                   RowBox[{"k", "--"}], ">", " ", 
                   RowBox[{"k", "+", "1"}]}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"listf", "=", 
                  RowBox[{"Sort", "[", 
                   RowBox[{"Join", "[", 
                    RowBox[{"listi", ",", 
                    RowBox[{"{", "n", "}"}]}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"xhl", "=", 
                  RowBox[{
                   RowBox[{"c", "[", 
                    RowBox[{"N", ",", 
                    RowBox[{"k", "+", "1"}]}], "]"}], "-", 
                   RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"c", "[", 
                    RowBox[{
                    RowBox[{"N", "-", 
                    RowBox[{"listf", "[", 
                    RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                    RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], 
                 ";", "\[IndentingNewLine]", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"tabhl", ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "xhl"}], "}"}]}], "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "listiall", "]"}]}], "}"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"tabhl", "=", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"1", ",", "n"}], "}"}], "}"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tablh", ",", "tabhl"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtDAc", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "m1", ",", "pntr", ",", "ntot", ",", "Hta", ",", "Htb", ",", "tab1", 
         ",", "tab2", ",", "ind01", ",", "ind02", ",", "coora", ",", "coorb", 
         ",", "Htsph", ",", "Htspl", ",", "\[IndentingNewLine]", "Htsplh", 
         ",", "Htsphl", ",", "coorlh", ",", "coorhl", ",", "Htlh", ",", 
         "Hthl", ",", "tablh", ",", "tabhl", ",", "pntr2", ",", "pntr3", ",", 
         "ntot2", ",", "ntot3", ",", "ind2i", ",", "ind2f", ",", "ind3i", ",",
          "ind3f", ",", "m2", ",", "m3"}], "}"}], ",", "\[IndentingNewLine]", 
       
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"m2", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
          RowBox[{"m3", "=", 
           RowBox[{"Min", "[", 
            RowBox[{
             RowBox[{"m", "+", "1"}], ",", "N"}], "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tab1", ",", "tab2"}], "}"}], "=", 
            RowBox[{"mapHtDAc", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"ind01", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab1"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ind02", "=", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"pntr", "[", 
                RowBox[{"[", 
                 RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tab2"}], "}"}], 
             "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"th", ",", 
             RowBox[{"tl", ":", " ", "diagonal"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab1", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"coora", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind01", ",", "ind01", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";"}]}], "]"}], ";",
            "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tab2", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"coorb", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind02", ",", "ind02", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], "]"}], 
           ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mkHtDAcc", "[", 
      RowBox[{"N_", ",", "m_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "m1", ",", "pntr", ",", "ntot", ",", "Hta", ",", "Htb", ",", "tab1", 
         ",", "tab2", ",", "coora", ",", "coorb", ",", "Htsph", ",", "Htspl", 
         ",", "\[IndentingNewLine]", "Htsplh", ",", "Htsphl", ",", "coorlh", 
         ",", "coorhl", ",", "Htlh", ",", "Hthl", ",", "tablh", ",", "tabhl", 
         ",", "pntr2", ",", "pntr3", ",", "ntot2", ",", "ntot3", ",", "ind2i",
          ",", "ind2f", ",", "ind3i", ",", "ind3f", ",", "m2", ",", "m3"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"m1", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"m", ",", "N"}], "]"}]}], ";", 
        RowBox[{"m2", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ",", "N"}], "]"}]}], ";", 
        RowBox[{"m3", "=", 
         RowBox[{"Min", "[", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ",", "N"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pntr", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot", "=", 
         RowBox[{"pntr", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr2", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"pntr2", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"pntr3", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{"N", ",", "j"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", "m3"}], "}"}]}], "]"}], ",", "0", 
           ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ntot3", "=", 
         RowBox[{"pntr3", "[", 
          RowBox[{"[", 
           RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hta", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htb", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Hthl", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"Htlh", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "\"\<xxxx \>\"", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "indices", " ", "list", " ", "of", " ", "initial", " ", "states"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"tablh", ",", "tabhl"}], "}"}], "=", 
            RowBox[{"mapHtDAcc", "[", 
             RowBox[{"N", ",", "k", ",", "n"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", "\"\<xxxx 1 \>\"", "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"cross", " ", "Homo"}], "-", 
               RowBox[{"Lumo", " ", "transitions"}]}], ";", " ", "tlh"}], ",",
              "thl"}], " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tablh", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind2i", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"tablh", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind2f", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr2", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "+", 
                  RowBox[{"tablh", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coorlh", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind2i", ",", "ind2f", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Htlh", ",", "coorlh"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "tabhl", "]"}], ">", "0"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"ind3i", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"tabhl", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind3f", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr3", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", 
                  RowBox[{"tabhl", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}], "//", 
                "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"coorhl", "=", 
               RowBox[{"Join", "[", 
                RowBox[{"ind3i", ",", "ind3f", ",", "2"}], "]"}]}], ";", 
              RowBox[{"AppendTo", "[", 
               RowBox[{"Hthl", ",", "coorhl"}], " ", "]"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"m", "\[Equal]", "0"}], ",", 
          RowBox[{"ntot2", "=", "1"}]}], "]"}], ";", 
        RowBox[{"(*", " ", 
         RowBox[{"to", " ", "trick", " ", 
          RowBox[{"psi", ".", "Ht", ".", "U"}], " ", "instead", " ", "of", 
          " ", "If", " ", "statements", " ", "there"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Htlh", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Hthl", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
           RowBox[{"{", 
            RowBox[{"ntot", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True]
},
AutoGeneratedPackage->Automatic,
WindowSize->{808, 706},
WindowMargins->{{Automatic, 247}, {Automatic, 0}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 25156, 612, 2211, "Input",
 InitializationCell->True]
}
]
*)

