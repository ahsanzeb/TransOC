(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     35906,        913]
NotebookOptionsPosition[     35587,        897]
NotebookOutlinePosition[     35978,        914]
CellTagsIndexPosition[     35935,        911]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], " ", "+", " ", "A"}], " ", "\[Rule]",
      " ", 
     RowBox[{"A", "'"}]}], " ", "*)"}],
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox["\[IndentingNewLine]",
   FontSize->36], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"D", ",", "Phi"}], ")"}], "+", 
      RowBox[{"A", "[", 
       RowBox[{"m", ",", "N"}], "]"}]}], " ", "\[Rule]", " ", 
     RowBox[{"A", "[", 
      RowBox[{
       RowBox[{"m", "+", "1"}], ",", 
       RowBox[{"N", "+", "2"}]}], "]"}]}], " ", "*)"}],
   FontSize->24], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "map", " ", "of", " ", "indices", " ", "of", " ", "states", " ", "when", 
      " ", "a", " ", "D"}], ",", 
     RowBox[{
     "Phi", " ", "pair", " ", "combines", " ", "to", " ", "make", " ", "two", 
      " ", "singly", " ", "occupied", " ", "sites"}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  StyleBox[
   RowBox[{"(*", " ", 
    RowBox[{"N", "=", 
     RowBox[{"0", " ", "case"}]}], " ", "*)"}],
   FontSize->18], 
  StyleBox["\[IndentingNewLine]",
   FontSize->18], 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAN0c", "[", "m_", "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "ntot3", ",", "ntot4", ",", 
         "Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"init", " ", "basis", " ", "states"}], " ", "=", " ", "1"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot1", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ":", " ", 
           RowBox[{"Final", " ", "basis", " ", "states", " ", "for", " ", 
            RowBox[{"th", "/", "tl"}], " ", 
            RowBox[{"cases", ":", 
             RowBox[{"|", "00"}]}]}]}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"m", "-", "1"}], ">"}], ";", " ", 
           RowBox[{
            RowBox[{"last", " ", "only", " ", "if", " ", "m"}], ">", 
            "0"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ntot2", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", "3", ",", "4"}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Only", " ", "middle", " ", "two", " ", "states", " ", "couple", 
           " ", "to", " ", "the", " ", "init", " ", "state", " ", "of", " ", 
           "D"}], ",", "Phi"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Htsph", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Htspl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "3"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAN0cc", "[", "m_", "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "ntot1", ",", "Htsp", ",", "ntot2", ",", "ntot3", ",", "ntot4", ",", 
         "Htsph", ",", "Htspl", ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
         RowBox[{"init", " ", "basis", " ", "states"}], " ", "=", " ", "1"}], 
        " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"ntot1", "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{"m", ":", " ", 
           RowBox[{
           "Final", " ", "basis", " ", "states", " ", "for", " ", "tlh", " ", 
            
            RowBox[{"case", ":", 
             RowBox[{"|", "00"}]}]}]}], ",", 
          RowBox[{"m", ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{
           RowBox[{"m", "-", "1"}], ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"m", "-", "2"}], ">"}], ";", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"last", " ", "three", " ", "only", " ", "if", " ", "m"}],
              "-", "1"}], "|", 
            RowBox[{"2", " ", "\[GreaterEqual]", "0"}]}]}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"ntot3", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"m", "\[Equal]", "0"}], ",", "1", ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"m", "\[Equal]", "1"}], ",", "3", ",", "4"}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Htsplh", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "1"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"N", "+", "2"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "2"}], ":", " ", 
           RowBox[{
           "Final", " ", "basis", " ", "states", " ", "for", " ", "thl", 
            RowBox[{"{", "?", "}"}], " ", "case"}], ":", 
           RowBox[{"|", "00"}]}], ",", 
          RowBox[{
           RowBox[{"m", "+", "2"}], ">"}], ",", 
          RowBox[{"|", "10"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "01"}], ",", 
          RowBox[{
           RowBox[{"m", "+", "1"}], ">"}], ",", 
          RowBox[{"|", "11"}], ",", 
          RowBox[{"m", ">"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ntot4", "=", "4"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Htsphl", "=", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "4"}], "}"}], "\[Rule]", " ", "1"}], "}"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"ntot1", ",", "ntot4"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"D", "&"}], "Phi", " ", "sites", " ", "turning", " ", "to", " ", 
     "active", " ", "go", " ", "to", " ", "the", " ", "end", " ", "of", " ", 
     "active", " ", 
     RowBox[{"list", "."}]}], "*)"}], 
   StyleBox["\[IndentingNewLine]",
    FontSize->18], 
   RowBox[{
    RowBox[{"mapDPhiAc", "[", 
     RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "x", ",", "ind1", ",", "ind2", ",", "listi", ",", "tab1", ",", "tab2", 
        ",", "set1", ",", "listf", ",", "xlh", ",", "xhl", ",", "tabhl", ",", 
        "tablh"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"tab1", "=", 
        RowBox[{"{", "}"}]}], ";", 
       RowBox[{"tab2", "=", 
        RowBox[{"{", "}"}]}], ";", 
       RowBox[{"tablh", "=", 
        RowBox[{"{", "}"}]}], ";", 
       RowBox[{"tabhl", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"listi", "=", 
        RowBox[{"comb", "[", 
         RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"set1", "=", 
           RowBox[{"listi", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"listf", "=", 
           RowBox[{"Sort", "[", 
            RowBox[{"Join", "[", 
             RowBox[{"set1", ",", 
              RowBox[{"{", 
               RowBox[{"N", "+", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
          RowBox[{"(*", " ", 
           RowBox[{"Lexicographical", " ", 
            RowBox[{"ordering", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"x", "=", 
           RowBox[{
            RowBox[{"c", "[", 
             RowBox[{
              RowBox[{"N", "+", "2"}], ",", 
              RowBox[{"k", "+", "1"}]}], "]"}], "-", 
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"c", "[", 
               RowBox[{
                RowBox[{"N", "+", "2", "-", 
                 RowBox[{"listf", "[", 
                  RowBox[{"[", 
                   RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                RowBox[{"k", "+", "1", "-", "p"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"p", ",", "0", ",", "k"}], "}"}]}], "]"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"only", " ", "when", " ", 
               RowBox[{"(", 
                RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
              RowBox[{"(", 
               RowBox[{"up", ",", "down"}], ")"}]}], ";", " ", 
             RowBox[{"when", " ", "they", " ", "go", " ", "to", " ", 
              RowBox[{"(", 
               RowBox[{"down", ",", "up"}], ")"}]}]}], ",", " ", 
            RowBox[{"add", " ", "1", " ", "in", " ", "the", " ", "indices"}], 
            ",", " ", 
            RowBox[{
            "this", " ", "is", " ", "done", " ", "when", " ", "this", " ", 
             "map", " ", "is", " ", "used"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"tab1", ",", "x"}], "]"}], ";"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"tab2", ",", 
             RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", "tab1"}]}], "]"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"cc", "===", 
      RowBox[{">", " ", "classical"}]}], ",", " ", 
     RowBox[{"cross", " ", "transitions"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"mapDPhiAcc", "[", 
      RowBox[{"N_", ",", "k_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x", ",", "ind1", ",", "ind2", ",", "listi", ",", "set1", ",", "xlh", 
         ",", "xhl", ",", "tabhl", ",", "tablh", ",", "listf2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"tablh", "=", 
         RowBox[{"{", "}"}]}], ";", 
        RowBox[{"tabhl", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"listi", "=", 
         RowBox[{"comb", "[", 
          RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"set1", "=", 
            RowBox[{"listi", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{"Lexicographical", " ", 
             RowBox[{"ordering", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"k", "=", "0"}], ";", " ", 
             RowBox[{"xlh", " ", "is", " ", "empty", " ", 
              RowBox[{"set", ".", " ", 
               RowBox[{"??", 
                RowBox[{
                 RowBox[{"deal", " ", "k"}], "\[Equal]", 
                 RowBox[{"0", " ", "case", " ", "seperatly"}]}]}]}]}]}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"xlh", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", "k"}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"set1", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "-", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"listf2", "=", 
            RowBox[{"Sort", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"set1", ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"N", "+", "1"}], ",", 
                 RowBox[{"N", "+", "2"}]}], "}"}]}], "]"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"xhl", "=", 
            RowBox[{
             RowBox[{"c", "[", 
              RowBox[{
               RowBox[{"N", "+", "2"}], ",", 
               RowBox[{"k", "+", "2"}]}], "]"}], "-", 
             RowBox[{"Sum", "[", 
              RowBox[{
               RowBox[{"c", "[", 
                RowBox[{
                 RowBox[{"N", "+", "2", "-", 
                  RowBox[{"listf2", "[", 
                   RowBox[{"[", 
                    RowBox[{"p", "+", "1"}], "]"}], "]"}]}], ",", 
                 RowBox[{"k", "+", "2", "-", "p"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"p", ",", "0", ",", 
                 RowBox[{"k", "+", "1"}]}], "}"}]}], "]"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"only", " ", "when", " ", 
                RowBox[{"(", 
                 RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
               RowBox[{"(", 
                RowBox[{"up", ",", "down"}], ")"}]}], ";", " ", 
              RowBox[{"when", " ", "they", " ", "go", " ", "to", " ", 
               RowBox[{"(", 
                RowBox[{"down", ",", "up"}], ")"}]}]}], ",", " ", 
             RowBox[{"add", " ", "1", " ", "in", " ", "the", " ", "indices"}],
              ",", " ", 
             RowBox[{
             "this", " ", "is", " ", "done", " ", "when", " ", "this", " ", 
              "map", " ", "is", " ", "used"}]}], " ", "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tablh", ",", "xlh"}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"tab2", ",", 
               RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"tabhl", ",", "xhl"}], "]"}], ";"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"tab2", ",", 
              RowBox[{"x", "+", "1"}]}], "]"}], ";"}], "*)"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "listi", "]"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"tablh", ",", "tabhl"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAc", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr1", ",", "pntr2", ",", "Hta", ",", "Htb", ",", "ind1", ",", 
         "ind2", ",", "ind2a", ",", "ind2b", ",", "coora", ",", "coorb", ",", 
         "ntot1", ",", "Htsp", ",", "ntot2", ",", "Hg", ",", "ind2sub", ",", 
         "ind1reptd", ",", "m1", ",", "m2", ",", "m3", ",", "tab1", ",", 
         "tablh", ",", "tabhl", ",", "Htlh", ",", "Hthl", ",", "pntr3", ",", 
         "ntot3", ",", "indhl", ",", "indlh", ",", "coorhl", ",", "coorlh", 
         ",", "m4", ",", "pntr4", ",", "ntot4", ",", "Htsph", ",", "Htspl", 
         ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"N", "\[Equal]", "0"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Htsph", ",", "Htspl"}], "}"}], "=", 
           RowBox[{"makeHtDPhiAN0c", "[", "m", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m1", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], ";", 
           RowBox[{"m2", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "1"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"m3", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", 
           RowBox[{"m4", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "2"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr1", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{"N", ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot1", "=", 
            RowBox[{"pntr1", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr2", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m2"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot2", "=", 
            RowBox[{"pntr2", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"maps", " ", "all", " ", "sectors", " ", 
              RowBox[{"(", 
               RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Hta", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Htb", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Htlh", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Hthl", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"tab1", 
               StyleBox["=",
                FontSize->14], 
               RowBox[{"mapDPhiAc", "[", 
                RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
                 "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"ind2", "=", 
               RowBox[{
                RowBox[{"pntr2", "[", 
                 RowBox[{"[", 
                  RowBox[{"k", "+", "2"}], "]"}], "]"}], "+", "tab1"}]}], ";",
               " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", " ", "k", " ", "by", " ", "1"}], ";", " ", 
                 RowBox[{"i", ".", "e", "."}]}], ",", " ", 
                RowBox[{"final", ":", " ", 
                 RowBox[{"k", "+", "1"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind2a", "=", 
               RowBox[{
                RowBox[{"{", "ind2", "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"th", ":", " ", 
                 RowBox[{"(", 
                  RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
                RowBox[{"(", 
                 RowBox[{"up", ",", "down"}], ")"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ind2b", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"ind2", " ", "+", "1"}], "}"}], "//", 
                "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"tl", ":", " ", 
                 RowBox[{"(", 
                  RowBox[{"D", ",", "Phi"}], ")"}]}], " ", "\[Rule]", " ", 
                RowBox[{"(", 
                 RowBox[{"down", ",", "up"}], ")"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "ind1", "]"}], ">", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"coora", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "ind2a", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Hta", ",", "coora"}], " ", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"coorb", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "ind2b", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Htb", ",", "coorb"}], " ", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsph", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Hta", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";", 
           RowBox[{"Htspl", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Htb", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot2"}], "}"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsph", ",", "Htspl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeHtDPhiAcc", "[", 
      RowBox[{"N_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Module", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "pntr1", ",", "pntr2", ",", "Hta", ",", "Htb", ",", "ind1", ",", 
         "ind2", ",", "ind2a", ",", "ind2b", ",", "coora", ",", "coorb", ",", 
         "ntot1", ",", "Htsp", ",", "ntot2", ",", "Hg", ",", "ind2sub", ",", 
         "ind1reptd", ",", "m1", ",", "m2", ",", "m3", ",", "tab1", ",", 
         "tablh", ",", "tabhl", ",", "Htlh", ",", "Hthl", ",", "pntr3", ",", 
         "ntot3", ",", "indhl", ",", "indlh", ",", "coorhl", ",", "coorlh", 
         ",", "m4", ",", "pntr4", ",", "ntot4", ",", "Htsph", ",", "Htspl", 
         ",", "Htsplh", ",", "Htsphl"}], "}"}], ",", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"N", "\[Equal]", "0"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Htsplh", ",", "Htsphl"}], "}"}], "=", 
           RowBox[{"makeHtDPhiAN0cc", "[", "m", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"pointers", " ", "for", " ", "start", " ", "index"}], " ", 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"m1", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", "N"}], "]"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"m2", "=", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"m", "+", "1"}], ",", 
                RowBox[{"N", "+", "2"}]}], "]"}]}], ";"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"m3", "=", 
            RowBox[{"Min", "[", 
             RowBox[{"m", ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", 
           RowBox[{"m4", "=", 
            RowBox[{"Min", "[", 
             RowBox[{
              RowBox[{"m", "+", "2"}], ",", 
              RowBox[{"N", "+", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr1", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{"N", ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m1"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot1", "=", 
            RowBox[{"pntr1", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr3", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m3"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot3", "=", 
            RowBox[{"pntr3", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"pntr4", "=", 
            RowBox[{"Insert", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Sum", "[", 
                 RowBox[{
                  RowBox[{"c", "[", 
                   RowBox[{
                    RowBox[{"N", "+", "2"}], ",", "j"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"j", ",", "0", ",", "i"}], "}"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", "m4"}], "}"}]}], "]"}], ",", "0",
               ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"ntot4", "=", 
            RowBox[{"pntr4", "[", 
             RowBox[{"[", 
              RowBox[{"-", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{"maps", " ", "all", " ", "sectors", " ", 
              RowBox[{"(", 
               RowBox[{"up", " ", "spins"}], ")"}]}], ";", " ", "Ht"}], " ", 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Htlh", "=", 
            RowBox[{"{", "}"}]}], ";", 
           RowBox[{"Hthl", "=", 
            RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"tablh", ",", "tabhl"}], "}"}], 
               StyleBox["=",
                FontSize->14], 
               RowBox[{"mapDPhiAcc", "[", 
                RowBox[{"N", ",", "k"}], "]"}]}], ";", "\[IndentingNewLine]", 
              
              RowBox[{"ind1", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr1", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{"i", ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"c", "[", 
                    RowBox[{"N", ",", "k"}], "]"}]}], "}"}]}], "]"}]}], "}"}],
                 "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"indlh", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr3", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "1"}], "]"}], "]"}], "+", "tablh"}], 
                 "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{"final", ":", " ", "k"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"indhl", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"pntr4", "[", 
                   RowBox[{"[", 
                    RowBox[{"k", "+", "3"}], "]"}], "]"}], "+", "tabhl"}], 
                 "}"}], "//", "Transpose"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{"final", ":", " ", 
                RowBox[{"k", "+", "2"}]}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "ind1", "]"}], ">", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"coorlh", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "indlh", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Htlh", ",", "coorlh"}], " ", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"coorhl", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"ind1", ",", "indhl", ",", "2"}], "]"}]}], ";", 
                 RowBox[{"AppendTo", "[", 
                  RowBox[{"Hthl", ",", "coorhl"}], " ", "]"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
             ",", 
             RowBox[{"{", 
              RowBox[{"k", ",", "0", ",", "m1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsplh", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Htlh", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot3"}], "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Htsphl", "=", 
            RowBox[{"SparseArray", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{"Hthl", ",", "1"}], "]"}], "\[Rule]", " ", "1"}], ",", 
              RowBox[{"{", 
               RowBox[{"ntot1", ",", "ntot4"}], "}"}]}], "]"}]}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"Htsplh", ",", "Htsphl"}], "}"}]}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.711615266881003*^9, 3.712749781075636*^9, 
  3.7127549179988317`*^9}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{808, 706},
WindowMargins->{{Automatic, -74}, {Automatic, 0}},
FrontEndVersion->"10.4 for Mac OS X x86 (32-bit, 64-bit Kernel) (February 25, \
2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 35025, 875, 2438, "Input",
 InitializationCell->True]
}
]
*)

